{"version":3,"file":"ctrl-ngx-droppable.js","sources":["../../src/lib/droppable.directive.ts","../../src/lib/droppable.module.ts","../../src/lib/ctrl-ngx-droppable.ts"],"sourcesContent":["import { DOCUMENT } from '@angular/common';\nimport {\n  AfterContentInit,\n  Directive,\n  ElementRef,\n  EventEmitter,\n  HostBinding,\n  HostListener,\n  Inject,\n  Input,\n  OnChanges,\n  OnDestroy,\n  Output,\n} from '@angular/core';\n\n@Directive({ selector: '[droppable]', exportAs: 'droppable' })\nexport class DroppableDirective\n  implements OnChanges, OnDestroy, AfterContentInit {\n  /** prompt for files when clicked */\n  @Input() isClickable = true;\n  /** allow multiple files dropped or selected */\n  @Input() acceptsMultipleFiles = true;\n  /** input limit accepted file types via MIME */\n  @Input() accept: string | false = false;\n  /** append CSS class when files are dragged on element */\n  @Input() appendStatusClasses = true;\n  @Input() dragOverClass = 'dragover';\n  @Output() filesDropped = new EventEmitter<File[]>();\n  /**\n   * Accessibility\n   */\n  @HostBinding('attr.tabIndex') tabIndex = 0;\n  /**\n   * Accessibility\n   */\n  @HostBinding('attr.role') role = 'button';\n  /** File is being hovered over, can be used to show something on hover */\n  isHover = false;\n  private virtualInputElement!: HTMLInputElement;\n\n  @HostListener('dragover', ['$event'])\n  handleDragover(e: Event): void {\n    e.preventDefault();\n    e.stopPropagation();\n    this.isHover = true;\n    if (this.appendStatusClasses) {\n      this.element.nativeElement.classList.add(this.dragOverClass);\n    }\n  }\n\n  @HostListener('dragleave', ['$event'])\n  handleDragleave(e: Event): void {\n    e.preventDefault();\n    e.stopPropagation();\n    this.isHover = false;\n    if (this.appendStatusClasses) {\n      this.element.nativeElement.classList.remove(this.dragOverClass);\n    }\n  }\n\n  @HostListener('drop', ['$event'])\n  handleDrop(e: Event): void {\n    e.preventDefault();\n    e.stopPropagation();\n    this.isHover = false;\n    if (this.appendStatusClasses) {\n      this.element.nativeElement.classList.remove(this.dragOverClass);\n    }\n    this.onDroppableElementChange(e);\n  }\n\n  @HostListener('click', ['$event'])\n  handleClick(e: Event): void {\n    if (this.isClickable) {\n      this.promptForFiles();\n    }\n  }\n\n  @HostListener('keydown.enter', ['$event'])\n  handleEnter(e: Event): void {\n    this.promptForFiles();\n    this.element.nativeElement.blur();\n  }\n\n  constructor(\n    // tslint:disable-next-line:no-any\n    @Inject(DOCUMENT) protected document: any,\n    private element: ElementRef,\n  ) {}\n\n  ngOnChanges(): void {\n    if (this.virtualInputElement) {\n      this.setAcceptsMultipleFiles();\n      this.setAccepted();\n    }\n  }\n\n  ngAfterContentInit(): void {\n    this.virtualInputElement = this.makeVirtualInputElement();\n    this.virtualInputElement.addEventListener(\n      'change',\n      this.onVirtualInputElementChange.bind(this),\n    );\n    this.setAcceptsMultipleFiles();\n    this.setAccepted();\n  }\n\n  setAcceptsMultipleFiles(): void {\n    if (!this.acceptsMultipleFiles) {\n      this.virtualInputElement.removeAttribute('multiple');\n      return;\n    }\n    this.virtualInputElement.setAttribute(\n      'multiple',\n      this.acceptsMultipleFiles.toString(),\n    );\n  }\n\n  setAccepted(): void {\n    if (!this.accept) {\n      this.virtualInputElement.removeAttribute('accept');\n      return;\n    }\n    this.virtualInputElement.setAttribute('accept', this.accept.toString());\n  }\n\n  ngOnDestroy(): void {\n    // destroy created input\n    if (this.virtualInputElement) {\n      this.virtualInputElement.removeEventListener(\n        'change',\n        this.onVirtualInputElementChange.bind(this),\n      );\n    }\n  }\n\n  makeVirtualInputElement(): HTMLInputElement {\n    const input: HTMLInputElement = this.document.createElement('input');\n    input.setAttribute('type', 'file');\n    input.style.display = 'none';\n    return input;\n  }\n\n  onVirtualInputElementChange(e: Event): void {\n    this.onDroppableElementChange(e);\n    this.virtualInputElement.value = '';\n  }\n\n  // tslint:disable-next-line:no-any\n  onDroppableElementChange(event: { [key: string]: any }): void {\n    let files;\n    if (event.dataTransfer) {\n      files = event.dataTransfer.files;\n    } else if (event.target) {\n      files = event.target.files;\n    } else {\n      throw Error('Fired event contains no files');\n    }\n\n    // Files is FileList, we convert to array\n    const filesArray: File[] = Array.from(files);\n    this.filesDropped.emit(filesArray);\n  }\n\n  promptForFiles(): void {\n    this.virtualInputElement.click();\n  }\n}\n","import { NgModule } from '@angular/core';\n\nimport { DroppableDirective } from './droppable.directive';\n\n@NgModule({\n  exports: [DroppableDirective],\n  declarations: [DroppableDirective],\n})\nexport class DroppableModule {}\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public_api';\n"],"names":[],"mappings":"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"}