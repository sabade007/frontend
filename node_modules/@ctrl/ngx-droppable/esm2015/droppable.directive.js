import { DOCUMENT } from '@angular/common';
import { Directive, ElementRef, EventEmitter, HostBinding, HostListener, Inject, Input, Output, } from '@angular/core';
export class DroppableDirective {
    constructor(
    // tslint:disable-next-line:no-any
    document, element) {
        this.document = document;
        this.element = element;
        /** prompt for files when clicked */
        this.isClickable = true;
        /** allow multiple files dropped or selected */
        this.acceptsMultipleFiles = true;
        /** input limit accepted file types via MIME */
        this.accept = false;
        /** append CSS class when files are dragged on element */
        this.appendStatusClasses = true;
        this.dragOverClass = 'dragover';
        this.filesDropped = new EventEmitter();
        /**
         * Accessibility
         */
        this.tabIndex = 0;
        /**
         * Accessibility
         */
        this.role = 'button';
        /** File is being hovered over, can be used to show something on hover */
        this.isHover = false;
    }
    handleDragover(e) {
        e.preventDefault();
        e.stopPropagation();
        this.isHover = true;
        if (this.appendStatusClasses) {
            this.element.nativeElement.classList.add(this.dragOverClass);
        }
    }
    handleDragleave(e) {
        e.preventDefault();
        e.stopPropagation();
        this.isHover = false;
        if (this.appendStatusClasses) {
            this.element.nativeElement.classList.remove(this.dragOverClass);
        }
    }
    handleDrop(e) {
        e.preventDefault();
        e.stopPropagation();
        this.isHover = false;
        if (this.appendStatusClasses) {
            this.element.nativeElement.classList.remove(this.dragOverClass);
        }
        this.onDroppableElementChange(e);
    }
    handleClick(e) {
        if (this.isClickable) {
            this.promptForFiles();
        }
    }
    handleEnter(e) {
        this.promptForFiles();
        this.element.nativeElement.blur();
    }
    ngOnChanges() {
        if (this.virtualInputElement) {
            this.setAcceptsMultipleFiles();
            this.setAccepted();
        }
    }
    ngAfterContentInit() {
        this.virtualInputElement = this.makeVirtualInputElement();
        this.virtualInputElement.addEventListener('change', this.onVirtualInputElementChange.bind(this));
        this.setAcceptsMultipleFiles();
        this.setAccepted();
    }
    setAcceptsMultipleFiles() {
        if (!this.acceptsMultipleFiles) {
            this.virtualInputElement.removeAttribute('multiple');
            return;
        }
        this.virtualInputElement.setAttribute('multiple', this.acceptsMultipleFiles.toString());
    }
    setAccepted() {
        if (!this.accept) {
            this.virtualInputElement.removeAttribute('accept');
            return;
        }
        this.virtualInputElement.setAttribute('accept', this.accept.toString());
    }
    ngOnDestroy() {
        // destroy created input
        if (this.virtualInputElement) {
            this.virtualInputElement.removeEventListener('change', this.onVirtualInputElementChange.bind(this));
        }
    }
    makeVirtualInputElement() {
        const input = this.document.createElement('input');
        input.setAttribute('type', 'file');
        input.style.display = 'none';
        return input;
    }
    onVirtualInputElementChange(e) {
        this.onDroppableElementChange(e);
        this.virtualInputElement.value = '';
    }
    // tslint:disable-next-line:no-any
    onDroppableElementChange(event) {
        let files;
        if (event.dataTransfer) {
            files = event.dataTransfer.files;
        }
        else if (event.target) {
            files = event.target.files;
        }
        else {
            throw Error('Fired event contains no files');
        }
        // Files is FileList, we convert to array
        const filesArray = Array.from(files);
        this.filesDropped.emit(filesArray);
    }
    promptForFiles() {
        this.virtualInputElement.click();
    }
}
DroppableDirective.decorators = [
    { type: Directive, args: [{ selector: '[droppable]', exportAs: 'droppable' },] }
];
DroppableDirective.ctorParameters = () => [
    { type: undefined, decorators: [{ type: Inject, args: [DOCUMENT,] }] },
    { type: ElementRef }
];
DroppableDirective.propDecorators = {
    isClickable: [{ type: Input }],
    acceptsMultipleFiles: [{ type: Input }],
    accept: [{ type: Input }],
    appendStatusClasses: [{ type: Input }],
    dragOverClass: [{ type: Input }],
    filesDropped: [{ type: Output }],
    tabIndex: [{ type: HostBinding, args: ['attr.tabIndex',] }],
    role: [{ type: HostBinding, args: ['attr.role',] }],
    handleDragover: [{ type: HostListener, args: ['dragover', ['$event'],] }],
    handleDragleave: [{ type: HostListener, args: ['dragleave', ['$event'],] }],
    handleDrop: [{ type: HostListener, args: ['drop', ['$event'],] }],
    handleClick: [{ type: HostListener, args: ['click', ['$event'],] }],
    handleEnter: [{ type: HostListener, args: ['keydown.enter', ['$event'],] }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZHJvcHBhYmxlLmRpcmVjdGl2ZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9saWIvZHJvcHBhYmxlLmRpcmVjdGl2ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFDM0MsT0FBTyxFQUVMLFNBQVMsRUFDVCxVQUFVLEVBQ1YsWUFBWSxFQUNaLFdBQVcsRUFDWCxZQUFZLEVBQ1osTUFBTSxFQUNOLEtBQUssRUFHTCxNQUFNLEdBQ1AsTUFBTSxlQUFlLENBQUM7QUFHdkIsTUFBTSxPQUFPLGtCQUFrQjtJQW9FN0I7SUFDRSxrQ0FBa0M7SUFDTixRQUFhLEVBQ2pDLE9BQW1CO1FBREMsYUFBUSxHQUFSLFFBQVEsQ0FBSztRQUNqQyxZQUFPLEdBQVAsT0FBTyxDQUFZO1FBckU3QixvQ0FBb0M7UUFDM0IsZ0JBQVcsR0FBRyxJQUFJLENBQUM7UUFDNUIsK0NBQStDO1FBQ3RDLHlCQUFvQixHQUFHLElBQUksQ0FBQztRQUNyQywrQ0FBK0M7UUFDdEMsV0FBTSxHQUFtQixLQUFLLENBQUM7UUFDeEMseURBQXlEO1FBQ2hELHdCQUFtQixHQUFHLElBQUksQ0FBQztRQUMzQixrQkFBYSxHQUFHLFVBQVUsQ0FBQztRQUMxQixpQkFBWSxHQUFHLElBQUksWUFBWSxFQUFVLENBQUM7UUFDcEQ7O1dBRUc7UUFDMkIsYUFBUSxHQUFHLENBQUMsQ0FBQztRQUMzQzs7V0FFRztRQUN1QixTQUFJLEdBQUcsUUFBUSxDQUFDO1FBQzFDLHlFQUF5RTtRQUN6RSxZQUFPLEdBQUcsS0FBSyxDQUFDO0lBbURiLENBQUM7SUEvQ0osY0FBYyxDQUFDLENBQVE7UUFDckIsQ0FBQyxDQUFDLGNBQWMsRUFBRSxDQUFDO1FBQ25CLENBQUMsQ0FBQyxlQUFlLEVBQUUsQ0FBQztRQUNwQixJQUFJLENBQUMsT0FBTyxHQUFHLElBQUksQ0FBQztRQUNwQixJQUFJLElBQUksQ0FBQyxtQkFB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QUFDLFFBQVE7WUFsRmxCLFVBQVU7OzswQkFlVCxLQUFLO21DQUVMLEtBQUs7cUJBRUwsS0FBSztrQ0FFTCxLQUFLOzRCQUNMLEtBQUs7MkJBQ0wsTUFBTTt1QkFJTixXQUFXLFNBQUMsZUFBZTttQkFJM0IsV0FBVyxTQUFDLFdBQVc7NkJBS3ZCLFlBQVksU0FBQyxVQUFVLEVBQUUsQ0FBQyxRQUFRLENBQUM7OEJBVW5DLFlBQVksU0FBQyxXQUFXLEVBQUUsQ0FBQyxRQUFRLENBQUM7eUJBVXBDLFlBQVksU0FBQyxNQUFNLEVBQUUsQ0FBQyxRQUFRLENBQUM7MEJBVy9CLFlBQVksU0FBQyxPQUFPLEVBQUUsQ0FBQyxRQUFRLENBQUM7MEJBT2hDLFlBQVksU0FBQyxlQUFlLEVBQUUsQ0FBQyxRQUFRLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBET0NVTUVOVCB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbic7XG5pbXBvcnQge1xuICBBZnRlckNvbnRlbnRJbml0LFxuICBEaXJlY3RpdmUsXG4gIEVsZW1lbnRSZWYsXG4gIEV2ZW50RW1pdHRlcixcbiAgSG9zdEJpbmRpbmcsXG4gIEhvc3RMaXN0ZW5lcixcbiAgSW5qZWN0LFxuICBJbnB1dCxcbiAgT25DaGFuZ2VzLFxuICBPbkRlc3Ryb3ksXG4gIE91dHB1dCxcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5cbkBEaXJlY3RpdmUoeyBzZWxlY3RvcjogJ1tkcm9wcGFibGVdJywgZXhwb3J0QXM6ICdkcm9wcGFibGUnIH0pXG5leHBvcnQgY2xhc3MgRHJvcHBhYmxlRGlyZWN0aXZlXG4gIGltcGxlbWVudHMgT25DaGFuZ2VzLCBPbkRlc3Ryb3ksIEFmdGVyQ29udGVudEluaXQge1xuICAvKiogcHJvbXB0IGZvciBmaWxlcyB3aGVuIGNsaWNrZWQgKi9cbiAgQElucHV0KCkgaXNDbGlja2FibGUgPSB0cnVlO1xuICAvKiogYWxsb3cgbXVsdGlwbGUgZmlsZXMgZHJvcHBlZCBvciBzZWxlY3RlZCAqL1xuICBASW5wdXQoKSBhY2NlcHRzTXVsdGlwbGVGaWxlcyA9IHRydWU7XG4gIC8qKiBpbnB1dCBsaW1pdCBhY2NlcHRlZCBmaWxlIHR5cGVzIHZpYSBNSU1FICovXG4gIEBJbnB1dCgpIGFjY2VwdDogc3RyaW5nIHwgZmFsc2UgPSBmYWxzZTtcbiAgLyoqIGFwcGVuZCBDU1MgY2xhc3Mgd2hlbiBmaWxlcyBhcmUgZHJhZ2dlZCBvbiBlbGVtZW50ICovXG4gIEBJbnB1dCgpIGFwcGVuZFN0YXR1c0NsYXNzZXMgPSB0cnVlO1xuICBASW5wdXQoKSBkcmFnT3ZlckNsYXNzID0gJ2RyYWdvdmVyJztcbiAgQE91dHB1dCgpIGZpbGVzRHJvcHBlZCA9IG5ldyBFdmVudEVtaXR0ZXI8RmlsZVtdPigpO1xuICAvKipcbiAgICogQWNjZXNzaWJpbGl0eVxuICAgKi9cbiAgQEhvc3RCaW5kaW5nKCdhdHRyLnRhYkluZGV4JykgdGFiSW5kZXggPSAwO1xuICAvKipcbiAgICogQWNjZXNzaWJpbGl0eVxuICAgKi9cbiAgQEhvc3RCaW5kaW5nKCdhdHRyLnJvbGUnKSByb2xlID0gJ2J1dHRvbic7XG4gIC8qKiBGaWxlIGlzIGJlaW5nIGhvdmVyZWQgb3ZlciwgY2FuIGJlIHVzZWQgdG8gc2hvdyBzb21ldGhpbmcgb24gaG92ZXIgKi9cbiAgaXNIb3ZlciA9IGZhbHNlO1xuICBwcml2YXRlIHZpcnR1YWxJbnB1dEVsZW1lbnQhOiBIVE1MSW5wdXRFbGVtZW50O1xuXG4gIEBIb3N0TGlzdGVuZXIoJ2RyYWdvdmVyJywgWyckZXZlbnQnXSlcbiAgaGFuZGxlRHJhZ292ZXIoZTogRXZlbnQpOiB2b2lkIHtcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICB0aGlzLmlzSG92ZXIgPSB0cnVlO1xuICAgIGlmICh0aGlzLmFwcGVuZFN0YXR1c0NsYXNzZXMpIHtcbiAgICAgIHRoaXMuZWxlbWVudC5uYXRpdmVFbGVtZW50LmNsYXNzTGlzdC5hZGQodGhpcy5kcmFnT3ZlckNsYXNzKTtcbiAgICB9XG4gIH1cblxuICBASG9zdExpc3RlbmVyKCdkcmFnbGVhdmUnLCBbJyRldmVudCddKVxuICBoYW5kbGVEcmFnbGVhdmUoZTogRXZlbnQpOiB2b2lkIHtcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICB0aGlzLmlzSG92ZXIgPSBmYWxzZTtcbiAgICBpZiAodGhpcy5hcHBlbmRTdGF0dXNDbGFzc2VzKSB7XG4gICAgICB0aGlzLmVsZW1lbnQubmF0aXZlRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKHRoaXMuZHJhZ092ZXJDbGFzcyk7XG4gICAgfVxuICB9XG5cbiAgQEhvc3RMaXN0ZW5lcignZHJvcCcsIFsnJGV2ZW50J10pXG4gIGhhbmRsZURyb3AoZTogRXZlbnQpOiB2b2lkIHtcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICB0aGlzLmlzSG92ZXIgPSBmYWxzZTtcbiAgICBpZiAodGhpcy5hcHBlbmRTdGF0dXNDbGFzc2VzKSB7XG4gICAgICB0aGlzLmVsZW1lbnQubmF0aXZlRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKHRoaXMuZHJhZ092ZXJDbGFzcyk7XG4gICAgfVxuICAgIHRoaXMub25Ecm9wcGFibGVFbGVtZW50Q2hhbmdlKGUpO1xuICB9XG5cbiAgQEhvc3RMaXN0ZW5lcignY2xpY2snLCBbJyRldmVudCddKVxuICBoYW5kbGVDbGljayhlOiBFdmVudCk6IHZvaWQge1xuICAgIGlmICh0aGlzLmlzQ2xpY2thYmxlKSB7XG4gICAgICB0aGlzLnByb21wdEZvckZpbGVzKCk7XG4gICAgfVxuICB9XG5cbiAgQEhvc3RMaXN0ZW5lcigna2V5ZG93bi5lbnRlcicsIFsnJGV2ZW50J10pXG4gIGhhbmRsZUVudGVyKGU6IEV2ZW50KTogdm9pZCB7XG4gICAgdGhpcy5wcm9tcHRGb3JGaWxlcygpO1xuICAgIHRoaXMuZWxlbWVudC5uYXRpdmVFbGVtZW50LmJsdXIoKTtcbiAgfVxuXG4gIGNvbnN0cnVjdG9yKFxuICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpuby1hbnlcbiAgICBASW5qZWN0KERPQ1VNRU5UKSBwcm90ZWN0ZWQgZG9jdW1lbnQ6IGFueSxcbiAgICBwcml2YXRlIGVsZW1lbnQ6IEVsZW1lbnRSZWYsXG4gICkge31cblxuICBuZ09uQ2hhbmdlcygpOiB2b2lkIHtcbiAgICBpZiAodGhpcy52aXJ0dWFsSW5wdXRFbGVtZW50KSB7XG4gICAgICB0aGlzLnNldEFjY2VwdHNNdWx0aXBsZUZpbGVzKCk7XG4gICAgICB0aGlzLnNldEFjY2VwdGVkKCk7XG4gICAgfVxuICB9XG5cbiAgbmdBZnRlckNvbnRlbnRJbml0KCk6IHZvaWQge1xuICAgIHRoaXMudmlydHVhbElucHV0RWxlbWVudCA9IHRoaXMubWFrZVZpcnR1YWxJbnB1dEVsZW1lbnQoKTtcbiAgICB0aGlzLnZpcnR1YWxJbnB1dEVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcbiAgICAgICdjaGFuZ2UnLFxuICAgICAgdGhpcy5vblZpcnR1YWxJbnB1dEVsZW1lbnRDaGFuZ2UuYmluZCh0aGlzKSxcbiAgICApO1xuICAgIHRoaXMuc2V0QWNjZXB0c011bHRpcGxlRmlsZXMoKTtcbiAgICB0aGlzLnNldEFjY2VwdGVkKCk7XG4gIH1cblxuICBzZXRBY2NlcHRzTXVsdGlwbGVGaWxlcygpOiB2b2lkIHtcbiAgICBpZiAoIXRoaXMuYWNjZXB0c011bHRpcGxlRmlsZXMpIHtcbiAgICAgIHRoaXMudmlydHVhbElucHV0RWxlbWVudC5yZW1vdmVBdHRyaWJ1dGUoJ211bHRpcGxlJyk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHRoaXMudmlydHVhbElucHV0RWxlbWVudC5zZXRBdHRyaWJ1dGUoXG4gICAgICAnbXVsdGlwbGUnLFxuICAgICAgdGhpcy5hY2NlcHRzTXVsdGlwbGVGaWxlcy50b1N0cmluZygpLFxuICAgICk7XG4gIH1cblxuICBzZXRBY2NlcHRlZCgpOiB2b2lkIHtcbiAgICBpZiAoIXRoaXMuYWNjZXB0KSB7XG4gICAgICB0aGlzLnZpcnR1YWxJbnB1dEVsZW1lbnQucmVtb3ZlQXR0cmlidXRlKCdhY2NlcHQnKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdGhpcy52aXJ0dWFsSW5wdXRFbGVtZW50LnNldEF0dHJpYnV0ZSgnYWNjZXB0JywgdGhpcy5hY2NlcHQudG9TdHJpbmcoKSk7XG4gIH1cblxuICBuZ09uRGVzdHJveSgpOiB2b2lkIHtcbiAgICAvLyBkZXN0cm95IGNyZWF0ZWQgaW5wdXRcbiAgICBpZiAodGhpcy52aXJ0dWFsSW5wdXRFbGVtZW50KSB7XG4gICAgICB0aGlzLnZpcnR1YWxJbnB1dEVsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcbiAgICAgICAgJ2NoYW5nZScsXG4gICAgICAgIHRoaXMub25WaXJ0dWFsSW5wdXRFbGVtZW50Q2hhbmdlLmJpbmQodGhpcyksXG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIG1ha2VWaXJ0dWFsSW5wdXRFbGVtZW50KCk6IEhUTUxJbnB1dEVsZW1lbnQge1xuICAgIGNvbnN0IGlucHV0OiBIVE1MSW5wdXRFbGVtZW50ID0gdGhpcy5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbnB1dCcpO1xuICAgIGlucHV0LnNldEF0dHJpYnV0ZSgndHlwZScsICdmaWxlJyk7XG4gICAgaW5wdXQuc3R5bGUuZGlzcGxheSA9ICdub25lJztcbiAgICByZXR1cm4gaW5wdXQ7XG4gIH1cblxuICBvblZpcnR1YWxJbnB1dEVsZW1lbnRDaGFuZ2UoZTogRXZlbnQpOiB2b2lkIHtcbiAgICB0aGlzLm9uRHJvcHBhYmxlRWxlbWVudENoYW5nZShlKTtcbiAgICB0aGlzLnZpcnR1YWxJbnB1dEVsZW1lbnQudmFsdWUgPSAnJztcbiAgfVxuXG4gIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpuby1hbnlcbiAgb25Ecm9wcGFibGVFbGVtZW50Q2hhbmdlKGV2ZW50OiB7IFtrZXk6IHN0cmluZ106IGFueSB9KTogdm9pZCB7XG4gICAgbGV0IGZpbGVzO1xuICAgIGlmIChldmVudC5kYXRhVHJhbnNmZXIpIHtcbiAgICAgIGZpbGVzID0gZXZlbnQuZGF0YVRyYW5zZmVyLmZpbGVzO1xuICAgIH0gZWxzZSBpZiAoZXZlbnQudGFyZ2V0KSB7XG4gICAgICBmaWxlcyA9IGV2ZW50LnRhcmdldC5maWxlcztcbiAgICB9IGVsc2Uge1xuICAgICAgdGhyb3cgRXJyb3IoJ0ZpcmVkIGV2ZW50IGNvbnRhaW5zIG5vIGZpbGVzJyk7XG4gICAgfVxuXG4gICAgLy8gRmlsZXMgaXMgRmlsZUxpc3QsIHdlIGNvbnZlcnQgdG8gYXJyYXlcbiAgICBjb25zdCBmaWxlc0FycmF5OiBGaWxlW10gPSBBcnJheS5mcm9tKGZpbGVzKTtcbiAgICB0aGlzLmZpbGVzRHJvcHBlZC5lbWl0KGZpbGVzQXJyYXkpO1xuICB9XG5cbiAgcHJvbXB0Rm9yRmlsZXMoKTogdm9pZCB7XG4gICAgdGhpcy52aXJ0dWFsSW5wdXRFbGVtZW50LmNsaWNrKCk7XG4gIH1cbn1cbiJdfQ==