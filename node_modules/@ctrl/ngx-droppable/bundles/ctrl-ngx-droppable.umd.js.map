{"version":3,"file":"ctrl-ngx-droppable.umd.js","sources":["../../src/lib/droppable.directive.ts","../../src/lib/droppable.module.ts","../../src/lib/ctrl-ngx-droppable.ts"],"sourcesContent":["import { DOCUMENT } from '@angular/common';\nimport {\n  AfterContentInit,\n  Directive,\n  ElementRef,\n  EventEmitter,\n  HostBinding,\n  HostListener,\n  Inject,\n  Input,\n  OnChanges,\n  OnDestroy,\n  Output,\n} from '@angular/core';\n\n@Directive({ selector: '[droppable]', exportAs: 'droppable' })\nexport class DroppableDirective\n  implements OnChanges, OnDestroy, AfterContentInit {\n  /** prompt for files when clicked */\n  @Input() isClickable = true;\n  /** allow multiple files dropped or selected */\n  @Input() acceptsMultipleFiles = true;\n  /** input limit accepted file types via MIME */\n  @Input() accept: string | false = false;\n  /** append CSS class when files are dragged on element */\n  @Input() appendStatusClasses = true;\n  @Input() dragOverClass = 'dragover';\n  @Output() filesDropped = new EventEmitter<File[]>();\n  /**\n   * Accessibility\n   */\n  @HostBinding('attr.tabIndex') tabIndex = 0;\n  /**\n   * Accessibility\n   */\n  @HostBinding('attr.role') role = 'button';\n  /** File is being hovered over, can be used to show something on hover */\n  isHover = false;\n  private virtualInputElement!: HTMLInputElement;\n\n  @HostListener('dragover', ['$event'])\n  handleDragover(e: Event): void {\n    e.preventDefault();\n    e.stopPropagation();\n    this.isHover = true;\n    if (this.appendStatusClasses) {\n      this.element.nativeElement.classList.add(this.dragOverClass);\n    }\n  }\n\n  @HostListener('dragleave', ['$event'])\n  handleDragleave(e: Event): void {\n    e.preventDefault();\n    e.stopPropagation();\n    this.isHover = false;\n    if (this.appendStatusClasses) {\n      this.element.nativeElement.classList.remove(this.dragOverClass);\n    }\n  }\n\n  @HostListener('drop', ['$event'])\n  handleDrop(e: Event): void {\n    e.preventDefault();\n    e.stopPropagation();\n    this.isHover = false;\n    if (this.appendStatusClasses) {\n      this.element.nativeElement.classList.remove(this.dragOverClass);\n    }\n    this.onDroppableElementChange(e);\n  }\n\n  @HostListener('click', ['$event'])\n  handleClick(e: Event): void {\n    if (this.isClickable) {\n      this.promptForFiles();\n    }\n  }\n\n  @HostListener('keydown.enter', ['$event'])\n  handleEnter(e: Event): void {\n    this.promptForFiles();\n    this.element.nativeElement.blur();\n  }\n\n  constructor(\n    // tslint:disable-next-line:no-any\n    @Inject(DOCUMENT) protected document: any,\n    private element: ElementRef,\n  ) {}\n\n  ngOnChanges(): void {\n    if (this.virtualInputElement) {\n      this.setAcceptsMultipleFiles();\n      this.setAccepted();\n    }\n  }\n\n  ngAfterContentInit(): void {\n    this.virtualInputElement = this.makeVirtualInputElement();\n    this.virtualInputElement.addEventListener(\n      'change',\n      this.onVirtualInputElementChange.bind(this),\n    );\n    this.setAcceptsMultipleFiles();\n    this.setAccepted();\n  }\n\n  setAcceptsMultipleFiles(): void {\n    if (!this.acceptsMultipleFiles) {\n      this.virtualInputElement.removeAttribute('multiple');\n      return;\n    }\n    this.virtualInputElement.setAttribute(\n      'multiple',\n      this.acceptsMultipleFiles.toString(),\n    );\n  }\n\n  setAccepted(): void {\n    if (!this.accept) {\n      this.virtualInputElement.removeAttribute('accept');\n      return;\n    }\n    this.virtualInputElement.setAttribute('accept', this.accept.toString());\n  }\n\n  ngOnDestroy(): void {\n    // destroy created input\n    if (this.virtualInputElement) {\n      this.virtualInputElement.removeEventListener(\n        'change',\n        this.onVirtualInputElementChange.bind(this),\n      );\n    }\n  }\n\n  makeVirtualInputElement(): HTMLInputElement {\n    const input: HTMLInputElement = this.document.createElement('input');\n    input.setAttribute('type', 'file');\n    input.style.display = 'none';\n    return input;\n  }\n\n  onVirtualInputElementChange(e: Event): void {\n    this.onDroppableElementChange(e);\n    this.virtualInputElement.value = '';\n  }\n\n  // tslint:disable-next-line:no-any\n  onDroppableElementChange(event: { [key: string]: any }): void {\n    let files;\n    if (event.dataTransfer) {\n      files = event.dataTransfer.files;\n    } else if (event.target) {\n      files = event.target.files;\n    } else {\n      throw Error('Fired event contains no files');\n    }\n\n    // Files is FileList, we convert to array\n    const filesArray: File[] = Array.from(files);\n    this.filesDropped.emit(filesArray);\n  }\n\n  promptForFiles(): void {\n    this.virtualInputElement.click();\n  }\n}\n","import { NgModule } from '@angular/core';\n\nimport { DroppableDirective } from './droppable.directive';\n\n@NgModule({\n  exports: [DroppableDirective],\n  declarations: [DroppableDirective],\n})\nexport class DroppableModule {}\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public_api';\n"],"names":["EventEmitter","Directive","Inject","DOCUMENT","ElementRef","Input","Output","HostBinding","HostListener","NgModule"],"mappings":"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"}