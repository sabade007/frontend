import { Component, EventEmitter, HostListener, Input, NgZone, Output, ViewChild } from '@angular/core';
import { interval, Observable, Subscription } from 'rxjs';
import { DoubleSide, Mesh, PerspectiveCamera, PlaneBufferGeometry, Scene, ShaderMaterial, Vector4, WebGLRenderer } from 'three';
import { TextureLoader } from 'three';
import { RxjsTween } from '../tween/rxjs-tween';
import { ImageTransitionShaders } from './shaders/imageTransitionShaders';
export class ImageTransitionComponent {
    constructor(ngZone) {
        this.ngZone = ngZone;
        this.imageUrls = new Array();
        this.transitionDuration = 1000;
        this.animationEnabled = true;
        this.startIndex = 0;
        this.imageIndexChange = new EventEmitter();
        this.pAutoPlay = false;
        this.pAutoPlayInterval = 5000;
        this.pImageSize = 'cover';
        this.pTransitionType = 'split';
        this.pIntensity = 40.0;
        this.pScaleX = 50.0;
        this.pScaleY = 50.0;
        this.pWidth = 0.5;
        this.renderer = new WebGLRenderer({ antialias: true, alpha: true });
        this.scene = new Scene();
        this.textures = new Array();
        this.nextImageIndex = 0;
        this.tranistionOngoing = false;
        this.shaders = new ImageTransitionShaders();
        this.autoPlay$ = new Observable();
        this.autoPlaySubscription = new Subscription();
    }
    get imageSize() { return this.pImageSize; }
    set imageSize(imageSize) {
        this.pImageSize = imageSize;
        if (this.mesh != null) {
            this.resize();
        }
    }
    get autoPlay() { return this.pAutoPlay; }
    set autoPlay(autoplay) {
        this.pAutoPlay = autoplay;
        if (this.mesh != null) {
            if (this.pAutoPlay === true) {
                this.setAutoPlayInterval();
            }
            else {
                this.stopAutoPlayInterval();
            }
        }
    }
    get autoPlayInterval() { return this.pAutoPlayInterval; }
    set autoPlayInterval(autoPlayInterval) {
        this.pAutoPlayInterval = autoPlayInterval;
        if (this.mesh != null) {
            if (this.pAutoPlay === true) {
                this.stopAutoPlayInterval();
                this.setAutoPlayInterval();
            }
        }
    }
    get transitionType() { return this.pTransitionType; }
    set transitionType(transitionType) {
        this.pTransitionType = transitionType;
        if (this.material != null) {
            this.setShaderProperties();
        }
    }
    get sizeX() { return this.pScaleX; }
    set sizeX(sizeX) {
        this.pScaleX = sizeX;
        if (this.material != null) {
            this.setShaderProperties();
        }
    }
    get sizeY() { return this.pScaleY; }
    set sizeY(sizeY) {
        this.pScaleY = sizeY;
        if (this.material != null) {
            this.setShaderProperties();
        }
    }
    get width() { return this.pWidth; }
    set width(width) {
        this.pWidth = width;
        if (this.material != null) {
            this.setShaderProperties();
        }
    }
    get intensity() { return this.intensity; }
    set intensity(intensity) {
        this.pIntensity = intensity;
        if (this.material != null) {
            this.setShaderProperties();
        }
    }
    ngAfterViewInit() {
        // Init camera
        this.camera = new PerspectiveCamera(70, window.innerWidth / window.innerHeight, 0.001, 1000);
        this.camera.position.set(0, 0, 2);
        // Create scene
        this.scene = new Scene();
        // Init Mesh
        if (this.imageUrls.length < 2) {
            throw new Error('At least two images are required');
        }
        this.initMesh();
        // Init renderer
        const canvasWidth = this.threejsContainer.nativeElement.clientWidth;
        const canvasHeight = this.threejsContainer.nativeElement.clientHeight;
        this.renderer.setSize(canvasWidth, canvasHeight);
        this.threejsContainer.nativeElement.appendChild(this.renderer.domElement);
        // Init autoPlay Observable
        if (this.pAutoPlay === true) {
            this.setAutoPlayInterval();
        }
        this.animate();
    }
    ngOnDestroy() {
        // Cancel Animation
        cancelAnimationFrame(this.animationFrameId);
        // Stop autoplay animation
        this.stopAutoPlayInterval();
        // Remove threejs container from DOM
        this.threejsContainer.nativeElement.removeChild(this.renderer.domElement);
        // Dispose textures
        this.textures.forEach(t => {
            t.dispose();
        });
        // Dispose material
        if (this.material) {
            this.material.dispose();
        }
        // Clear scene
        if (this.scene) {
            this.scene.clear();
        }
        // Dispose renderer
        if (this.renderer) {
            this.renderer.dispose();
        }
    }
    /**
     * Initializes the mesh
     */
    initMesh() {
        // Create geometry
        const geometry = new PlaneBufferGeometry(1, 1, 2, 2);
        const promises = new Array();
        // Load pev, current and next textures
        this.textures = new Array(this.imageUrls.length);
        const prevImg = this.startIndex === 0 ? (this.imageUrls.length - 1) : (this.startIndex - 1);
        const nextImg = this.startIndex === (this.imageUrls.length - 1) ? 0 : (this.startIndex + 1);
        for (let idx = 0; idx < this.imageUrls.length; idx++) {
            if (idx === this.startIndex || idx === nextImg || idx === prevImg) {
                promises.push(new Promise(resolve => {
                    this.textures[idx] = (new TextureLoader()).load(this.imageUrls[idx], resolve);
                }));
            }
        }
        this.nextImageIndex = this.startIndex;
        // Emit event to set current image index
        this.imageIndexChange.emit(this.nextImageIndex);
        Promise.all(promises).then(() => {
            this.material = new ShaderMaterial({
                side: DoubleSide,
                uniforms: {
                    time: { value: 0 },
                    progress: { value: 0 },
                    border: { value: 0 },
                    intensity: { value: 50.0 },
                    scaleX: { value: 40.0 },
                    scaleY: { value: 40.0 },
                    transition: { value: 40.0 },
                    swipe: { value: 0 },
                    width: { value: 0.5 },
                    radius: { value: 0 },
                    texture1: { value: this.textures[this.startIndex] },
                    texture2: { value: this.textures[nextImg] },
                    resolution1: { value: new Vector4() },
                    resolution2: { value: new Vector4() }
                },
                // wireframe: true,
                vertexShader: this.shaders.vertex
            });
            this.setShaderProperties();
            this.mesh = new Mesh(geometry, this.material);
            this.scene.add(this.mesh);
            this.resize();
        });
    }
    /**
     * Sets the autoPlay interval
     */
    setAutoPlayInterval() {
        this.autoPlay$ = interval(this.pAutoPlayInterval);
        this.autoPlaySubscription = this.autoPlay$.subscribe({
            next: () => { this.prepAndLoadNextImg(false, true); }
        });
    }
    /**
     * Resets the autoPlay interval
     */
    resetAutoPlayInterval() {
        this.autoPlaySubscription.unsubscribe();
        this.autoPlaySubscription = this.autoPlay$.subscribe({
            next: () => { this.prepAndLoadNextImg(false, true); }
        });
    }
    /**
     * Stops the autoPlay interval
     */
    stopAutoPlayInterval() {
        this.autoPlaySubscription.unsubscribe();
    }
    /**
     * Sets the shader properties depending on the transition type
     */
    setShaderProperties() {
        switch (this.transitionType) {
            case 'split':
                this.material.uniforms.intensity.value = this.pIntensity;
                this.material.fragmentShader = this.shaders.splitTransitionFrag;
                break;
            case 'fade':
                this.material.fragmentShader = this.shaders.fadeFrag;
                break;
            case 'noise':
                this.material.uniforms.scaleX.value = this.pScaleX;
                this.material.uniforms.scaleY.value = this.pScaleY;
                this.material.uniforms.width.value = this.pWidth;
                this.material.fragmentShader = this.shaders.noiseFrag;
                break;
            case 'blur':
                this.material.uniforms.intensity.value = this.pIntensity;
                this.material.fragmentShader = this.shaders.blurFrag;
                break;
            default:
                break;
        }
        this.material.needsUpdate = true;
    }
    /**
     * Animation
     */
    animate() {
        if (this.animationEnabled === true) {
            this.renderer.render(this.scene, this.camera);
        }
        this.ngZone.runOutsideAngular(() => {
            this.animationFrameId = window.requestAnimationFrame(() => this.animate());
        });
    }
    /**
     * Resizes the canvas and updates the texture resulution information of the images
     */
    resize() {
        // Get the with and height of the container
        const containerWidth = this.threejsContainer.nativeElement.offsetWidth;
        const containerHeight = this.threejsContainer.nativeElement.offsetHeight;
        // return the function, if eihter with or heigth is undefined
        if (!containerHeight || !containerHeight) {
            return;
        }
        this.renderer.setSize(containerWidth, containerHeight);
        this.camera.aspect = containerWidth / containerHeight;
        this.updateTextureResolution(this.nextImageIndex, 1);
        const dist = this.camera.position.z;
        const height = 1;
        this.camera.fov = 2 * (180 / Math.PI) * Math.atan(height / (2 * dist));
        this.mesh.scale.x = this.camera.aspect;
        this.mesh.scale.y = 1;
        this.camera.updateProjectionMatrix();
    }
    /**
     * Updates the resulution of the texture for the shader depending on the image size type
     * @param textureNumber Number of the texture
     */
    updateTextureResolution(textureNumber, targetGlslTexture) {
        const texture = this.textures[textureNumber];
        const containerWidth = this.threejsContainer.nativeElement.offsetWidth;
        const containerHeight = this.threejsContainer.nativeElement.offsetHeight;
        // Adapt the size of the image
        const imageAspect = texture.image.height / texture.image.width;
        const containerAspect = containerHeight / containerWidth;
        let a1;
        let a2;
        if (this.pImageSize === 'cover') {
            if (containerAspect > imageAspect) {
                a1 = (containerWidth / containerHeight) * imageAspect;
                a2 = 1;
            }
            else {
                a1 = 1;
                a2 = (containerHeight / containerWidth) / imageAspect;
            }
        }
        else if (this.pImageSize === 'contain') {
            if (containerAspect < imageAspect) {
                a1 = (containerWidth / containerHeight) * imageAspect;
                a2 = 1;
            }
            else {
                a1 = 1;
                a2 = (containerHeight / containerWidth) / imageAspect;
            }
        }
        if (targetGlslTexture === 1) {
            this.material.uniforms.resolution1.value.x = containerWidth;
            this.material.uniforms.resolution1.value.y = containerHeight;
            this.material.uniforms.resolution1.value.z = a1;
            this.material.uniforms.resolution1.value.w = a2;
        }
        else if (targetGlslTexture === 2) {
            this.material.uniforms.resolution2.value.x = containerWidth;
            this.material.uniforms.resolution2.value.y = containerHeight;
            this.material.uniforms.resolution2.value.z = a1;
            this.material.uniforms.resolution2.value.w = a2;
        }
    }
    /**
     * Starts the transition effect to the next image
     * @param posDirection indicator, if the next or previous image should be loaded
     */
    transitionToNextTexture(backw = false) {
        // Set the flag to indicate that the transition animation is ongoing
        this.tranistionOngoing = true;
        // EventEmitter
        this.imageIndexChange.emit(this.nextImageIndex);
        this.ngZone.runOutsideAngular(() => {
            if (backw === true) {
                this.material.uniforms.texture2.value = this.material.uniforms.texture1.value;
                this.material.uniforms.resolution2.value.x = this.material.uniforms.resolution1.value.x;
                this.material.uniforms.resolution2.value.y = this.material.uniforms.resolution1.value.y;
                this.material.uniforms.resolution2.value.z = this.material.uniforms.resolution1.value.z;
                this.material.uniforms.resolution2.value.w = this.material.uniforms.resolution1.value.w;
                this.material.uniforms.progress.value = 1;
                // Set the next image to texture1 and update the resolution
                this.material.uniforms.texture1.value = this.textures[this.nextImageIndex];
                this.updateTextureResolution(this.nextImageIndex, 1);
                // Start the tween for doing the transition
                RxjsTween.createTween(RxjsTween.linear, 1, 0, this.transitionDuration).subscribe({
                    next: val => {
                        this.material.uniforms.progress.value = val;
                    },
                    complete: () => {
                        // Set the transition flag to false to indicate that the transition animation is finished
                        this.tranistionOngoing = false;
                        // Reset progress to 1, thus the texture from texture 2 needs to be set to texture 1
                        this.material.uniforms.texture2.value = this.textures[this.nextImageIndex];
                        this.updateTextureResolution(this.nextImageIndex, 2);
                        this.material.uniforms.progress.value = 0;
                    }
                });
            }
            else {
                // Set the next image to texture2 and update the resolution
                this.material.uniforms.texture2.value = this.textures[this.nextImageIndex];
                this.updateTextureResolution(this.nextImageIndex, 2);
                // Start the tween for doing the transition
                RxjsTween.createTween(RxjsTween.linear, 0, 1, this.transitionDuration).subscribe({
                    next: val => {
                        this.material.uniforms.progress.value = val;
                    },
                    complete: () => {
                        // Set the transition flag to false to indicate that the transition animation is finished
                        this.tranistionOngoing = false;
                        // Reset progress to 0, thus the texture from texture 2 needs to be set to texture 1
                        this.material.uniforms.texture1.value = this.textures[this.nextImageIndex];
                        this.updateTextureResolution(this.nextImageIndex, 1);
                        this.material.uniforms.progress.value = 0;
                    }
                });
            }
        });
    }
    prepAndLoadNextImg(prev, autoPlayTriggered) {
        if (this.tranistionOngoing) {
            return;
        }
        if (this.pAutoPlay === true && autoPlayTriggered === false) {
            this.resetAutoPlayInterval();
        }
        if (prev === false) {
            // Set the next index
            this.nextImageIndex = (this.nextImageIndex < this.imageUrls.length - 1) ? this.nextImageIndex + 1 : 0;
            // Check if another texture needs to be loaded
            const nextButOne = this.nextImageIndex + 1 > this.imageUrls.length - 1 ? 0 : this.nextImageIndex + 1;
            if (this.textures[nextButOne] === undefined) {
                this.textures[nextButOne] = (new TextureLoader).load(this.imageUrls[nextButOne]);
            }
        }
        else {
            // Update the number of the current shown image
            this.nextImageIndex = (this.nextImageIndex > 0) ? this.nextImageIndex - 1 : this.imageUrls.length - 1;
            // Check if another texture needs to be loaded
            const nextButOne = this.nextImageIndex - 1 < 0 ? this.imageUrls.length - 1 : this.nextImageIndex - 1;
            if (this.textures[nextButOne] === undefined) {
                this.textures[nextButOne] = (new TextureLoader).load(this.imageUrls[nextButOne]);
            }
        }
        this.transitionToNextTexture();
    }
    //#region public methods
    next() {
        this.prepAndLoadNextImg(false, false);
    }
    prev() {
        this.prepAndLoadNextImg(true, false);
    }
}
ImageTransitionComponent.decorators = [
    { type: Component, args: [{
                selector: 'lib-image-transition',
                template: "<div #threejsContainer class=\"threejs-container\"></div>",
                styles: [".threejs-container{width:100%;height:100%}"]
            },] }
];
ImageTransitionComponent.ctorParameters = () => [
    { type: NgZone }
];
ImageTransitionComponent.propDecorators = {
    imageUrls: [{ type: Input }],
    imageSize: [{ type: Input }],
    autoPlay: [{ type: Input }],
    autoPlayInterval: [{ type: Input }],
    transitionDuration: [{ type: Input }],
    transitionType: [{ type: Input }],
    sizeX: [{ type: Input }],
    sizeY: [{ type: Input }],
    width: [{ type: Input }],
    intensity: [{ type: Input }],
    animationEnabled: [{ type: Input }],
    startIndex: [{ type: Input }],
    imageIndexChange: [{ type: Output }],
    threejsContainer: [{ type: ViewChild, args: ['threejsContainer',] }],
    resize: [{ type: HostListener, args: ['window:resize',] }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW1hZ2UtdHJhbnNpdGlvbi5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9uZ3gtYWN1dy9zcmMvbGliL2ltYWdlLXRyYW5zaXRpb24vaW1hZ2UtdHJhbnNpdGlvbi5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFpQixTQUFTLEVBQWMsWUFBWSxFQUFFLFlBQVksRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFhLE1BQU0sRUFBRSxTQUFTLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDOUksT0FBTyxFQUFFLFFBQVEsRUFBRSxVQUFVLEVBQUUsWUFBWSxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQzFELE9BQU8sRUFBRSxVQUFVLEVBQUUsSUFBSSxFQUFFLGlCQUFpQixFQUFFLG1CQUFtQixFQUFFLEtBQUssRUFBRSxjQUFjLEVBQVcsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLE9BQU8sQ0FBQztBQUN6SSxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sT0FBTyxDQUFDO0FBQ3RDLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUNoRCxPQUFPLEVBQUUsc0JBQXNCLEVBQUUsTUFBTSxrQ0FBa0MsQ0FBQztBQU8xRSxNQUFNLE9BQU8sd0JBQXdCO0lBbUhuQyxZQUFvQixNQUFjO1FBQWQsV0FBTSxHQUFOLE1BQU0sQ0FBUTtRQWpIekIsY0FBUyxHQUFhLElBQUksS0FBSyxFQUFVLENBQUM7UUFvQzFDLHVCQUFrQixHQUFHLElBQUksQ0FBQztRQStDMUIscUJBQWdCLEdBQUcsSUFBSSxDQUFDO1FBRXhCLGVBQVUsR0FBRyxDQUFDLENBQUM7UUFFZCxxQkFBZ0IsR0FBRyxJQUFJLFlBQVksRUFBVSxDQUFDO1FBRWhELGNBQVMsR0FBRyxLQUFLLENBQUM7UUFDbEIsc0JBQWlCLEdBQUcsSUFBSSxDQUFDO1FBQ3pCLGVBQVUsR0FBRyxPQUFPLENB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WSxTQUFDLGVBQWUiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBZnRlclZpZXdJbml0LCBDb21wb25lbnQsIEVsZW1lbnRSZWYsIEV2ZW50RW1pdHRlciwgSG9zdExpc3RlbmVyLCBJbnB1dCwgTmdab25lLCBPbkRlc3Ryb3ksIE91dHB1dCwgVmlld0NoaWxkIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBpbnRlcnZhbCwgT2JzZXJ2YWJsZSwgU3Vic2NyaXB0aW9uIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBEb3VibGVTaWRlLCBNZXNoLCBQZXJzcGVjdGl2ZUNhbWVyYSwgUGxhbmVCdWZmZXJHZW9tZXRyeSwgU2NlbmUsIFNoYWRlck1hdGVyaWFsLCBUZXh0dXJlLCBWZWN0b3I0LCBXZWJHTFJlbmRlcmVyIH0gZnJvbSAndGhyZWUnO1xuaW1wb3J0IHsgVGV4dHVyZUxvYWRlciB9IGZyb20gJ3RocmVlJztcbmltcG9ydCB7IFJ4anNUd2VlbiB9IGZyb20gJy4uL3R3ZWVuL3J4anMtdHdlZW4nO1xuaW1wb3J0IHsgSW1hZ2VUcmFuc2l0aW9uU2hhZGVycyB9IGZyb20gJy4vc2hhZGVycy9pbWFnZVRyYW5zaXRpb25TaGFkZXJzJztcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnbGliLWltYWdlLXRyYW5zaXRpb24nLFxuICB0ZW1wbGF0ZVVybDogJy4vaW1hZ2UtdHJhbnNpdGlvbi5jb21wb25lbnQuaHRtbCcsXG4gIHN0eWxlVXJsczogWycuL2ltYWdlLXRyYW5zaXRpb24uY29tcG9uZW50LmNzcyddXG59KVxuZXhwb3J0IGNsYXNzIEltYWdlVHJhbnNpdGlvbkNvbXBvbmVudCBpbXBsZW1lbnRzIEFmdGVyVmlld0luaXQsIE9uRGVzdHJveSB7XG5cbiAgQElucHV0KCkgaW1hZ2VVcmxzOiBzdHJpbmdbXSA9IG5ldyBBcnJheTxzdHJpbmc+KCk7XG5cbiAgQElucHV0KClcbiAgZ2V0IGltYWdlU2l6ZSgpOiBzdHJpbmcgeyByZXR1cm4gdGhpcy5wSW1hZ2VTaXplOyB9XG4gIHNldCBpbWFnZVNpemUoaW1hZ2VTaXplOiBzdHJpbmcpIHtcbiAgICB0aGlzLnBJbWFnZVNpemUgPSBpbWFnZVNpemU7XG4gICAgaWYgKHRoaXMubWVzaCAhPSBudWxsKSB7XG4gICAgICB0aGlzLnJlc2l6ZSgpO1xuICAgIH1cbiAgfVxuXG4gIEBJbnB1dCgpXG4gIGdldCBhdXRvUGxheSgpOiBib29sZWFuIHsgcmV0dXJuIHRoaXMucEF1dG9QbGF5OyB9XG4gIHNldCBhdXRvUGxheShhdXRvcGxheTogYm9vbGVhbikge1xuICAgIHRoaXMucEF1dG9QbGF5ID0gYXV0b3BsYXk7XG4gICAgaWYgKHRoaXMubWVzaCAhPSBudWxsKSB7XG4gICAgICBpZiAodGhpcy5wQXV0b1BsYXkgPT09IHRydWUpIHtcbiAgICAgICAgdGhpcy5zZXRBdXRvUGxheUludGVydmFsKCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLnN0b3BBdXRvUGxheUludGVydmFsKCk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgQElucHV0KClcbiAgZ2V0IGF1dG9QbGF5SW50ZXJ2YWwoKTogbnVtYmVyIHsgcmV0dXJuIHRoaXMucEF1dG9QbGF5SW50ZXJ2YWw7IH1cbiAgc2V0IGF1dG9QbGF5SW50ZXJ2YWwoYXV0b1BsYXlJbnRlcnZhbDogbnVtYmVyKSB7XG4gICAgdGhpcy5wQXV0b1BsYXlJbnRlcnZhbCA9IGF1dG9QbGF5SW50ZXJ2YWw7XG4gICAgaWYgKHRoaXMubWVzaCAhPSBudWxsKSB7XG4gICAgICBpZiAodGhpcy5wQXV0b1BsYXkgPT09IHRydWUpIHtcbiAgICAgICAgdGhpcy5zdG9wQXV0b1BsYXlJbnRlcnZhbCgpO1xuICAgICAgICB0aGlzLnNldEF1dG9QbGF5SW50ZXJ2YWwoKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBASW5wdXQoKSB0cmFuc2l0aW9uRHVyYXRpb24gPSAxMDAwO1xuXG4gIEBJbnB1dCgpXG4gIGdldCB0cmFuc2l0aW9uVHlwZSgpOiBzdHJpbmcgeyByZXR1cm4gdGhpcy5wVHJhbnNpdGlvblR5cGU7IH1cbiAgc2V0IHRyYW5zaXRpb25UeXBlKHRyYW5zaXRpb25UeXBlOiBzdHJpbmcpIHtcbiAgICB0aGlzLnBUcmFuc2l0aW9uVHlwZSA9IHRyYW5zaXRpb25UeXBlO1xuICAgIGlmICh0aGlzLm1hdGVyaWFsICE9IG51bGwpIHtcbiAgICAgIHRoaXMuc2V0U2hhZGVyUHJvcGVydGllcygpO1xuICAgIH1cbiAgfVxuXG4gIEBJbnB1dCgpXG4gIGdldCBzaXplWCgpOiBudW1iZXIgeyByZXR1cm4gdGhpcy5wU2NhbGVYOyB9XG4gIHNldCBzaXplWChzaXplWDogbnVtYmVyKSB7XG4gICAgdGhpcy5wU2NhbGVYID0gc2l6ZVg7XG4gICAgaWYgKHRoaXMubWF0ZXJpYWwgIT0gbnVsbCkge1xuICAgICAgdGhpcy5zZXRTaGFkZXJQcm9wZXJ0aWVzKCk7XG4gICAgfVxuICB9XG5cbiAgQElucHV0KClcbiAgZ2V0IHNpemVZKCk6IG51bWJlciB7IHJldHVybiB0aGlzLnBTY2FsZVk7IH1cbiAgc2V0IHNpemVZKHNpemVZOiBudW1iZXIpIHtcbiAgICB0aGlzLnBTY2FsZVkgPSBzaXplWTtcbiAgICBpZiAodGhpcy5tYXRlcmlhbCAhPSBudWxsKSB7XG4gICAgICB0aGlzLnNldFNoYWRlclByb3BlcnRpZXMoKTtcbiAgICB9XG4gIH1cblxuICBASW5wdXQoKVxuICBnZXQgd2lkdGgoKTogbnVtYmVyIHsgcmV0dXJuIHRoaXMucFdpZHRoOyB9XG4gIHNldCB3aWR0aCh3aWR0aDogbnVtYmVyKSB7XG4gICAgdGhpcy5wV2lkdGggPSB3aWR0aDtcbiAgICBpZiAodGhpcy5tYXRlcmlhbCAhPSBudWxsKSB7XG4gICAgICB0aGlzLnNldFNoYWRlclByb3BlcnRpZXMoKTtcbiAgICB9XG4gIH1cblxuICBASW5wdXQoKVxuICBnZXQgaW50ZW5zaXR5KCk6IG51bWJlciB7IHJldHVybiB0aGlzLmludGVuc2l0eTsgfVxuICBzZXQgaW50ZW5zaXR5KGludGVuc2l0eTogbnVtYmVyKSB7XG4gICAgdGhpcy5wSW50ZW5zaXR5ID0gaW50ZW5zaXR5O1xuICAgIGlmICh0aGlzLm1hdGVyaWFsICE9IG51bGwpIHtcbiAgICAgIHRoaXMuc2V0U2hhZGVyUHJvcGVydGllcygpO1xuICAgIH1cbiAgfVxuXG4gIEBJbnB1dCgpIGFuaW1hdGlvbkVuYWJsZWQgPSB0cnVlO1xuXG4gIEBJbnB1dCgpIHN0YXJ0SW5kZXggPSAwO1xuXG4gIEBPdXRwdXQoKSBpbWFnZUluZGV4Q2hhbmdlID0gbmV3IEV2ZW50RW1pdHRlcjxudW1iZXI+KCk7XG5cbiAgcHJpdmF0ZSBwQXV0b1BsYXkgPSBmYWxzZTtcbiAgcHJpdmF0ZSBwQXV0b1BsYXlJbnRlcnZhbCA9IDUwMDA7XG4gIHByaXZhdGUgcEltYWdlU2l6ZSA9ICdjb3Zlcic7XG4gIHByaXZhdGUgcFRyYW5zaXRpb25UeXBlID0gJ3NwbGl0JztcbiAgcHJpdmF0ZSBwSW50ZW5zaXR5ID0gNDAuMDtcbiAgcHJpdmF0ZSBwU2NhbGVYID0gNTAuMDtcbiAgcHJpdmF0ZSBwU2NhbGVZID0gNTAuMDtcbiAgcHJpdmF0ZSBwV2lkdGggPSAwLjU7XG5cbiAgcHJpdmF0ZSBhbmltYXRpb25GcmFtZUlkITogbnVtYmVyO1xuICBwcml2YXRlIHJlbmRlcmVyOiBXZWJHTFJlbmRlcmVyID0gbmV3IFdlYkdMUmVuZGVyZXIoeyBhbnRpYWxpYXM6IHRydWUsIGFscGhhOiB0cnVlIH0pO1xuICBwcml2YXRlIHNjZW5lOiBTY2VuZSA9IG5ldyBTY2VuZSgpO1xuICBwcml2YXRlIGNhbWVyYSE6IFBlcnNwZWN0aXZlQ2FtZXJhO1xuICBwcml2YXRlIG1lc2ghOiBNZXNoO1xuICBwcml2YXRlIG1hdGVyaWFsITogU2hhZGVyTWF0ZXJpYWw7XG4gIHByaXZhdGUgdGV4dHVyZXM6IFRleHR1cmVbXSA9IG5ldyBBcnJheTxUZXh0dXJlPigpO1xuICBwcml2YXRlIG5leHRJbWFnZUluZGV4ID0gMDtcbiAgcHJpdmF0ZSB0cmFuaXN0aW9uT25nb2luZyA9IGZhbHNlO1xuICBwcml2YXRlIHNoYWRlcnM6IEltYWdlVHJhbnNpdGlvblNoYWRlcnMgPSBuZXcgSW1hZ2VUcmFuc2l0aW9uU2hhZGVycygpO1xuICBwcml2YXRlIGF1dG9QbGF5JDogT2JzZXJ2YWJsZTxudW1iZXI+ID0gbmV3IE9ic2VydmFibGU8bnVtYmVyPigpO1xuICBwcml2YXRlIGF1dG9QbGF5U3Vic2NyaXB0aW9uOiBTdWJzY3JpcHRpb24gPSBuZXcgU3Vic2NyaXB0aW9uKCk7XG5cbiAgQFZpZXdDaGlsZCgndGhyZWVqc0NvbnRhaW5lcicpIHRocmVlanNDb250YWluZXIhOiBFbGVtZW50UmVmO1xuXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgbmdab25lOiBOZ1pvbmUpIHsgfVxuXG4gIG5nQWZ0ZXJWaWV3SW5pdCgpOiB2b2lkIHtcbiAgICAvLyBJbml0IGNhbWVyYVxuICAgIHRoaXMuY2FtZXJhID0gbmV3IFBlcnNwZWN0aXZlQ2FtZXJhKDcwLCB3aW5kb3cuaW5uZXJXaWR0aCAvIHdpbmRvdy5pbm5lckhlaWdodCwgMC4wMDEsIDEwMDApO1xuICAgIHRoaXMuY2FtZXJhLnBvc2l0aW9uLnNldCgwLCAwLCAyKTtcblxuICAgIC8vIENyZWF0ZSBzY2VuZVxuICAgIHRoaXMuc2NlbmUgPSBuZXcgU2NlbmUoKTtcblxuICAgIC8vIEluaXQgTWVzaFxuICAgIGlmICh0aGlzLmltYWdlVXJscy5sZW5ndGggPCAyKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0F0IGxlYXN0IHR3byBpbWFnZXMgYXJlIHJlcXVpcmVkJyk7XG4gICAgfVxuICAgIHRoaXMuaW5pdE1lc2goKTtcblxuICAgIC8vIEluaXQgcmVuZGVyZXJcbiAgICBjb25zdCBjYW52YXNXaWR0aCA9IHRoaXMudGhyZWVqc0NvbnRhaW5lci5uYXRpdmVFbGVtZW50LmNsaWVudFdpZHRoO1xuICAgIGNvbnN0IGNhbnZhc0hlaWdodCA9IHRoaXMudGhyZWVqc0NvbnRhaW5lci5uYXRpdmVFbGVtZW50LmNsaWVudEhlaWdodDtcbiAgICB0aGlzLnJlbmRlcmVyLnNldFNpemUoY2FudmFzV2lkdGgsIGNhbnZhc0hlaWdodCk7XG5cbiAgICB0aGlzLnRocmVlanNDb250YWluZXIubmF0aXZlRWxlbWVudC5hcHBlbmRDaGlsZCh0aGlzLnJlbmRlcmVyLmRvbUVsZW1lbnQpO1xuXG4gICAgLy8gSW5pdCBhdXRvUGxheSBPYnNlcnZhYmxlXG4gICAgaWYgKHRoaXMucEF1dG9QbGF5ID09PSB0cnVlKSB7XG4gICAgICB0aGlzLnNldEF1dG9QbGF5SW50ZXJ2YWwoKTtcbiAgICB9XG5cbiAgICB0aGlzLmFuaW1hdGUoKTtcbiAgfVxuXG4gIG5nT25EZXN0cm95KCk6IHZvaWQge1xuICAgIC8vIENhbmNlbCBBbmltYXRpb25cbiAgICBjYW5jZWxBbmltYXRpb25GcmFtZSh0aGlzLmFuaW1hdGlvbkZyYW1lSWQpO1xuICAgIC8vIFN0b3AgYXV0b3BsYXkgYW5pbWF0aW9uXG4gICAgdGhpcy5zdG9wQXV0b1BsYXlJbnRlcnZhbCgpO1xuICAgIC8vIFJlbW92ZSB0aHJlZWpzIGNvbnRhaW5lciBmcm9tIERPTVxuICAgICh0aGlzLnRocmVlanNDb250YWluZXIubmF0aXZlRWxlbWVudCBhcyBIVE1MQ2FudmFzRWxlbWVudCkucmVtb3ZlQ2hpbGQodGhpcy5yZW5kZXJlci5kb21FbGVtZW50KTtcbiAgICAvLyBEaXNwb3NlIHRleHR1cmVzXG4gICAgdGhpcy50ZXh0dXJlcy5mb3JFYWNoKHQgPT4ge1xuICAgICAgdC5kaXNwb3NlKCk7XG4gICAgfSk7XG4gICAgLy8gRGlzcG9zZSBtYXRlcmlhbFxuICAgIGlmKHRoaXMubWF0ZXJpYWwpIHsgdGhpcy5tYXRlcmlhbC5kaXNwb3NlKCk7IH1cbiAgICAvLyBDbGVhciBzY2VuZVxuICAgIGlmKHRoaXMuc2NlbmUpIHsgdGhpcy5zY2VuZS5jbGVhcigpOyB9XG4gICAgLy8gRGlzcG9zZSByZW5kZXJlclxuICAgIGlmKHRoaXMucmVuZGVyZXIpIHsgdGhpcy5yZW5kZXJlci5kaXNwb3NlKCk7IH1cbiAgfVxuXG4gIC8qKlxuICAgKiBJbml0aWFsaXplcyB0aGUgbWVzaFxuICAgKi9cbiAgcHJpdmF0ZSBpbml0TWVzaCgpOiB2b2lkIHtcbiAgICAvLyBDcmVhdGUgZ2VvbWV0cnlcbiAgICBjb25zdCBnZW9tZXRyeSA9IG5ldyBQbGFuZUJ1ZmZlckdlb21ldHJ5KDEsIDEsIDIsIDIpO1xuXG4gICAgY29uc3QgcHJvbWlzZXM6IFByb21pc2U8YW55PltdID0gbmV3IEFycmF5PFByb21pc2U8YW55Pj4oKTtcblxuICAgIC8vIExvYWQgcGV2LCBjdXJyZW50IGFuZCBuZXh0IHRleHR1cmVzXG4gICAgdGhpcy50ZXh0dXJlcyA9IG5ldyBBcnJheTxUZXh0dXJlPih0aGlzLmltYWdlVXJscy5sZW5ndGgpO1xuICAgIGNvbnN0IHByZXZJbWcgPSB0aGlzLnN0YXJ0SW5kZXggPT09IDAgPyAodGhpcy5pbWFnZVVybHMubGVuZ3RoIC0gMSkgOiAodGhpcy5zdGFydEluZGV4IC0gMSk7XG4gICAgY29uc3QgbmV4dEltZyA9IHRoaXMuc3RhcnRJbmRleCA9PT0gKHRoaXMuaW1hZ2VVcmxzLmxlbmd0aCAtIDEpID8gMCA6ICh0aGlzLnN0YXJ0SW5kZXggKyAxKTtcbiAgICBmb3IgKGxldCBpZHggPSAwOyBpZHggPCB0aGlzLmltYWdlVXJscy5sZW5ndGg7IGlkeCsrKSB7XG4gICAgICBpZiAoaWR4ID09PSB0aGlzLnN0YXJ0SW5kZXggfHwgaWR4ID09PSBuZXh0SW1nIHx8IGlkeCA9PT0gcHJldkltZykge1xuICAgICAgICBwcm9taXNlcy5wdXNoKG5ldyBQcm9taXNlKHJlc29sdmUgPT4ge1xuICAgICAgICAgIHRoaXMudGV4dHVyZXNbaWR4XSA9IChuZXcgVGV4dHVyZUxvYWRlcigpKS5sb2FkKHRoaXMuaW1hZ2VVcmxzW2lkeF0sIHJlc29sdmUpO1xuICAgICAgICB9KSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgdGhpcy5uZXh0SW1hZ2VJbmRleCA9IHRoaXMuc3RhcnRJbmRleDtcbiAgICAvLyBFbWl0IGV2ZW50IHRvIHNldCBjdXJyZW50IGltYWdlIGluZGV4XG4gICAgdGhpcy5pbWFnZUluZGV4Q2hhbmdlLmVtaXQodGhpcy5uZXh0SW1hZ2VJbmRleCk7XG5cbiAgICBQcm9taXNlLmFsbChwcm9taXNlcykudGhlbigoKSA9PiB7XG5cbiAgICAgIHRoaXMubWF0ZXJpYWwgPSBuZXcgU2hhZGVyTWF0ZXJpYWwoe1xuICAgICAgICBzaWRlOiBEb3VibGVTaWRlLFxuICAgICAgICB1bmlmb3Jtczoge1xuICAgICAgICAgIHRpbWU6IHsgdmFsdWU6IDAgfSxcbiAgICAgICAgICBwcm9ncmVzczogeyB2YWx1ZTogMCB9LFxuICAgICAgICAgIGJvcmRlcjogeyB2YWx1ZTogMCB9LFxuICAgICAgICAgIGludGVuc2l0eTogeyB2YWx1ZTogNTAuMCB9LFxuICAgICAgICAgIHNjYWxlWDogeyB2YWx1ZTogNDAuMCB9LFxuICAgICAgICAgIHNjYWxlWTogeyB2YWx1ZTogNDAuMCB9LFxuICAgICAgICAgIHRyYW5zaXRpb246IHsgdmFsdWU6IDQwLjAgfSxcbiAgICAgICAgICBzd2lwZTogeyB2YWx1ZTogMCB9LFxuICAgICAgICAgIHdpZHRoOiB7IHZhbHVlOiAwLjUgfSxcbiAgICAgICAgICByYWRpdXM6IHsgdmFsdWU6IDAgfSxcbiAgICAgICAgICB0ZXh0dXJlMTogeyB2YWx1ZTogdGhpcy50ZXh0dXJlc1t0aGlzLnN0YXJ0SW5kZXhdIH0sXG4gICAgICAgICAgdGV4dHVyZTI6IHsgdmFsdWU6IHRoaXMudGV4dHVyZXNbbmV4dEltZ10gfSxcbiAgICAgICAgICByZXNvbHV0aW9uMTogeyB2YWx1ZTogbmV3IFZlY3RvcjQoKSB9LFxuICAgICAgICAgIHJlc29sdXRpb24yOiB7IHZhbHVlOiBuZXcgVmVjdG9yNCgpIH1cbiAgICAgICAgfSxcbiAgICAgICAgLy8gd2lyZWZyYW1lOiB0cnVlLFxuICAgICAgICB2ZXJ0ZXhTaGFkZXI6IHRoaXMuc2hhZGVycy52ZXJ0ZXhcbiAgICAgIH0pO1xuXG4gICAgICB0aGlzLnNldFNoYWRlclByb3BlcnRpZXMoKTtcbiAgICAgIHRoaXMubWVzaCA9IG5ldyBNZXNoKGdlb21ldHJ5LCB0aGlzLm1hdGVyaWFsKTtcblxuICAgICAgdGhpcy5zY2VuZS5hZGQodGhpcy5tZXNoKTtcblxuICAgICAgdGhpcy5yZXNpemUoKTtcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTZXRzIHRoZSBhdXRvUGxheSBpbnRlcnZhbFxuICAgKi9cbiAgcHJpdmF0ZSBzZXRBdXRvUGxheUludGVydmFsKCk6IHZvaWQge1xuICAgIHRoaXMuYXV0b1BsYXkkID0gaW50ZXJ2YWwodGhpcy5wQXV0b1BsYXlJbnRlcnZhbCk7XG4gICAgdGhpcy5hdXRvUGxheVN1YnNjcmlwdGlvbiA9IHRoaXMuYXV0b1BsYXkkLnN1YnNjcmliZSh7XG4gICAgICBuZXh0OiAoKSA9PiB7IHRoaXMucHJlcEFuZExvYWROZXh0SW1nKGZhbHNlLCB0cnVlKTsgfVxuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlc2V0cyB0aGUgYXV0b1BsYXkgaW50ZXJ2YWxcbiAgICovXG4gIHByaXZhdGUgcmVzZXRBdXRvUGxheUludGVydmFsKCk6IHZvaWQge1xuICAgIHRoaXMuYXV0b1BsYXlTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcbiAgICB0aGlzLmF1dG9QbGF5U3Vic2NyaXB0aW9uID0gdGhpcy5hdXRvUGxheSQuc3Vic2NyaWJlKHtcbiAgICAgIG5leHQ6ICgpID0+IHsgdGhpcy5wcmVwQW5kTG9hZE5leHRJbWcoZmFsc2UsIHRydWUpOyB9XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogU3RvcHMgdGhlIGF1dG9QbGF5IGludGVydmFsXG4gICAqL1xuICBwcml2YXRlIHN0b3BBdXRvUGxheUludGVydmFsKCk6IHZvaWQge1xuICAgIHRoaXMuYXV0b1BsYXlTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTZXRzIHRoZSBzaGFkZXIgcHJvcGVydGllcyBkZXBlbmRpbmcgb24gdGhlIHRyYW5zaXRpb24gdHlwZVxuICAgKi9cbiAgcHJpdmF0ZSBzZXRTaGFkZXJQcm9wZXJ0aWVzKCk6IHZvaWQge1xuICAgIHN3aXRjaCAodGhpcy50cmFuc2l0aW9uVHlwZSkge1xuICAgICAgY2FzZSAnc3BsaXQnOlxuICAgICAgICB0aGlzLm1hdGVyaWFsLnVuaWZvcm1zLmludGVuc2l0eS52YWx1ZSA9IHRoaXMucEludGVuc2l0eTtcbiAgICAgICAgdGhpcy5tYXRlcmlhbC5mcmFnbWVudFNoYWRlciA9IHRoaXMuc2hhZGVycy5zcGxpdFRyYW5zaXRpb25GcmFnO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ2ZhZGUnOlxuICAgICAgICB0aGlzLm1hdGVyaWFsLmZyYWdtZW50U2hhZGVyID0gdGhpcy5zaGFkZXJzLmZhZGVGcmFnO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ25vaXNlJzpcbiAgICAgICAgdGhpcy5tYXRlcmlhbC51bmlmb3Jtcy5zY2FsZVgudmFsdWUgPSB0aGlzLnBTY2FsZVg7XG4gICAgICAgIHRoaXMubWF0ZXJpYWwudW5pZm9ybXMuc2NhbGVZLnZhbHVlID0gdGhpcy5wU2NhbGVZO1xuICAgICAgICB0aGlzLm1hdGVyaWFsLnVuaWZvcm1zLndpZHRoLnZhbHVlID0gdGhpcy5wV2lkdGg7XG4gICAgICAgIHRoaXMubWF0ZXJpYWwuZnJhZ21lbnRTaGFkZXIgPSB0aGlzLnNoYWRlcnMubm9pc2VGcmFnO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ2JsdXInOlxuICAgICAgICB0aGlzLm1hdGVyaWFsLnVuaWZvcm1zLmludGVuc2l0eS52YWx1ZSA9IHRoaXMucEludGVuc2l0eTtcbiAgICAgICAgdGhpcy5tYXRlcmlhbC5mcmFnbWVudFNoYWRlciA9IHRoaXMuc2hhZGVycy5ibHVyRnJhZztcbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICBicmVhaztcbiAgICB9XG5cbiAgICB0aGlzLm1hdGVyaWFsLm5lZWRzVXBkYXRlID0gdHJ1ZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBBbmltYXRpb25cbiAgICovXG4gIHByaXZhdGUgYW5pbWF0ZSgpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5hbmltYXRpb25FbmFibGVkID09PSB0cnVlKSB7XG4gICAgICB0aGlzLnJlbmRlcmVyLnJlbmRlcih0aGlzLnNjZW5lLCB0aGlzLmNhbWVyYSk7XG4gICAgfVxuICAgIHRoaXMubmdab25lLnJ1bk91dHNpZGVBbmd1bGFyKCgpID0+IHtcbiAgICAgIHRoaXMuYW5pbWF0aW9uRnJhbWVJZCA9IHdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUoKCkgPT4gdGhpcy5hbmltYXRlKCkpO1xuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlc2l6ZXMgdGhlIGNhbnZhcyBhbmQgdXBkYXRlcyB0aGUgdGV4dHVyZSByZXN1bHV0aW9uIGluZm9ybWF0aW9uIG9mIHRoZSBpbWFnZXNcbiAgICovXG4gIEBIb3N0TGlzdGVuZXIoJ3dpbmRvdzpyZXNpemUnKSBwcml2YXRlIHJlc2l6ZSgpOiB2b2lkIHtcbiAgICAvLyBHZXQgdGhlIHdpdGggYW5kIGhlaWdodCBvZiB0aGUgY29udGFpbmVyXG4gICAgY29uc3QgY29udGFpbmVyV2lkdGggPSB0aGlzLnRocmVlanNDb250YWluZXIubmF0aXZlRWxlbWVudC5vZmZzZXRXaWR0aDtcbiAgICBjb25zdCBjb250YWluZXJIZWlnaHQgPSB0aGlzLnRocmVlanNDb250YWluZXIubmF0aXZlRWxlbWVudC5vZmZzZXRIZWlnaHQ7XG4gICAgLy8gcmV0dXJuIHRoZSBmdW5jdGlvbiwgaWYgZWlodGVyIHdpdGggb3IgaGVpZ3RoIGlzIHVuZGVmaW5lZFxuICAgIGlmKCFjb250YWluZXJIZWlnaHQgfHwgIWNvbnRhaW5lckhlaWdodCkgeyByZXR1cm47IH1cblxuICAgIHRoaXMucmVuZGVyZXIuc2V0U2l6ZShjb250YWluZXJXaWR0aCwgY29udGFpbmVySGVpZ2h0KTtcbiAgICB0aGlzLmNhbWVyYS5hc3BlY3QgPSBjb250YWluZXJXaWR0aCAvIGNvbnRhaW5lckhlaWdodDtcblxuICAgIHRoaXMudXBkYXRlVGV4dHVyZVJlc29sdXRpb24odGhpcy5uZXh0SW1hZ2VJbmRleCwgMSk7XG5cbiAgICBjb25zdCBkaXN0ID0gdGhpcy5jYW1lcmEucG9zaXRpb24uejtcbiAgICBjb25zdCBoZWlnaHQgPSAxO1xuICAgIHRoaXMuY2FtZXJhLmZvdiA9IDIgKiAoMTgwIC8gTWF0aC5QSSkgKiBNYXRoLmF0YW4oaGVpZ2h0IC8gKDIgKiBkaXN0KSk7XG5cbiAgICB0aGlzLm1lc2guc2NhbGUueCA9IHRoaXMuY2FtZXJhLmFzcGVjdDtcbiAgICB0aGlzLm1lc2guc2NhbGUueSA9IDE7XG5cbiAgICB0aGlzLmNhbWVyYS51cGRhdGVQcm9qZWN0aW9uTWF0cml4KCk7XG4gIH1cblxuICAvKipcbiAgICogVXBkYXRlcyB0aGUgcmVzdWx1dGlvbiBvZiB0aGUgdGV4dHVyZSBmb3IgdGhlIHNoYWRlciBkZXBlbmRpbmcgb24gdGhlIGltYWdlIHNpemUgdHlwZVxuICAgKiBAcGFyYW0gdGV4dHVyZU51bWJlciBOdW1iZXIgb2YgdGhlIHRleHR1cmVcbiAgICovXG4gIHByaXZhdGUgdXBkYXRlVGV4dHVyZVJlc29sdXRpb24odGV4dHVyZU51bWJlcjogbnVtYmVyLCB0YXJnZXRHbHNsVGV4dHVyZTogMSB8IDIpOiB2b2lkIHtcbiAgICBjb25zdCB0ZXh0dXJlID0gdGhpcy50ZXh0dXJlc1t0ZXh0dXJlTnVtYmVyXTtcbiAgICBjb25zdCBjb250YWluZXJXaWR0aCA9IHRoaXMudGhyZWVqc0NvbnRhaW5lci5uYXRpdmVFbGVtZW50Lm9mZnNldFdpZHRoO1xuICAgIGNvbnN0IGNvbnRhaW5lckhlaWdodCA9IHRoaXMudGhyZWVqc0NvbnRhaW5lci5uYXRpdmVFbGVtZW50Lm9mZnNldEhlaWdodDtcblxuICAgIC8vIEFkYXB0IHRoZSBzaXplIG9mIHRoZSBpbWFnZVxuICAgIGNvbnN0IGltYWdlQXNwZWN0ID0gdGV4dHVyZS5pbWFnZS5oZWlnaHQgLyB0ZXh0dXJlLmltYWdlLndpZHRoO1xuICAgIGNvbnN0IGNvbnRhaW5lckFzcGVjdCA9IGNvbnRhaW5lckhlaWdodCAvIGNvbnRhaW5lcldpZHRoO1xuICAgIGxldCBhMTsgbGV0IGEyO1xuICAgIGlmICh0aGlzLnBJbWFnZVNpemUgPT09ICdjb3ZlcicpIHtcbiAgICAgIGlmIChjb250YWluZXJBc3BlY3QgPiBpbWFnZUFzcGVjdCkge1xuICAgICAgICBhMSA9IChjb250YWluZXJXaWR0aCAvIGNvbnRhaW5lckhlaWdodCkgKiBpbWFnZUFzcGVjdDtcbiAgICAgICAgYTIgPSAxO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgYTEgPSAxO1xuICAgICAgICBhMiA9IChjb250YWluZXJIZWlnaHQgLyBjb250YWluZXJXaWR0aCkgLyBpbWFnZUFzcGVjdDtcbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKHRoaXMucEltYWdlU2l6ZSA9PT0gJ2NvbnRhaW4nKSB7XG4gICAgICBpZiAoY29udGFpbmVyQXNwZWN0IDwgaW1hZ2VBc3BlY3QpIHtcbiAgICAgICAgYTEgPSAoY29udGFpbmVyV2lkdGggLyBjb250YWluZXJIZWlnaHQpICogaW1hZ2VBc3BlY3Q7XG4gICAgICAgIGEyID0gMTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGExID0gMTtcbiAgICAgICAgYTIgPSAoY29udGFpbmVySGVpZ2h0IC8gY29udGFpbmVyV2lkdGgpIC8gaW1hZ2VBc3BlY3Q7XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKHRhcmdldEdsc2xUZXh0dXJlID09PSAxKSB7XG4gICAgICB0aGlzLm1hdGVyaWFsLnVuaWZvcm1zLnJlc29sdXRpb24xLnZhbHVlLnggPSBjb250YWluZXJXaWR0aDtcbiAgICAgIHRoaXMubWF0ZXJpYWwudW5pZm9ybXMucmVzb2x1dGlvbjEudmFsdWUueSA9IGNvbnRhaW5lckhlaWdodDtcbiAgICAgIHRoaXMubWF0ZXJpYWwudW5pZm9ybXMucmVzb2x1dGlvbjEudmFsdWUueiA9IGExO1xuICAgICAgdGhpcy5tYXRlcmlhbC51bmlmb3Jtcy5yZXNvbHV0aW9uMS52YWx1ZS53ID0gYTI7XG4gICAgfSBlbHNlIGlmICh0YXJnZXRHbHNsVGV4dHVyZSA9PT0gMikge1xuICAgICAgdGhpcy5tYXRlcmlhbC51bmlmb3Jtcy5yZXNvbHV0aW9uMi52YWx1ZS54ID0gY29udGFpbmVyV2lkdGg7XG4gICAgICB0aGlzLm1hdGVyaWFsLnVuaWZvcm1zLnJlc29sdXRpb24yLnZhbHVlLnkgPSBjb250YWluZXJIZWlnaHQ7XG4gICAgICB0aGlzLm1hdGVyaWFsLnVuaWZvcm1zLnJlc29sdXRpb24yLnZhbHVlLnogPSBhMTtcbiAgICAgIHRoaXMubWF0ZXJpYWwudW5pZm9ybXMucmVzb2x1dGlvbjIudmFsdWUudyA9IGEyO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBTdGFydHMgdGhlIHRyYW5zaXRpb24gZWZmZWN0IHRvIHRoZSBuZXh0IGltYWdlXG4gICAqIEBwYXJhbSBwb3NEaXJlY3Rpb24gaW5kaWNhdG9yLCBpZiB0aGUgbmV4dCBvciBwcmV2aW91cyBpbWFnZSBzaG91bGQgYmUgbG9hZGVkXG4gICAqL1xuICBwcml2YXRlIHRyYW5zaXRpb25Ub05leHRUZXh0dXJlKGJhY2t3ID0gZmFsc2UpOiB2b2lkIHtcbiAgICAvLyBTZXQgdGhlIGZsYWcgdG8gaW5kaWNhdGUgdGhhdCB0aGUgdHJhbnNpdGlvbiBhbmltYXRpb24gaXMgb25nb2luZ1xuICAgIHRoaXMudHJhbmlzdGlvbk9uZ29pbmcgPSB0cnVlO1xuICAgIC8vIEV2ZW50RW1pdHRlclxuICAgIHRoaXMuaW1hZ2VJbmRleENoYW5nZS5lbWl0KHRoaXMubmV4dEltYWdlSW5kZXgpO1xuXG4gICAgdGhpcy5uZ1pvbmUucnVuT3V0c2lkZUFuZ3VsYXIoKCkgPT4ge1xuICAgICAgaWYgKGJhY2t3ID09PSB0cnVlKSB7XG4gICAgICAgIHRoaXMubWF0ZXJpYWwudW5pZm9ybXMudGV4dHVyZTIudmFsdWUgPSB0aGlzLm1hdGVyaWFsLnVuaWZvcm1zLnRleHR1cmUxLnZhbHVlO1xuICAgICAgICB0aGlzLm1hdGVyaWFsLnVuaWZvcm1zLnJlc29sdXRpb24yLnZhbHVlLnggPSB0aGlzLm1hdGVyaWFsLnVuaWZvcm1zLnJlc29sdXRpb24xLnZhbHVlLng7XG4gICAgICAgIHRoaXMubWF0ZXJpYWwudW5pZm9ybXMucmVzb2x1dGlvbjIudmFsdWUueSA9IHRoaXMubWF0ZXJpYWwudW5pZm9ybXMucmVzb2x1dGlvbjEudmFsdWUueTtcbiAgICAgICAgdGhpcy5tYXRlcmlhbC51bmlmb3Jtcy5yZXNvbHV0aW9uMi52YWx1ZS56ID0gdGhpcy5tYXRlcmlhbC51bmlmb3Jtcy5yZXNvbHV0aW9uMS52YWx1ZS56O1xuICAgICAgICB0aGlzLm1hdGVyaWFsLnVuaWZvcm1zLnJlc29sdXRpb24yLnZhbHVlLncgPSB0aGlzLm1hdGVyaWFsLnVuaWZvcm1zLnJlc29sdXRpb24xLnZhbHVlLnc7XG4gICAgICAgIHRoaXMubWF0ZXJpYWwudW5pZm9ybXMucHJvZ3Jlc3MudmFsdWUgPSAxO1xuICAgICAgICAvLyBTZXQgdGhlIG5leHQgaW1hZ2UgdG8gdGV4dHVyZTEgYW5kIHVwZGF0ZSB0aGUgcmVzb2x1dGlvblxuICAgICAgICB0aGlzLm1hdGVyaWFsLnVuaWZvcm1zLnRleHR1cmUxLnZhbHVlID0gdGhpcy50ZXh0dXJlc1t0aGlzLm5leHRJbWFnZUluZGV4XTtcbiAgICAgICAgdGhpcy51cGRhdGVUZXh0dXJlUmVzb2x1dGlvbih0aGlzLm5leHRJbWFnZUluZGV4LCAxKTtcbiAgXG4gICAgICAgIC8vIFN0YXJ0IHRoZSB0d2VlbiBmb3IgZG9pbmcgdGhlIHRyYW5zaXRpb25cbiAgICAgICAgUnhqc1R3ZWVuLmNyZWF0ZVR3ZWVuKFJ4anNUd2Vlbi5saW5lYXIsIDEsIDAsIHRoaXMudHJhbnNpdGlvbkR1cmF0aW9uKS5zdWJzY3JpYmUoe1xuICAgICAgICAgIG5leHQ6IHZhbCA9PiB7XG4gICAgICAgICAgICB0aGlzLm1hdGVyaWFsLnVuaWZvcm1zLnByb2dyZXNzLnZhbHVlID0gdmFsO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgY29tcGxldGU6ICgpID0+IHtcbiAgICAgICAgICAgIC8vIFNldCB0aGUgdHJhbnNpdGlvbiBmbGFnIHRvIGZhbHNlIHRvIGluZGljYXRlIHRoYXQgdGhlIHRyYW5zaXRpb24gYW5pbWF0aW9uIGlzIGZpbmlzaGVkXG4gICAgICAgICAgICB0aGlzLnRyYW5pc3Rpb25PbmdvaW5nID0gZmFsc2U7XG4gICAgICAgICAgICAvLyBSZXNldCBwcm9ncmVzcyB0byAxLCB0aHVzIHRoZSB0ZXh0dXJlIGZyb20gdGV4dHVyZSAyIG5lZWRzIHRvIGJlIHNldCB0byB0ZXh0dXJlIDFcbiAgICAgICAgICAgIHRoaXMubWF0ZXJpYWwudW5pZm9ybXMudGV4dHVyZTIudmFsdWUgPSB0aGlzLnRleHR1cmVzW3RoaXMubmV4dEltYWdlSW5kZXhdO1xuICAgICAgICAgICAgdGhpcy51cGRhdGVUZXh0dXJlUmVzb2x1dGlvbih0aGlzLm5leHRJbWFnZUluZGV4LCAyKTtcbiAgICAgICAgICAgIHRoaXMubWF0ZXJpYWwudW5pZm9ybXMucHJvZ3Jlc3MudmFsdWUgPSAwO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBTZXQgdGhlIG5leHQgaW1hZ2UgdG8gdGV4dHVyZTIgYW5kIHVwZGF0ZSB0aGUgcmVzb2x1dGlvblxuICAgICAgICB0aGlzLm1hdGVyaWFsLnVuaWZvcm1zLnRleHR1cmUyLnZhbHVlID0gdGhpcy50ZXh0dXJlc1t0aGlzLm5leHRJbWFnZUluZGV4XTtcbiAgICAgICAgdGhpcy51cGRhdGVUZXh0dXJlUmVzb2x1dGlvbih0aGlzLm5leHRJbWFnZUluZGV4LCAyKTtcbiAgXG4gICAgICAgIC8vIFN0YXJ0IHRoZSB0d2VlbiBmb3IgZG9pbmcgdGhlIHRyYW5zaXRpb25cbiAgICAgICAgUnhqc1R3ZWVuLmNyZWF0ZVR3ZWVuKFJ4anNUd2Vlbi5saW5lYXIsIDAsIDEsIHRoaXMudHJhbnNpdGlvbkR1cmF0aW9uKS5zdWJzY3JpYmUoe1xuICAgICAgICAgIG5leHQ6IHZhbCA9PiB7XG4gICAgICAgICAgICB0aGlzLm1hdGVyaWFsLnVuaWZvcm1zLnByb2dyZXNzLnZhbHVlID0gdmFsO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgY29tcGxldGU6ICgpID0+IHtcbiAgICAgICAgICAgIC8vIFNldCB0aGUgdHJhbnNpdGlvbiBmbGFnIHRvIGZhbHNlIHRvIGluZGljYXRlIHRoYXQgdGhlIHRyYW5zaXRpb24gYW5pbWF0aW9uIGlzIGZpbmlzaGVkXG4gICAgICAgICAgICB0aGlzLnRyYW5pc3Rpb25PbmdvaW5nID0gZmFsc2U7XG4gICAgICAgICAgICAvLyBSZXNldCBwcm9ncmVzcyB0byAwLCB0aHVzIHRoZSB0ZXh0dXJlIGZyb20gdGV4dHVyZSAyIG5lZWRzIHRvIGJlIHNldCB0byB0ZXh0dXJlIDFcbiAgICAgICAgICAgIHRoaXMubWF0ZXJpYWwudW5pZm9ybXMudGV4dHVyZTEudmFsdWUgPSB0aGlzLnRleHR1cmVzW3RoaXMubmV4dEltYWdlSW5kZXhdO1xuICAgICAgICAgICAgdGhpcy51cGRhdGVUZXh0dXJlUmVzb2x1dGlvbih0aGlzLm5leHRJbWFnZUluZGV4LCAxKTtcbiAgICAgICAgICAgIHRoaXMubWF0ZXJpYWwudW5pZm9ybXMucHJvZ3Jlc3MudmFsdWUgPSAwO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIHByZXBBbmRMb2FkTmV4dEltZyhwcmV2OiBib29sZWFuLCBhdXRvUGxheVRyaWdnZXJlZDogYm9vbGVhbikge1xuICAgIGlmICh0aGlzLnRyYW5pc3Rpb25PbmdvaW5nKSB7IHJldHVybjsgfVxuXG4gICAgaWYgKHRoaXMucEF1dG9QbGF5ID09PSB0cnVlICYmIGF1dG9QbGF5VHJpZ2dlcmVkID09PSBmYWxzZSkgeyB0aGlzLnJlc2V0QXV0b1BsYXlJbnRlcnZhbCgpOyB9XG5cbiAgICBpZiAocHJldiA9PT0gZmFsc2UpIHtcbiAgICAgIC8vIFNldCB0aGUgbmV4dCBpbmRleFxuICAgICAgdGhpcy5uZXh0SW1hZ2VJbmRleCA9ICh0aGlzLm5leHRJbWFnZUluZGV4IDwgdGhpcy5pbWFnZVVybHMubGVuZ3RoIC0gMSkgPyB0aGlzLm5leHRJbWFnZUluZGV4ICsgMSA6IDA7XG4gICAgICAvLyBDaGVjayBpZiBhbm90aGVyIHRleHR1cmUgbmVlZHMgdG8gYmUgbG9hZGVkXG4gICAgICBjb25zdCBuZXh0QnV0T25lID0gdGhpcy5uZXh0SW1hZ2VJbmRleCArIDEgPiB0aGlzLmltYWdlVXJscy5sZW5ndGggLSAxID8gMCA6IHRoaXMubmV4dEltYWdlSW5kZXggKyAxO1xuICAgICAgaWYgKHRoaXMudGV4dHVyZXNbbmV4dEJ1dE9uZV0gPT09IHVuZGVmaW5lZCkge1xuICAgICAgICB0aGlzLnRleHR1cmVzW25leHRCdXRPbmVdID0gKG5ldyBUZXh0dXJlTG9hZGVyKS5sb2FkKHRoaXMuaW1hZ2VVcmxzW25leHRCdXRPbmVdKTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgLy8gVXBkYXRlIHRoZSBudW1iZXIgb2YgdGhlIGN1cnJlbnQgc2hvd24gaW1hZ2VcbiAgICAgIHRoaXMubmV4dEltYWdlSW5kZXggPSAodGhpcy5uZXh0SW1hZ2VJbmRleCA+IDApID8gdGhpcy5uZXh0SW1hZ2VJbmRleCAtIDEgOiB0aGlzLmltYWdlVXJscy5sZW5ndGggLSAxO1xuICAgICAgLy8gQ2hlY2sgaWYgYW5vdGhlciB0ZXh0dXJlIG5lZWRzIHRvIGJlIGxvYWRlZFxuICAgICAgY29uc3QgbmV4dEJ1dE9uZSA9IHRoaXMubmV4dEltYWdlSW5kZXggLSAxIDwgMCA/IHRoaXMuaW1hZ2VVcmxzLmxlbmd0aCAtIDEgOiB0aGlzLm5leHRJbWFnZUluZGV4IC0gMTtcbiAgICAgIGlmICh0aGlzLnRleHR1cmVzW25leHRCdXRPbmVdID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgdGhpcy50ZXh0dXJlc1tuZXh0QnV0T25lXSA9IChuZXcgVGV4dHVyZUxvYWRlcikubG9hZCh0aGlzLmltYWdlVXJsc1tuZXh0QnV0T25lXSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgdGhpcy50cmFuc2l0aW9uVG9OZXh0VGV4dHVyZSgpO1xuICB9XG5cbiAgLy8jcmVnaW9uIHB1YmxpYyBtZXRob2RzXG4gIG5leHQoKTogdm9pZCB7XG4gICAgdGhpcy5wcmVwQW5kTG9hZE5leHRJbWcoZmFsc2UsIGZhbHNlKTtcbiAgfVxuXG4gIHByZXYoKTogdm9pZCB7XG4gICAgdGhpcy5wcmVwQW5kTG9hZE5leHRJbWcodHJ1ZSwgZmFsc2UpO1xuICB9XG4gIC8vI2VuZHJlZ2lvblxufVxuIl19