!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@angular/forms"),require("@taiga-ui/cdk"),require("@taiga-ui/core"),require("@taiga-ui/kit/tokens"),require("@taiga-ui/kit/utils/files"),require("rxjs"),require("rxjs/operators"),require("@angular/common"),require("@taiga-ui/kit/components/files"),require("@tinkoff/ng-polymorpheus"),require("@taiga-ui/kit/utils")):"function"==typeof define&&define.amd?define("@taiga-ui/kit/components/input-files",["exports","@angular/core","@angular/forms","@taiga-ui/cdk","@taiga-ui/core","@taiga-ui/kit/tokens","@taiga-ui/kit/utils/files","rxjs","rxjs/operators","@angular/common","@taiga-ui/kit/components/files","@tinkoff/ng-polymorpheus","@taiga-ui/kit/utils"],t):t(((e=e||self)["taiga-ui"]=e["taiga-ui"]||{},e["taiga-ui"].kit=e["taiga-ui"].kit||{},e["taiga-ui"].kit.components=e["taiga-ui"].kit.components||{},e["taiga-ui"].kit.components["input-files"]={}),e.ng.core,e.ng.forms,e.cdk,e.core$1,e["taiga-ui"].kit.tokens,e["taiga-ui"].kit.utils.files,e.rxjs,e.rxjs.operators,e.ng.common,e["taiga-ui"].kit.components.files,e.ngPolymorpheus,e["taiga-ui"].kit.utils)}(this,(function(e,t,i,n,a,r,o,u,p,l,c,s,d){"use strict";var f=function(e,t){return(f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])})(e,t)};function m(e,t,i,n){var a,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var u=e.length-1;u>=0;u--)(a=e[u])&&(o=(r<3?a(o):r>3?a(t,i,o):a(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o}function g(e,t){return function(i,n){t(i,n,e)}}Object.create;function y(e,t){var i="function"==typeof Symbol&&e[Symbol.iterator];if(!i)return e;var n,a,r=i.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(n=r.next()).done;)o.push(n.value)}catch(e){a={error:e}}finally{try{n&&!n.done&&(i=r.return)&&i.call(r)}finally{if(a)throw a.error}}return o}function v(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(y(arguments[t]));return e}Object.create;var h=function(e){function l(i,n,a,r){var o=e.call(this,i,n)||this;return o.isMobile=a,o.inputFileTexts$=r,o.dataTransfer=null,o.link="",o.label="",o.accept="",o.multiple=!1,o.size="m",o.maxFileSize=31457280,o.reject=new t.EventEmitter,o}var c;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=e}f(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}(l,e),c=l,Object.defineProperty(l.prototype,"nativeFocusableElement",{get:function(){var e;return(null===(e=this.input)||void 0===e?void 0:e.nativeElement)||null},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"focused",{get:function(){return n.isNativeFocused(this.nativeFocusableElement)},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"computedPseudoHovered",{get:function(){var e;return null!==(e=this.pseudoHovered)&&void 0!==e?e:this.fileDragged||null},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"computedLink$",{get:function(){return this.computeLink$(this.fileDragged,this.multiple,this.link)},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"computedLabel$",{get:function(){return this.computeLabel$(this.isMobile,this.fileDragged,this.multiple,this.label)},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"fileDragged",{get:function(){var e;return!!(null===(e=this.dataTransfer)||void 0===e?void 0:e.types.includes("Files"))},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"arrayValue",{get:function(){return this.getValueArray(this.value)},enumerable:!0,configurable:!0}),l.prototype.onHovered=function(e){this.updateHovered(e)},l.prototype.onFocused=function(e){this.updateFocused(e)},l.prototype.onPressed=function(e){this.updatePressed(e)},l.prototype.onFilesSelected=function(e,t,i){this.processSelectedFiles(e.files,{formatRejection:t,maxSizeRejection:i}),e.value=""},l.prototype.onDropped=function(e,t,i){this.processSelectedFiles(e.files,{formatRejection:t,maxSizeRejection:i})},l.prototype.onDragOver=function(e){this.dataTransfer=e},l.prototype.removeFile=function(e){this.updateValue(this.multiple?this.arrayValue.filter((function(t){return t!==e})):null)},l.prototype.computeLink$=function(e,t,i){return e?u.of(""):this.inputFileTexts$.pipe(p.map((function(e){return t&&""===i?e.defaultLinkMultiple:i||e.defaultLinkSingle})))},l.prototype.computeLabel$=function(e,t,i,n){return e?u.of(""):t?this.inputFileTexts$.pipe(p.map((function(e){return i?e.dropMultiple:e.drop}))):this.inputFileTexts$.pipe(p.map((function(e){return i&&""===n?e.defaultLabelMultiple:n||e.defaultLabelSingle})))},l.prototype.getValueArray=function(e){return e?Array.isArray(e)?e:[e]:n.EMPTY_ARRAY},l.prototype.processSelectedFiles=function(e,t){var i=this;if(null==e?void 0:e.length){var n=this.multiple?Array.from(e):[e[0]],a=n.filter((function(e){return e.size>i.maxFileSize})),r=n.filter((function(e){return!i.isFormatAcceptable(e)&&!a.includes(e)})),o=n.filter((function(e){return!a.includes(e)&&!r.includes(e)}));(a.length||r.length)&&this.rejectFiles(v(a.map((function(e){return{name:e.name,type:e.type,size:e.size,content:t.maxSizeRejection}})),r.map((function(e){return{name:e.name,type:e.type,size:e.size,content:t.formatRejection}})))),this.updateValue(this.multiple?v(this.arrayValue,o):o[0]||null)}},l.prototype.isFormatAcceptable=function(e){if(!this.accept)return!0;var t="."+(e.name.split(".").pop()||"").toLowerCase();return o.getAcceptArray(this.accept).some((function(i){return i===t||i===e.type||"*"===i.split("/")[1]&&e.type.split("/")[0]===i.split("/")[0]}))},l.prototype.rejectFiles=function(e){this.reject.emit(this.multiple?e:e[0])},l.ctorParameters=function(){return[{type:i.NgControl,decorators:[{type:t.Optional},{type:t.Self},{type:t.Inject,args:[i.NgControl]}]},{type:t.ChangeDetectorRef,decorators:[{type:t.Inject,args:[t.ChangeDetectorRef]}]},{type:Boolean,decorators:[{type:t.Inject,args:[n.TUI_IS_MOBILE]}]},{type:u.Observable,decorators:[{type:t.Inject,args:[r.TUI_INPUT_FILE_TEXTS]}]}]},m([t.ViewChild("input")],l.prototype,"input",void 0),m([t.Input(),n.tuiDefaultProp()],l.prototype,"link",void 0),m([t.Input(),n.tuiDefaultProp()],l.prototype,"label",void 0),m([t.Input(),n.tuiDefaultProp()],l.prototype,"accept",void 0),m([t.Input(),n.tuiDefaultProp()],l.prototype,"multiple",void 0),m([t.Input(),n.tuiDefaultProp()],l.prototype,"size",void 0),m([t.Input(),n.tuiDefaultProp()],l.prototype,"maxFileSize",void 0),m([t.Output()],l.prototype,"reject",void 0),m([n.tuiPure],l.prototype,"computeLink$",null),m([n.tuiPure],l.prototype,"computeLabel$",null),m([n.tuiPure],l.prototype,"getValueArray",null),l=c=m([t.Component({selector:"tui-input-files",template:'<tui-wrapper\n    appearance="input-file"\n    class="t-wrapper"\n    [class._mobile]="isMobile"\n    [focused]="computedFocused"\n    [hovered]="computedHovered || fileDragged"\n    [pressed]="computedPressed"\n    [disabled]="computedDisabled"\n>\n    <label\n        automation-id="tui-input-file__label"\n        class="t-label"\n    >\n        <a tuiLink>\n            <span\n                polymorpheus-outlet\n                class="t-inline"\n                [content]="computedLink$ | async"\n            ></span>\n        </a>\n        <ng-container *ngIf="computedLabel$ | async as computedLabel">\n            <span>&nbsp;</span>\n            <span\n                polymorpheus-outlet\n                class="t-inline"\n                [content]="computedLabel"\n            ></span>\n        </ng-container>\n        <ng-container *ngIf="!readOnly && !computedDisabled">\n            <input\n                #input\n                type="file"\n                class="t-native"\n                [id]="id"\n                [accept]="accept"\n                [multiple]="multiple"\n                [tuiFocusable]="focusable"\n                (change)="onFilesSelected(input, formatRejection, maxSizeRejection)"\n                (tuiHoveredChange)="onHovered($event)"\n                (tuiFocusedChange)="onFocused($event)"\n                (tuiPressedChange)="onPressed($event)"\n                (tuiDroppableDropped)="onDropped($event, formatRejection, maxSizeRejection)"\n                (tuiDroppableDragOverChange)="onDragOver($event)"\n                (mousedown.prevent.silent)="(0)"\n            />\n        </ng-container>\n    </label>\n</tui-wrapper>\n\n<ng-template #formatRejection>\n    {{ (inputFileTexts$ | async)?.formatRejectionReason || \'\' }}\n</ng-template>\n\n<ng-template #maxSizeRejection>\n    {{ maxFileSize | tuiMaxSizeRejectionError | async }}\n</ng-template>\n',changeDetection:t.ChangeDetectionStrategy.OnPush,encapsulation:t.ViewEncapsulation.None,providers:[a.MODE_PROVIDER,{provide:n.TUI_FOCUSABLE_ITEM_ACCESSOR,useExisting:t.forwardRef((function(){return c}))}],styles:["tui-input-files{display:block}tui-input-files .t-native{position:absolute;top:0;left:0;width:100%;height:100%;opacity:0;cursor:pointer}tui-input-files .t-native::-webkit-file-upload-button{display:none}tui-input-files .t-inline{display:inline}tui-input-files .t-label{text-align:center}tui-wrapper[data-appearance=input-file]{display:flex;background:0 0;font:var(--tui-font-text-m);word-wrap:break-word;color:var(--tui-text-02);flex:1;justify-content:center;align-items:center;min-height:var(--tui-height-l);border-radius:var(--tui-radius-m);padding:1rem .5rem;box-sizing:border-box}tui-wrapper[data-appearance=input-file]:after{border:1px dashed;color:var(--tui-link)}tui-wrapper[data-appearance=input-file]._mobile:after{border:1px solid}tui-wrapper[data-appearance=input-file][data-state=hovered]{background:var(--tui-secondary)}tui-wrapper[data-appearance=input-file][data-state=hovered]:after{color:var(--tui-link-hover)}tui-wrapper[data-appearance=input-file][data-state=pressed]{background:var(--tui-secondary-hover)}tui-wrapper[data-appearance=input-file][data-state=disabled]{opacity:var(--tui-disabled-opacity);pointer-events:none}tui-wrapper[data-appearance=input-file][data-state=disabled]:after{color:var(--tui-text-03)}tui-wrapper[data-appearance=input-file]._focused:after{border-style:solid;border-width:2px;color:var(--tui-focus)}tui-wrapper[data-appearance=input-file][data-mode=onDark],tui-wrapper[data-appearance=input-file][data-mode=onDark]._focused:after,tui-wrapper[data-appearance=input-file][data-mode=onDark]:after{color:var(--tui-text-01-night)}tui-wrapper[data-appearance=input-file][data-mode=onDark][data-state=hovered]{background:var(--tui-clear-inverse-hover)}tui-wrapper[data-appearance=input-file][data-mode=onDark][data-state=hovered]:after,tui-wrapper[data-appearance=input-file][data-mode=onDark][data-state=pressed]:after{color:var(--tui-text-03-night)}tui-wrapper[data-appearance=input-file][data-mode=onDark][data-state=pressed]{background:var(--tui-clear-inverse-active)}tui-wrapper[data-appearance=input-file][data-mode=onLight],tui-wrapper[data-appearance=input-file][data-mode=onLight]:after{color:var(--tui-text-01)}tui-wrapper[data-appearance=input-file][data-mode=onLight][data-state=hovered]{background:var(--tui-clear-hover)}tui-wrapper[data-appearance=input-file][data-mode=onLight][data-state=hovered]:after,tui-wrapper[data-appearance=input-file][data-mode=onLight][data-state=pressed]:after{color:var(--tui-text-03)}tui-wrapper[data-appearance=input-file][data-mode=onLight][data-state=pressed]{background:var(--tui-clear-active)}"]}),g(0,t.Optional()),g(0,t.Self()),g(0,t.Inject(i.NgControl)),g(1,t.Inject(t.ChangeDetectorRef)),g(2,t.Inject(n.TUI_IS_MOBILE)),g(3,t.Inject(r.TUI_INPUT_FILE_TEXTS))],l)}(n.AbstractTuiNullableControl),b=function(){function e(e,t){this.inputFileTexts$=e,this.units$=t}return e.prototype.transform=function(e){return u.combineLatest([this.inputFileTexts$,this.units$]).pipe(p.map((function(t){var i=y(t,2),n=i[0].maxSizeRejectionReason,a=i[1];return n+d.tuiFormatSize(a,e)})))},e.ctorParameters=function(){return[{type:void 0,decorators:[{type:t.Inject,args:[r.TUI_INPUT_FILE_TEXTS]}]},{type:void 0,decorators:[{type:t.Inject,args:[r.TUI_DIGITAL_INFORMATION_UNITS]}]}]},e=m([t.Pipe({name:"tuiMaxSizeRejectionError"}),g(0,t.Inject(r.TUI_INPUT_FILE_TEXTS)),g(1,t.Inject(r.TUI_DIGITAL_INFORMATION_UNITS))],e)}(),T=function(){function e(){}return e=m([t.NgModule({imports:[l.CommonModule,s.PolymorpheusModule,n.TuiLetModule,n.TuiFocusedModule,n.TuiFocusVisibleModule,n.TuiPressedModule,n.TuiHoveredModule,n.TuiFocusableModule,n.TuiDroppableModule,a.TuiWrapperModule,a.TuiSvgModule,a.TuiLinkModule,a.TuiLoaderModule,a.TuiButtonModule,a.TuiGroupModule,c.TuiFilesModule],declarations:[h,b],exports:[h,c.TuiFilesComponent,c.TuiFileComponent,n.TuiItemDirective]})],e)}();e.TuiInputFilesComponent=h,e.TuiInputFilesModule=T,e.ɵa=b,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=taiga-ui-kit-components-input-files.umd.min.js.map