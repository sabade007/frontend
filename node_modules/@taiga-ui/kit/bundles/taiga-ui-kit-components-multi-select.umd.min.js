!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("@taiga-ui/cdk"),require("@taiga-ui/kit/utils"),require("@angular/forms"),require("@taiga-ui/core"),require("@taiga-ui/kit/classes"),require("@taiga-ui/kit/components/arrow"),require("@taiga-ui/kit/components/input-tag"),require("@taiga-ui/kit/constants"),require("@taiga-ui/kit/providers"),require("@taiga-ui/kit/tokens"),require("@angular/common"),require("@taiga-ui/kit/components/multi-select-option"),require("@tinkoff/ng-polymorpheus"),require("rxjs"),require("rxjs/operators")):"function"==typeof define&&define.amd?define("@taiga-ui/kit/components/multi-select",["exports","@angular/core","@taiga-ui/cdk","@taiga-ui/kit/utils","@angular/forms","@taiga-ui/core","@taiga-ui/kit/classes","@taiga-ui/kit/components/arrow","@taiga-ui/kit/components/input-tag","@taiga-ui/kit/constants","@taiga-ui/kit/providers","@taiga-ui/kit/tokens","@angular/common","@taiga-ui/kit/components/multi-select-option","@tinkoff/ng-polymorpheus","rxjs","rxjs/operators"],e):e(((t=t||self)["taiga-ui"]=t["taiga-ui"]||{},t["taiga-ui"].kit=t["taiga-ui"].kit||{},t["taiga-ui"].kit.components=t["taiga-ui"].kit.components||{},t["taiga-ui"].kit.components["multi-select"]={}),t.ng.core,t.cdk,t["taiga-ui"].kit.utils,t.ng.forms,t.core$1,t["taiga-ui"].kit.classes,t["taiga-ui"].kit.components.arrow,t["taiga-ui"].kit.components["input-tag"],t["taiga-ui"].kit.constants,t["taiga-ui"].kit.providers,t["taiga-ui"].kit.tokens,t.ng.common,t["taiga-ui"].kit.components["multi-select-option"],t.ngPolymorpheus,t.rxjs,t.rxjs.operators)}(this,(function(t,e,n,o,i,r,a,u,p,l,s,c,d,f,h,g,y){"use strict";var v=function(t,e){return(v=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};var m=function(){return(m=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function b(t,e,n,o){var i,r=arguments.length,a=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var u=t.length-1;u>=0;u--)(i=t[u])&&(a=(r<3?i(a):r>3?i(e,n,a):i(e,n))||a);return r>3&&a&&Object.defineProperty(e,n,a),a}function T(t,e){return function(n,o){e(n,o,t)}}Object.create;function O(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var o,i,r=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(o=r.next()).done;)a.push(o.value)}catch(t){i={error:t}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(i)throw i.error}}return a}function I(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(O(arguments[e]));return t}Object.create;var _={expandable:!0,valueContent:""},C=new e.InjectionToken("Default parameters for multi select component",{factory:function(){return _}}),P=function(t){function o(o,i,r,u,p,s,c){var d=t.call(this,o,i)||this;return d.arrowMode=u,d.itemsHandlers=p,d.options=s,d.controller=c,d.stringify=d.itemsHandlers.stringify,d.identityMatcher=d.itemsHandlers.identityMatcher,d.expandable=d.options.expandable,d.search="",d.editable=!0,d.disabledItemHandler=d.itemsHandlers.disabledItemHandler,d.valueContent=d.options.valueContent,d.tagValidator=n.ALWAYS_TRUE_HANDLER,d.searchChange=new e.EventEmitter,d.datalist="",d.open=!1,d.valueMapper=function(t,e,o){return o?n.EMPTY_ARRAY:t.map((function(t){return new a.TuiStringifiableItem(t,e)}))},d.disabledItemHandlerWrapper=function(t){return function(e){return"string"==typeof e||t(e.item)}},r.define({iconBlank:l.iconBlank}),d}var d;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}v(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}(o,t),d=o,Object.defineProperty(o.prototype,"size",{get:function(){return this.controller.size},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"arrow",{get:function(){return this.interactive?this.arrowMode.interactive:this.arrowMode.disabled},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"nativeFocusableElement",{get:function(){return this.input?this.input.nativeFocusableElement:null},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"focused",{get:function(){return!!this.input&&this.input.focused||!!this.hostedDropdown&&this.hostedDropdown.focused},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"computedValue",{get:function(){return this.computedGroup?n.EMPTY_ARRAY:this.value},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"searchOrSpace",{get:function(){return this.computedGroup?" ":this.searchString},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"searchString",{get:function(){return null===this.search?"":this.search},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"tagIcon",{get:function(){return this.interactive?"iconBlank":""},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"inputHidden",{get:function(){return!this.editable&&!this.computedGroup},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"computedGroup",{get:function(){return!!this.valueContent&&this.value.length>0&&(!this.focused||!this.editable)},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"context",{get:function(){return this.getContext(this.value)},enumerable:!0,configurable:!0}),o.prototype.getStringifier=function(t){return function(e){var n=e.$implicit;return t(n)}},o.prototype.onHoveredChange=function(t){this.updateHovered(t)},o.prototype.onSpace=function(t){this.editable||t.preventDefault(),this.readOnly||(this.open=!0)},o.prototype.handleOption=function(t){var e=this.value,n=this.identityMatcher,o=e.findIndex((function(e){return n(e,t)}));this.updateValue(-1===o?I(e,[t]):e.filter((function(t,e){return e!==o}))),this.updateSearch(null)},o.prototype.onEnter=function(t){var e=this.value,n=this.accessor?this.accessor.getOptions():[];if(1===n.length){var o=e.indexOf(n[0]);t.preventDefault(),this.updateValue(-1===o?I(e,[n[0]]):I(e.slice(0,o),e.slice(o+1))),this.updateSearch(null)}},o.prototype.onClick=function(t){var e,o=t.nativeFocusableElement;this.editable&&this.interactive&&o&&n.isNativeFocused(o)&&(null===(e=this.hostedDropdown)||void 0===e||e.updateOpen(!this.open))},o.prototype.onArrowClick=function(){var t;null===(t=this.hostedDropdown)||void 0===t||t.updateOpen(!this.open),this.focusInput()},o.prototype.onInput=function(t){this.updateValue(t.map((function(t){return t.item})))},o.prototype.onSearch=function(t){this.open=!0,this.updateSearch(t)},o.prototype.onActiveZone=function(t){this.updateFocused(t)},o.prototype.setDisabledState=function(){t.prototype.setDisabledState.call(this),this.open=!1},o.prototype.getContext=function(t){return{$implicit:t}},o.prototype.updateSearch=function(t){this.search!==t&&(this.search=t,this.searchChange.emit(t))},o.prototype.focusInput=function(t){void 0===t&&(t=!1),this.nativeFocusableElement&&n.setNativeFocused(this.nativeFocusableElement,!0,t)},o.ctorParameters=function(){return[{type:i.NgControl,decorators:[{type:e.Optional},{type:e.Self},{type:e.Inject,args:[i.NgControl]}]},{type:e.ChangeDetectorRef,decorators:[{type:e.Inject,args:[e.ChangeDetectorRef]}]},{type:r.TuiSvgService,decorators:[{type:e.Inject,args:[r.TuiSvgService]}]},{type:void 0,decorators:[{type:e.Inject,args:[u.TUI_ARROW_MODE]}]},{type:void 0,decorators:[{type:e.Inject,args:[c.TUI_ITEMS_HANDLERS]}]},{type:void 0,decorators:[{type:e.Inject,args:[C]}]},{type:r.TuiTextfieldController,decorators:[{type:e.Inject,args:[r.TUI_TEXTFIELD_WATCHED_CONTROLLER]}]}]},b([e.ContentChild(r.TUI_DATA_LIST_ACCESSOR)],o.prototype,"accessor",void 0),b([e.ViewChild(r.TuiHostedDropdownComponent)],o.prototype,"hostedDropdown",void 0),b([e.ViewChild(p.TuiInputTagComponent)],o.prototype,"input",void 0),b([e.Input(),n.tuiDefaultProp()],o.prototype,"stringify",void 0),b([e.Input(),n.tuiDefaultProp()],o.prototype,"identityMatcher",void 0),b([e.Input(),n.tuiDefaultProp()],o.prototype,"expandable",void 0),b([e.Input(),n.tuiDefaultProp()],o.prototype,"search",void 0),b([e.Input(),e.HostBinding("class._editable"),n.tuiDefaultProp()],o.prototype,"editable",void 0),b([e.Input(),n.tuiDefaultProp()],o.prototype,"disabledItemHandler",void 0),b([e.Input(),n.tuiDefaultProp()],o.prototype,"valueContent",void 0),b([e.Input(),n.tuiDefaultProp()],o.prototype,"tagValidator",void 0),b([e.Output()],o.prototype,"searchChange",void 0),b([e.ContentChild(r.TuiDataListDirective,{read:e.TemplateRef})],o.prototype,"datalist",void 0),b([e.HostBinding("attr.data-size")],o.prototype,"size",null),b([n.tuiPure],o.prototype,"getStringifier",null),b([n.tuiPure],o.prototype,"getContext",null),o=d=b([e.Component({selector:"tui-multi-select",template:'<tui-hosted-dropdown\n    class="t-hosted"\n    [canOpen]="interactive"\n    [content]="datalist || \'\'"\n    [(open)]="open"\n    (tuiHoveredChange)="onHoveredChange($event)"\n    (tuiActiveZoneChange)="onActiveZone($event)"\n>\n    <tui-input-tag\n        #inputTag\n        tuiHostedDropdownHost\n        automation-id="tui-multi-select__input"\n        class="t-input"\n        [nativeId]="nativeId"\n        [icon]="tagIcon"\n        [disabled]="disabled"\n        [disabledItemHandler]="disabledItemHandler | tuiMapper: disabledItemHandlerWrapper"\n        [tagValidator]="tagValidator | tuiMapper: disabledItemHandlerWrapper"\n        [readOnly]="readOnly"\n        [inputHidden]="!editable"\n        [pseudoHovered]="computedHovered"\n        [pseudoFocused]="computedFocused"\n        [pseudoInvalid]="computedInvalid"\n        [editable]="false"\n        [expandable]="expandable"\n        [search]="searchOrSpace"\n        [ngModel]="computedValue | tuiMapper: valueMapper:stringify"\n        (ngModelChange)="onInput($event)"\n        (searchChange)="onSearch($event)"\n        (keydown.space)="onSpace($event)"\n        (keydown.enter)="onEnter($event)"\n        (click.prevent)="onClick(inputTag)"\n    >\n        <ng-content></ng-content>\n    </tui-input-tag>\n    <div\n        class="t-wrapper"\n        [class.t-wrapper_disabled]="disabled"\n    >\n        <div\n            *ngIf="computedGroup"\n            polymorpheus-outlet\n            class="t-group"\n            [class.t-group_fullsize]="inputTag.labelOutside"\n            [context]="context"\n            [content]="valueContent"\n        ></div>\n\n        <div\n            *ngIf="arrow"\n            polymorpheus-outlet\n            automation-id="tui-multi-select__arrow"\n            tuiPreventDefault="mousedown"\n            class="t-arrow"\n            [content]="arrow"\n            (click.prevent)="onArrowClick()"\n        ></div>\n    </div>\n</tui-hosted-dropdown>\n',changeDetection:e.ChangeDetectionStrategy.OnPush,providers:[{provide:n.TUI_FOCUSABLE_ITEM_ACCESSOR,useExisting:e.forwardRef((function(){return d}))},{provide:r.TUI_DATA_LIST_HOST,useExisting:e.forwardRef((function(){return d}))},s.FIXED_DROPDOWN_CONTROLLER_PROVIDER,r.TEXTFIELD_CONTROLLER_PROVIDER],styles:[":host{position:relative;display:block;border-radius:var(--tui-radius-m)}:host._disabled{pointer-events:none}.t-hosted{display:block;border-radius:inherit}.t-input{border-radius:inherit}:host:not(._editable):not(._readonly) .t-input{cursor:pointer}.t-wrapper{position:absolute;top:0;left:0;width:100%;height:100%;display:flex;pointer-events:none;justify-content:flex-end}.t-wrapper_disabled{opacity:var(--tui-disabled-opacity)}:host[data-size='s'] .t-wrapper{height:var(--tui-height-s)}:host[data-size='m'] .t-wrapper{height:var(--tui-height-m)}:host[data-size='l'] .t-wrapper{height:var(--tui-height-l)}.t-group{display:flex;flex:1;align-items:center;padding:1.6875rem 0 .5625rem 1rem;overflow:hidden}.t-group_fullsize{padding-top:.0625rem;padding-bottom:0}:host[data-size='m'] .t-group_fullsize.t-group_fullsize{padding-top:0}:host[data-size='m'] .t-group{padding:1.1875rem 0 0 .75rem;font-size:.8125rem}.t-arrow{transition-duration:var(--tui-duration,300ms);transition-timing-function:ease-in-out;display:flex;align-items:center;justify-content:center;color:var(--tui-text-03);position:relative;box-sizing:border-box;transition-property:color,transform;width:1.5rem;height:auto;margin:0 .75rem;pointer-events:auto;cursor:pointer}.t-arrow:hover{color:var(--tui-text-02)}:host._disabled .t-arrow,:host._readonly .t-arrow{pointer-events:none}:host[data-mode=onDark] .t-arrow{color:var(--tui-text-03-night)}:host[data-mode=onDark] .t-arrow:hover{color:var(--tui-text-01-night)}"]}),T(0,e.Optional()),T(0,e.Self()),T(0,e.Inject(i.NgControl)),T(1,e.Inject(e.ChangeDetectorRef)),T(2,e.Inject(r.TuiSvgService)),T(3,e.Inject(u.TUI_ARROW_MODE)),T(4,e.Inject(c.TUI_ITEMS_HANDLERS)),T(5,e.Inject(C)),T(6,e.Inject(r.TUI_TEXTFIELD_WATCHED_CONTROLLER))],o)}(n.AbstractTuiMultipleControl),S=function(){function t(t){this.component=t}return t.prototype.transform=function(t,e){var n=null!=e?e:this.component,i=n.value,r=n.identityMatcher;return t?o.isFlat(t)?this.filter(t,i,r):this.filter2d(t,i,r):null},t.prototype.filter2d=function(t,e,n){var o=this;return t.map((function(t){return o.filter(t,e,n)}))},t.prototype.filter=function(t,e,n){return t.filter((function(t){return e.every((function(e){return!n(e,t)}))}))},t.ctorParameters=function(){return[{type:P,decorators:[{type:e.Inject,args:[P]}]}]},b([n.tuiPure],t.prototype,"filter2d",null),b([n.tuiPure],t.prototype,"filter",null),t=b([e.Pipe({name:"tuiHideSelected",pure:!1}),T(0,e.Inject(P))],t)}(),w=function(){function t(t,e){this.host=t,this.control=e,this.options=n.EMPTY_QUERY,this.label=""}return Object.defineProperty(t.prototype,"size",{get:function(){var t;return(null===(t=this.options.first)||void 0===t?void 0:t.size)||"m"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"checkboxSize",{get:function(){return this.options.first&&r.sizeBigger(this.options.first.size)?"l":"m"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"empty$",{get:function(){return n.itemsQueryListObservable(this.options).pipe(y.map((function(t){return!t.length})))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"disabled$",{get:function(){return n.itemsQueryListObservable(this.options).pipe(y.map((function(t){return t.every((function(t){return t.disabled}))})))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"value$",{get:function(){var t=this;return g.combineLatest(this.items$,this.valueChanges$).pipe(y.map((function(e){for(var n=O(e,2),o=n[0],i=n[1],r=!1,a=function(e){var n=i.some((function(n){return t.matcher(n,o[e])}));if(!n&&r||n&&!r&&e)return{value:null};r=n},u=0;u<o.length;u++){var p=a(u);if("object"==typeof p)return p.value}return r})))},enumerable:!0,configurable:!0}),t.prototype.onClick=function(t){var e=this;if(this.control.control){var n=this.control.value||[],o=this.values,i=n.filter((function(t){return o.every((function(n){return!e.matcher(t,n)}))}));this.control.control.setValue(t?i:I(i,o))}},Object.defineProperty(t.prototype,"values",{get:function(){return this.filter(n.getOriginalArrayFromQueryList(this.options))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"matcher",{get:function(){return this.host.identityMatcher||n.TUI_DEFAULT_IDENTITY_MATCHER},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"items$",{get:function(){return n.itemsQueryListObservable(this.options).pipe(y.map((function(t){return t.map((function(t){return t.value})).filter(n.isPresent)})))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"valueChanges$",{get:function(){return n.tuiReplayedValueChangesFrom(this.control).pipe(y.map((function(t){return t||[]})))},enumerable:!0,configurable:!0}),t.prototype.filter=function(t){return t.map((function(t){return t.value})).filter(n.isPresent)},t.ctorParameters=function(){return[{type:void 0,decorators:[{type:e.Inject,args:[r.TUI_DATA_LIST_HOST]}]},{type:i.NgControl,decorators:[{type:e.Inject,args:[i.NgControl]}]}]},b([e.ContentChildren(r.TuiOptionComponent)],t.prototype,"options",void 0),b([e.Input(),n.tuiDefaultProp()],t.prototype,"label",void 0),b([n.tuiPure],t.prototype,"empty$",null),b([n.tuiPure],t.prototype,"disabled$",null),b([n.tuiPure],t.prototype,"value$",null),b([n.tuiPure],t.prototype,"items$",null),b([n.tuiPure],t.prototype,"valueChanges$",null),b([n.tuiPure],t.prototype,"filter",null),t=b([e.Component({selector:"tui-opt-group[tuiMultiSelectGroup]",template:'<ng-container *tuiLet="value$ | async as value">\n    <button\n        *ngIf="label && !(empty$ | async)"\n        tuiOption\n        [size]="size"\n        [disabled]="!!(disabled$ | async)"\n        (click)="onClick(value)"\n    >\n        <tui-primitive-checkbox\n            class="t-checkbox"\n            [size]="checkboxSize"\n            [value]="value"\n        ></tui-primitive-checkbox>\n        <span class="t-label">{{ label }}</span>\n    </button>\n</ng-container>\n<ng-content></ng-content>\n',changeDetection:e.ChangeDetectionStrategy.OnPush,viewProviders:[{provide:r.TUI_OPTION_CONTENT,useValue:null}],styles:[":host{display:flex;flex-direction:column}:host:before{content:''}.t-label{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;font:var(--tui-font-text-xs);flex:1;color:var(--tui-text-02)}.t-checkbox{margin-right:.75rem}"]}),T(0,e.Inject(r.TUI_DATA_LIST_HOST)),T(1,e.Inject(i.NgControl))],t)}();function k(t,e){return e||{handleOption:function(e){if(t.control){var n=t.value||[],o=n.indexOf(e);t.control.setValue(-1===o?I(n,[e]):I(n.slice(0,o),n.slice(o+1)))}}}}var E=new h.PolymorpheusComponent(f.TuiMultiSelectOptionComponent),j={writeValue:n.EMPTY_FUNCTION,registerOnChange:n.EMPTY_FUNCTION,registerOnTouched:n.EMPTY_FUNCTION},D=function(){function t(){}return t=b([e.Directive({selector:"[tuiMultiSelectGroup]",providers:[{provide:r.TUI_OPTION_CONTENT,useValue:E},{provide:r.TUI_DATA_LIST_HOST,deps:[i.NgControl,[new e.Optional,e.forwardRef((function(){return P}))]],useFactory:k},{provide:i.NG_VALUE_ACCESSOR,multi:!0,useValue:j}]})],t)}(),M=function(){function t(){}return t=b([e.NgModule({imports:[d.CommonModule,i.FormsModule,h.PolymorpheusModule,n.TuiPreventDefaultModule,n.TuiActiveZoneModule,u.TuiArrowModule,n.TuiLetModule,n.TuiMapperPipeModule,n.TuiHoveredModule,r.TuiSvgModule,r.TuiHostedDropdownModule,p.TuiInputTagModule,f.TuiMultiSelectOptionModule,r.TuiPrimitiveCheckboxModule,r.TuiDataListModule],declarations:[P,w,D,S],exports:[P,w,D,S]})],t)}();t.MULTI_SELECT_ACCESSOR=j,t.TUI_MULTI_SELECT_DEFAULT_OPTIONS=_,t.TUI_MULTI_SELECT_OPTION=E,t.TUI_MULTI_SELECT_OPTIONS=C,t.TuiHideSelectedPipe=S,t.TuiMultiSelectComponent=P,t.TuiMultiSelectGroupComponent=w,t.TuiMultiSelectGroupDirective=D,t.TuiMultiSelectModule=M,t.hostFallbackFactory=k,t.tuiMultiSelectOptionsProvider=function(t){return{provide:C,useValue:m(m({},_),t)}},Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=taiga-ui-kit-components-multi-select.umd.min.js.map