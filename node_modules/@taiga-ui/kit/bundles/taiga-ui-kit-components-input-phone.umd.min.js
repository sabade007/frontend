!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@angular/forms"),require("@taiga-ui/cdk"),require("@taiga-ui/core"),require("rxjs"),require("@angular/common"),require("@taiga-ui/kit/providers"),require("rxjs/operators"),require("@taiga-ui/kit/directives"),require("angular2-text-mask")):"function"==typeof define&&define.amd?define("@taiga-ui/kit/components/input-phone",["exports","@angular/core","@angular/forms","@taiga-ui/cdk","@taiga-ui/core","rxjs","@angular/common","@taiga-ui/kit/providers","rxjs/operators","@taiga-ui/kit/directives","angular2-text-mask"],t):t(((e=e||self)["taiga-ui"]=e["taiga-ui"]||{},e["taiga-ui"].kit=e["taiga-ui"].kit||{},e["taiga-ui"].kit.components=e["taiga-ui"].kit.components||{},e["taiga-ui"].kit.components["input-phone"]={}),e.ng.core,e.ng.forms,e.cdk,e.core$1,e.rxjs,e.ng.common,e["taiga-ui"].kit.providers,e.rxjs.operators,e["taiga-ui"].kit.directives,e.angular2TextMask)}(this,(function(e,t,n,o,r,i,a,u,s,c,p){"use strict";var l=function(e,t){return(l=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)};function d(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}l(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var h=function(){return(h=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};function f(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var u=e.length-1;u>=0;u--)(r=e[u])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a}function y(e,t){return function(n,o){t(n,o,e)}}Object.create;function g(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var o,r,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(o=i.next()).done;)a.push(o.value)}catch(e){r={error:e}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}return a}Object.create;var v={phoneMaskAfterCountryCode:"### ###-##-##",allowText:!1,countryCode:"+7"},m=new t.InjectionToken("Default parameters for input phone component",{factory:function(){return v}}),b=new t.InjectionToken("A stream of selection changes"),C=[o.TuiDestroyService,u.FIXED_DROPDOWN_CONTROLLER_PROVIDER,{provide:o.AbstractTuiControl,useExisting:t.forwardRef((function(){return x}))},{provide:o.TUI_FOCUSABLE_ITEM_ACCESSOR,useExisting:t.forwardRef((function(){return x}))},{provide:r.TUI_DATA_LIST_HOST,useExisting:t.forwardRef((function(){return x}))},{provide:b,deps:[o.TuiDestroyService,a.DOCUMENT],useFactory:T}];function T(e,t){return i.fromEvent(t,"selectionchange").pipe(s.windowToggle(i.merge(i.fromEvent(t,"mouseup"),i.fromEvent(t,"keydown")),(function(){return i.fromEvent(t,"mousedown")})),s.flatMap((function(e){return e.pipe(s.startWith(null))})),s.takeUntil(e))}var x=function(e){function a(n,o,r,i,a){var u=e.call(this,n,o)||this;return u.textfieldCleaner=i,u.options=a,u.phoneMaskAfterCountryCode=u.options.phoneMaskAfterCountryCode,u.allowText=u.options.allowText,u.search="",u.searchChange=new t.EventEmitter,u.textMaskOptions={mask:function(e){return!(u.allowText&&!u.value&&O(e)&&"+"!==e)&&function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(g(arguments[t]));return e}(u.countryCode.split(""),[" "],u.phoneMaskAfterCountryCode.replace(/[^#\- ()]+/g,"").split("").map((function(e){return"#"===e?/\d/:e})))},pipe:function(e){return u.allowText?e:""===e&&u.focused&&!u.readOnly?u.countryCode+" ":e.replace(/-$/,"")},guide:!1},u.countryCode=u.options.countryCode,u.open=!1,r.subscribe((function(){u.setCaretPosition()})),u}return d(a,e),Object.defineProperty(a.prototype,"countryCodeSetter",{set:function(e){this.updateValueWithNewCountryCode(e),this.countryCode=e},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"nativeFocusableElement",{get:function(){return!this.textfield||this.computedDisabled?null:this.textfield.nativeFocusableElement},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"focused",{get:function(){return o.isNativeFocused(this.nativeFocusableElement)||!!this.dropdown&&this.dropdown.focused},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"computedValue",{get:function(){return this.value?r.formatPhone(this.value,this.countryCode,this.phoneMaskAfterCountryCode):this.search||""},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"inputMode",{get:function(){return this.allowText?"text":"numeric"},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"canOpen",{get:function(){return this.interactive&&!!this.datalist},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"canClean",{get:function(){return this.computedValue!==this.countryCode&&this.textfieldCleaner.cleaner},enumerable:!0,configurable:!0}),a.prototype.onHovered=function(e){this.updateHovered(e)},a.prototype.onDrop=function(e){e.dataTransfer&&(this.setValueWithoutPrefix(e.dataTransfer.getData("text")),e.preventDefault())},a.prototype.onPaste=function(e){this.setValueWithoutPrefix(o.getClipboardDataText(e))},a.prototype.onActiveZone=function(e){this.updateFocused(e),!e||this.computedValue||this.readOnly||this.allowText?(this.computedValue===this.countryCode||null!==this.search&&Number.isNaN(parseInt(this.search.replace(r.TUI_MASK_SYMBOLS_REGEXP,""),10)))&&this.updateSearch(""):this.updateSearch(this.countryCode)},a.prototype.onBackspace=function(e){var t=e.target;(t.selectionStart||0)<=this.nonRemovableLength&&t.selectionStart===t.selectionEnd&&e.preventDefault()},a.prototype.onValueChange=function(e){var t=O(e=""===e?this.countryCode:e)?e:e.replace(r.TUI_MASK_SYMBOLS_REGEXP,"");this.updateSearch(t),this.updateValue(t===this.countryCode||O(t)?"":t),this.open=!0},a.prototype.handleOption=function(e){this.focusInput(),this.updateValue(e),this.updateSearch(""),this.open=!1},a.prototype.setDisabledState=function(){e.prototype.setDisabledState.call(this),this.open=!1},a.prototype.writeValue=function(t){e.prototype.writeValue.call(this,t),this.updateSearch("")},a.prototype.getFallbackValue=function(){return""},Object.defineProperty(a.prototype,"caretIsInForbiddenArea",{get:function(){var e=this.nativeFocusableElement;if(!e)return!1;var t=e.selectionStart,n=e.selectionEnd;return o.isNativeFocused(e)&&null!==t&&t<this.nonRemovableLength&&t===n},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"nonRemovableLength",{get:function(){return this.isTextValue?0:this.countryCode.length+1},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"maxPhoneLength",{get:function(){return this.countryCode.length+this.phoneMaskAfterCountryCode.replace(/[^#]+/g,"").length},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"isTextValue",{get:function(){return!!this.search&&O(this.search)},enumerable:!0,configurable:!0}),a.prototype.setCaretPosition=function(){this.caretIsInForbiddenArea&&this.nativeFocusableElement&&this.nativeFocusableElement.setSelectionRange(this.nonRemovableLength,this.nonRemovableLength)},a.prototype.setValueWithoutPrefix=function(e){this.readOnly||(this.open=!0,this.updateValue(this.cleanValue(e)),this.updateSearch(this.allowText&&O(e)?e:e.replace(r.TUI_MASK_SYMBOLS_REGEXP,"")))},a.prototype.cleanValue=function(e){var t="+7"===this.countryCode?/^7|^8/:new RegExp(this.countryCode.slice(1)),n=this.value.length>this.countryCode.length&&this.value.length<this.maxPhoneLength,o=e.replace(r.TUI_MASK_SYMBOLS_REGEXP,"").length,i=e.replace(/[^0-9]+/g,""),a=String(getSelection()).length;return n&&0===a?(""+this.value+i).slice(0,this.maxPhoneLength):o<this.maxPhoneLength-1?(""+this.countryCode+i).slice(0,this.maxPhoneLength):(""+this.countryCode+i.replace(t,"")).slice(0,this.maxPhoneLength)},a.prototype.focusInput=function(){this.nativeFocusableElement&&o.setNativeFocused(this.nativeFocusableElement,!0,!0)},a.prototype.updateSearch=function(e){this.search!==e&&(this.search=e,this.searchChange.emit(e))},a.prototype.updateValueWithNewCountryCode=function(e){this.isTextValue||this.updateValue(this.value.replace(this.countryCode,e))},a.ctorParameters=function(){return[{type:n.NgControl,decorators:[{type:t.Optional},{type:t.Self},{type:t.Inject,args:[n.NgControl]}]},{type:t.ChangeDetectorRef,decorators:[{type:t.Inject,args:[t.ChangeDetectorRef]}]},{type:i.Observable,decorators:[{type:t.Inject,args:[b]}]},{type:r.TuiTextfieldCleanerDirective,decorators:[{type:t.Inject,args:[r.TUI_TEXTFIELD_CLEANER]}]},{type:void 0,decorators:[{type:t.Inject,args:[m]}]}]},f([t.ViewChild(r.TuiHostedDropdownComponent)],a.prototype,"dropdown",void 0),f([t.ViewChild(r.TuiPrimitiveTextfieldComponent)],a.prototype,"textfield",void 0),f([t.Input("countryCode"),o.tuiRequiredSetter()],a.prototype,"countryCodeSetter",null),f([t.Input(),o.tuiDefaultProp()],a.prototype,"phoneMaskAfterCountryCode",void 0),f([t.Input(),o.tuiDefaultProp()],a.prototype,"allowText",void 0),f([t.Input(),o.tuiDefaultProp()],a.prototype,"search",void 0),f([t.Output()],a.prototype,"searchChange",void 0),f([t.ContentChild(r.TuiDataListDirective,{read:t.TemplateRef})],a.prototype,"datalist",void 0),a=f([t.Component({selector:"tui-input-phone",template:'<tui-hosted-dropdown\n    class="t-hosted"\n    [canOpen]="canOpen"\n    [content]="datalist || \'\'"\n    [(open)]="open"\n    (tuiActiveZoneChange)="onActiveZone($event)"\n>\n    <tui-primitive-textfield\n        tuiValueAccessor\n        tuiTextfieldType="tel"\n        class="t-textfield"\n        [tuiTextfieldInputMode]="inputMode"\n        [pseudoHovered]="pseudoHovered"\n        [pseudoFocused]="computedFocused"\n        [invalid]="computedInvalid"\n        [nativeId]="nativeId"\n        [readOnly]="readOnly"\n        [disabled]="computedDisabled"\n        [focusable]="focusable"\n        [textMask]="textMaskOptions"\n        [value]="computedValue"\n        [tuiTextfieldCleaner]="canClean"\n        (valueChange)="onValueChange($event)"\n        (hoveredChange)="onHovered($event)"\n        (drop)="onDrop($event)"\n        (keydown.backspace)="onBackspace($event)"\n        (paste.prevent)="onPaste($event)"\n    >\n        <ng-content></ng-content>\n        <ng-content\n            select="input"\n            ngProjectAs="input"\n        ></ng-content>\n    </tui-primitive-textfield>\n</tui-hosted-dropdown>\n',changeDetection:t.ChangeDetectionStrategy.OnPush,providers:C,styles:[":host{display:block;border-radius:var(--tui-radius-m);text-align:left}:host._disabled{pointer-events:none}.t-hosted{display:block;border-radius:inherit}.t-textfield{border-radius:inherit;text-align:inherit}"]}),y(0,t.Optional()),y(0,t.Self()),y(0,t.Inject(n.NgControl)),y(1,t.Inject(t.ChangeDetectorRef)),y(2,t.Inject(b)),y(3,t.Inject(r.TUI_TEXTFIELD_CLEANER)),y(4,t.Inject(m))],a)}(o.AbstractTuiControl);function O(e){return Number.isNaN(parseInt(e.replace(r.TUI_MASK_SYMBOLS_REGEXP,""),10))}var P=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}var o;return d(n,e),o=n,Object.defineProperty(n.prototype,"value",{get:function(){return this.host.computedValue},enumerable:!0,configurable:!0}),n.prototype.onValueChange=function(e){this.host.onValueChange(e)},n.prototype.process=function(e){this.input=e},n.prototype.ngDoCheck=function(){this.input&&(this.input.type="tel",this.input.inputMode=this.host.inputMode)},n=o=f([t.Directive({selector:"tui-input-phone",providers:[{provide:r.TUI_TEXTFIELD_HOST,useExisting:t.forwardRef((function(){return o}))}]})],n)}(r.TuiAbstractTextfieldHost),I=function(){function e(){}return e=f([t.NgModule({imports:[p.TextMaskModule,r.TuiPrimitiveTextfieldModule,r.TuiHostedDropdownModule,r.TuiTextfieldControllerModule,o.TuiActiveZoneModule,c.TuiValueAccessorModule],declarations:[x,P],exports:[x,P,r.TuiTextfieldComponent]})],e)}();e.INPUT_PHONE_PROVIDERS=C,e.SELECTION_STREAM=b,e.TUI_INPUT_PHONE_DEFAULT_OPTIONS=v,e.TUI_INPUT_PHONE_OPTIONS=m,e.TuiInputPhoneComponent=x,e.TuiInputPhoneDirective=P,e.TuiInputPhoneModule=I,e.selectionStreamFactory=T,e.tuiInputPhoneOptionsProvider=function(e){return{provide:m,useValue:h(h({},v),e)}},Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=taiga-ui-kit-components-input-phone.umd.min.js.map