{"version":3,"file":"taiga-ui-kit-directives-lazy-loading.js","sources":["ng://@taiga-ui/kit/directives/lazy-loading/lazy-loading.service.ts","ng://@taiga-ui/kit/directives/lazy-loading/lazy-loading.directive.ts","ng://@taiga-ui/kit/directives/lazy-loading/lazy-loading.module.ts","ng://@taiga-ui/kit/directives/lazy-loading/taiga-ui-kit-directives-lazy-loading.ts"],"sourcesContent":["import {ChangeDetectorRef, Inject, Injectable} from '@angular/core';\nimport {SafeResourceUrl} from '@angular/platform-browser';\nimport {IntersectionObserverService} from '@ng-web-apis/intersection-observer';\nimport {TuiDestroyService, watch} from '@taiga-ui/cdk';\nimport {Observable, of, Subject} from 'rxjs';\nimport {catchError, filter, mapTo, switchMap, take, takeUntil} from 'rxjs/operators';\n\n@Injectable()\nexport class TuiLazyLoadingService extends Observable<SafeResourceUrl | string> {\n    private readonly src$ = new Subject<SafeResourceUrl | string>();\n\n    constructor(\n        @Inject(ChangeDetectorRef) changeDetectorRef: ChangeDetectorRef,\n        @Inject(TuiDestroyService) destroy$: Observable<void>,\n        @Inject(IntersectionObserverService)\n        intersections$: Observable<IntersectionObserverEntry[]>,\n    ) {\n        super(subscriber =>\n            this.src$\n                .pipe(\n                    switchMap(src =>\n                        intersections$.pipe(\n                            filter(([{isIntersecting}]) => isIntersecting),\n                            mapTo(src),\n                            catchError(() => of(src)),\n                            watch(changeDetectorRef),\n                            take(1),\n                        ),\n                    ),\n                    takeUntil(destroy$),\n                )\n                .subscribe(subscriber),\n        );\n    }\n\n    next(src: SafeResourceUrl | string): void {\n        this.src$.next(src);\n    }\n}\n","import {\n    Directive,\n    ElementRef,\n    HostBinding,\n    HostListener,\n    Inject,\n    Input,\n} from '@angular/core';\nimport {SafeResourceUrl} from '@angular/platform-browser';\nimport {IntersectionObserverService} from '@ng-web-apis/intersection-observer';\nimport {TuiDestroyService} from '@taiga-ui/cdk';\n\nimport {TuiLazyLoadingService} from './lazy-loading.service';\n\n@Directive({\n    selector: 'img[loading=\"lazy\"]',\n    providers: [TuiLazyLoadingService, IntersectionObserverService, TuiDestroyService],\n})\nexport class TuiLazyLoadingDirective {\n    @Input('src')\n    set srcSetter(src: SafeResourceUrl | string) {\n        this.src = this.supported ? src : null;\n        this.src$.next(src);\n    }\n\n    @HostBinding('style.animation')\n    animation = 'tuiSkeletonVibe ease-in-out 1s infinite alternate';\n\n    @HostBinding('style.background')\n    background = 'var(--tui-clear-hover)';\n\n    @HostBinding('attr.src')\n    src: SafeResourceUrl | string | null = null;\n\n    constructor(\n        @Inject(TuiLazyLoadingService)\n        private readonly src$: TuiLazyLoadingService,\n        @Inject(ElementRef)\n        private readonly elementRef: ElementRef<HTMLImageElement>,\n    ) {\n        if (!this.supported) {\n            this.src$.subscribe(src => {\n                this.src = src;\n            });\n        }\n    }\n\n    private get supported(): boolean {\n        return 'loading' in this.elementRef.nativeElement;\n    }\n\n    @HostListener('load')\n    onLoad(): void {\n        this.background = '';\n        this.animation = '';\n    }\n}\n","import {NgModule} from '@angular/core';\n\nimport {TuiLazyLoadingDirective} from './lazy-loading.directive';\n\n@NgModule({\n    declarations: [TuiLazyLoadingDirective],\n    exports: [TuiLazyLoadingDirective],\n})\nexport class TuiLazyLoadingModule {}\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './index';\n"],"names":[],"mappings":"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"}