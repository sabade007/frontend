{"version":3,"file":"taiga-ui-kit-internal-primitive-calendar-range.js","sources":["ng://@taiga-ui/kit/internal/primitive-calendar-range/primitive-calendar-range.component.ts","ng://@taiga-ui/kit/internal/primitive-calendar-range/primitive-calendar-range.module.ts","ng://@taiga-ui/kit/internal/primitive-calendar-range/taiga-ui-kit-internal-primitive-calendar-range.ts"],"sourcesContent":["import {\n    ChangeDetectionStrategy,\n    ChangeDetectorRef,\n    Component,\n    EventEmitter,\n    Inject,\n    Input,\n    OnInit,\n    Optional,\n    Output,\n} from '@angular/core';\nimport {\n    ALWAYS_FALSE_HANDLER,\n    TUI_FIRST_DAY,\n    TUI_LAST_DAY,\n    TuiBooleanHandler,\n    TuiDay,\n    TuiDayRange,\n    tuiDefaultProp,\n    TuiDestroyService,\n    TuiMapper,\n    TuiMonth,\n    watch,\n} from '@taiga-ui/cdk';\nimport {TUI_DEFAULT_MARKER_HANDLER, TuiMarkerHandler} from '@taiga-ui/core';\nimport {TUI_CALENDAR_DATA_STREAM} from '@taiga-ui/kit/tokens';\nimport {Observable} from 'rxjs';\nimport {takeUntil} from 'rxjs/operators';\n\n/**\n * @internal\n */\n@Component({\n    selector: 'tui-primitive-calendar-range',\n    templateUrl: './primitive-calendar-range.template.html',\n    styleUrls: ['./primitive-calendar-range.style.less'],\n    changeDetection: ChangeDetectionStrategy.OnPush,\n    providers: [TuiDestroyService],\n})\nexport class TuiPrimitiveCalendarRangeComponent implements OnInit {\n    @Input()\n    @tuiDefaultProp()\n    disabledItemHandler: TuiBooleanHandler<TuiDay> = ALWAYS_FALSE_HANDLER;\n\n    @Input()\n    @tuiDefaultProp()\n    markerHandler: TuiMarkerHandler = TUI_DEFAULT_MARKER_HANDLER;\n\n    @Input()\n    @tuiDefaultProp()\n    defaultViewedMonthFirst = TuiMonth.currentLocal();\n\n    @Input()\n    @tuiDefaultProp()\n    defaultViewedMonthSecond = TuiMonth.currentLocal().append({month: 1});\n\n    @Input()\n    @tuiDefaultProp()\n    min = TUI_FIRST_DAY;\n\n    @Input()\n    @tuiDefaultProp()\n    max = TUI_LAST_DAY;\n\n    @Input()\n    @tuiDefaultProp()\n    value: TuiDayRange | null = null;\n\n    @Output()\n    readonly dayClick = new EventEmitter<TuiDay>();\n\n    hoveredItem: TuiDay | null = null;\n\n    userViewedMonthFirst: TuiMonth = this.defaultViewedMonthFirst;\n    userViewedMonthSecond: TuiMonth = this.defaultViewedMonthSecond;\n\n    constructor(\n        @Inject(TUI_CALENDAR_DATA_STREAM)\n        @Optional()\n        valueChanges: Observable<TuiDayRange | null> | null,\n        @Inject(ChangeDetectorRef) changeDetectorRef: ChangeDetectorRef,\n        @Inject(TuiDestroyService) destroy$: TuiDestroyService,\n    ) {\n        if (!valueChanges) {\n            return;\n        }\n\n        valueChanges\n            .pipe(watch(changeDetectorRef), takeUntil(destroy$))\n            .subscribe(value => {\n                this.value = value;\n                this.updateViewedMonths();\n            });\n    }\n\n    get cappedUserViewedMonthSecond(): TuiMonth {\n        return this.userViewedMonthSecond.monthBefore(this.max)\n            ? this.userViewedMonthSecond\n            : this.max;\n    }\n\n    get cappedUserViewedMonthFirst(): TuiMonth {\n        return this.userViewedMonthFirst.monthSameOrBefore(this.userViewedMonthSecond)\n            ? this.userViewedMonthFirst\n            : this.userViewedMonthSecond;\n    }\n\n    monthOffset: TuiMapper<TuiMonth, TuiMonth> = (value, offset: number) =>\n        value.append({month: offset});\n\n    ngOnInit(): void {\n        this.setInitialMonths();\n    }\n\n    onSectionFirstViewedMonth(month: TuiMonth): void {\n        this.userViewedMonthFirst = month;\n\n        if (this.userViewedMonthSecond.year < this.userViewedMonthFirst.year) {\n            this.userViewedMonthSecond = this.userViewedMonthSecond.append({\n                year: month.year - this.userViewedMonthSecond.year,\n            });\n        }\n    }\n\n    onSectionSecondViewedMonth(month: TuiMonth): void {\n        this.userViewedMonthSecond = month;\n\n        if (this.userViewedMonthFirst.year > this.userViewedMonthSecond.year) {\n            this.userViewedMonthFirst = this.userViewedMonthFirst.append({\n                year: month.year - this.userViewedMonthFirst.year,\n            });\n        }\n    }\n\n    onDayClick(day: TuiDay): void {\n        this.dayClick.emit(day);\n    }\n\n    private setInitialMonths(): void {\n        if (!this.value) {\n            this.userViewedMonthSecond = this.updatedViewedMonthSecond(\n                this.defaultViewedMonthSecond,\n            );\n\n            this.userViewedMonthFirst = this.updatedViewedMonthFirst(\n                this.defaultViewedMonthFirst,\n            );\n        }\n    }\n\n    private updatedViewedMonthSecond(month: TuiMonth): TuiMonth {\n        if (month.monthSameOrAfter(this.max)) {\n            return this.max;\n        }\n\n        if (month.monthBefore(this.min)) {\n            return this.min.append({month: 1});\n        }\n\n        return month;\n    }\n\n    private updatedViewedMonthFirst(month: TuiMonth): TuiMonth {\n        if (month.monthSameOrAfter(this.userViewedMonthSecond)) {\n            return this.userViewedMonthSecond.append({month: -1});\n        }\n\n        if (month.monthSameOrBefore(this.min)) {\n            return this.min;\n        }\n\n        return month;\n    }\n\n    private updateViewedMonths(): void {\n        this.userViewedMonthFirst =\n            this.value === null ? this.defaultViewedMonthFirst : this.value.from;\n        this.userViewedMonthSecond =\n            this.value === null ? this.defaultViewedMonthSecond : this.value.to;\n\n        if (this.userViewedMonthFirst.monthSame(this.userViewedMonthSecond)) {\n            this.userViewedMonthSecond = this.userViewedMonthSecond.append({month: 1});\n        }\n    }\n}\n","import {NgModule} from '@angular/core';\nimport {TuiMapperPipeModule} from '@taiga-ui/cdk';\nimport {TuiCalendarModule, TuiScrollbarModule} from '@taiga-ui/core';\n\nimport {TuiPrimitiveCalendarRangeComponent} from './primitive-calendar-range.component';\n\n/**\n * @internal\n */\n@NgModule({\n    imports: [TuiMapperPipeModule, TuiScrollbarModule, TuiCalendarModule],\n    declarations: [TuiPrimitiveCalendarRangeComponent],\n    exports: [TuiPrimitiveCalendarRangeComponent],\n})\nexport class TuiPrimitiveCalendarRangeModule {}\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './index';\n"],"names":[],"mappings":"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"}