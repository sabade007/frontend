{"version":3,"file":"taiga-ui-kit-directives-dropdown-context.js","sources":["ng://@taiga-ui/kit/directives/dropdown-context/dropdown-context.directive.ts","ng://@taiga-ui/kit/directives/dropdown-context/dropdown-context.module.ts","ng://@taiga-ui/kit/directives/dropdown-context/taiga-ui-kit-directives-dropdown-context.ts"],"sourcesContent":["import {DOCUMENT} from '@angular/common';\nimport {\n    ComponentFactoryResolver,\n    Directive,\n    ElementRef,\n    forwardRef,\n    HostListener,\n    Inject,\n    Injector,\n    Input,\n} from '@angular/core';\nimport {\n    EMPTY_CLIENT_RECT,\n    getClosestFocusable,\n    getNativeFocused,\n    setNativeFocused,\n    TuiActiveZoneDirective,\n    tuiDefaultProp,\n    TuiDestroyService,\n    tuiPointToClientRect,\n    TuiPortalService,\n} from '@taiga-ui/cdk';\nimport {AbstractTuiDropdown, TUI_DROPDOWN_DIRECTIVE, TuiDropdown} from '@taiga-ui/core';\nimport {PolymorpheusContent} from '@tinkoff/ng-polymorpheus';\nimport {EMPTY, Observable} from 'rxjs';\nimport {filter, takeUntil} from 'rxjs/operators';\n\n// @dynamic\n@Directive({\n    selector: '[tuiDropdownContext]',\n    providers: [\n        TuiDestroyService,\n        TuiActiveZoneDirective,\n        {\n            provide: TUI_DROPDOWN_DIRECTIVE,\n            useExisting: forwardRef(() => TuiDropdownContextDirective),\n        },\n    ],\n})\nexport class TuiDropdownContextDirective\n    extends AbstractTuiDropdown\n    implements TuiDropdown\n{\n    private lastClickedClientRect = EMPTY_CLIENT_RECT;\n\n    @Input('tuiDropdownContext')\n    @tuiDefaultProp()\n    content: PolymorpheusContent = '';\n\n    readonly refresh$ = EMPTY;\n\n    readonly context = {close: () => this.closeDropdownBox()};\n\n    constructor(\n        protected readonly elementRef: ElementRef,\n        @Inject(DOCUMENT) private readonly documentRef: Document,\n        @Inject(TuiDestroyService) destroy$: Observable<unknown>,\n        @Inject(ComponentFactoryResolver)\n        componentFactoryResolver: ComponentFactoryResolver,\n        @Inject(Injector) injector: Injector,\n        @Inject(TuiPortalService) portalService: TuiPortalService,\n        readonly activeZone: TuiActiveZoneDirective,\n    ) {\n        super(componentFactoryResolver, injector, portalService, elementRef, activeZone);\n\n        activeZone.tuiActiveZoneChange\n            .pipe(\n                filter(isActive => !isActive),\n                takeUntil(destroy$),\n            )\n            .subscribe(() => this.closeDropdownBox());\n    }\n\n    get clientRect(): ClientRect {\n        return this.lastClickedClientRect;\n    }\n\n    get fixed(): boolean {\n        return true;\n    }\n\n    private get dropdownContent(): HTMLElement | null {\n        return this.dropdownBoxRef?.instance.contentElementRef?.nativeElement || null;\n    }\n\n    @HostListener('click')\n    onHostClick(): void {\n        this.closeDropdownBox();\n    }\n\n    @HostListener('contextmenu.prevent', ['$event.clientX', '$event.clientY'])\n    onContextMenu(x: number, y: number): void {\n        this.closeDropdownBox();\n        this.openDropdown(x, y);\n    }\n\n    @HostListener('document:contextmenu', ['$event.target'])\n    onAnotherContextOpen(target: HTMLElement): void {\n        const isAnotherContextOpened = !this.elementRef.nativeElement.contains(target);\n\n        if (isAnotherContextOpened) {\n            this.closeDropdownBox();\n        }\n    }\n\n    @HostListener('document:keydown.arrowDown', ['$event', 'true'])\n    @HostListener('document:keydown.arrowUp', ['$event', 'false'])\n    onArrow(event: KeyboardEvent, down: boolean): void {\n        const activeElement = getNativeFocused(this.documentRef);\n        const focusInside = activeElement && this.activeZone.contains(activeElement);\n\n        if (!this.dropdownContent || focusInside) {\n            return;\n        }\n\n        event.preventDefault();\n\n        const nextEl = this.dropdownContent.nextElementSibling;\n        const initial =\n            down || !this.checkIsFocusableElement(nextEl) ? this.dropdownContent : nextEl;\n        const focusable = getClosestFocusable(initial, !down, this.dropdownContent);\n\n        if (focusable === null) {\n            return;\n        }\n\n        setNativeFocused(focusable);\n    }\n\n    @HostListener('document:keydown.esc', ['$event'])\n    onKeyDownEsc(event: KeyboardEvent): void {\n        if (!this.dropdownContent) {\n            return;\n        }\n\n        event.stopPropagation();\n        this.closeDropdownBox();\n    }\n\n    private openDropdown(x: number, y: number): void {\n        this.lastClickedClientRect = tuiPointToClientRect(x, y);\n        this.openDropdownBox();\n    }\n\n    private checkIsFocusableElement(element: Element | null): element is HTMLElement {\n        return !!element && 'focus' in element && 'blur' in element;\n    }\n}\n","import {NgModule} from '@angular/core';\nimport {TuiDropdownBoxModule} from '@taiga-ui/core';\n\nimport {TuiDropdownContextDirective} from './dropdown-context.directive';\n\n@NgModule({\n    imports: [TuiDropdownBoxModule],\n    declarations: [TuiDropdownContextDirective],\n    exports: [TuiDropdownContextDirective],\n})\nexport class TuiDropdownContextModule {}\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './index';\n"],"names":[],"mappings":"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"}