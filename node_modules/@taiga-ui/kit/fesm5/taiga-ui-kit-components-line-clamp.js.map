{"version":3,"file":"taiga-ui-kit-components-line-clamp.js","sources":["ng://@taiga-ui/kit/components/line-clamp/line-clamp-options.ts","ng://@taiga-ui/kit/components/line-clamp/line-clamp.component.ts","ng://@taiga-ui/kit/components/line-clamp/line-clamp.module.ts","ng://@taiga-ui/kit/components/line-clamp/taiga-ui-kit-components-line-clamp.ts"],"sourcesContent":["import {InjectionToken, ValueProvider} from '@angular/core';\n\nexport interface TuiLineClampOptions {\n    readonly showHint: boolean;\n}\n\nexport const TUI_LINE_CLAMP_DEFAULT_OPTIONS: TuiLineClampOptions = {\n    showHint: true,\n};\n\nexport const TUI_LINE_CLAMP_OPTIONS = new InjectionToken<TuiLineClampOptions>(\n    `Default parameters for line-clamp component`,\n    {\n        factory: () => TUI_LINE_CLAMP_DEFAULT_OPTIONS,\n    },\n);\n\nexport const tuiLineClampOptionsProvider: (\n    options: Partial<TuiLineClampOptions>,\n) => ValueProvider = (options: Partial<TuiLineClampOptions>) => ({\n    provide: TUI_LINE_CLAMP_OPTIONS,\n    useValue: {...TUI_LINE_CLAMP_DEFAULT_OPTIONS, ...options},\n});\n","import {\n    AfterViewInit,\n    ChangeDetectionStrategy,\n    ChangeDetectorRef,\n    Component,\n    DoCheck,\n    ElementRef,\n    HostListener,\n    Inject,\n    Input,\n    NgZone,\n    Output,\n    Renderer2,\n    ViewChild,\n} from '@angular/core';\nimport {\n    isCurrentTarget,\n    tuiDefaultProp,\n    tuiPure,\n    tuiPx,\n    typedFromEvent,\n} from '@taiga-ui/cdk';\nimport {PolymorpheusContent, PolymorpheusOutletComponent} from '@tinkoff/ng-polymorpheus';\nimport {BehaviorSubject, Observable, of, Subject} from 'rxjs';\nimport {\n    distinctUntilChanged,\n    filter,\n    mapTo,\n    pairwise,\n    startWith,\n    switchMap,\n} from 'rxjs/operators';\n\nimport {TUI_LINE_CLAMP_OPTIONS, TuiLineClampOptions} from './line-clamp-options';\n\n@Component({\n    selector: 'tui-line-clamp',\n    templateUrl: './line-clamp.template.html',\n    styleUrls: ['./line-clamp.style.less'],\n    changeDetection: ChangeDetectionStrategy.OnPush,\n})\nexport class TuiLineClampComponent implements AfterViewInit, DoCheck {\n    @ViewChild(PolymorpheusOutletComponent, {read: ElementRef})\n    private readonly outlet?: ElementRef<HTMLElement>;\n\n    private readonly linesLimit$ = new BehaviorSubject(1);\n    private readonly isOverflown$ = new Subject<boolean>();\n    private initialized = false;\n\n    @Input()\n    @tuiDefaultProp()\n    set linesLimit(linesLimit: number) {\n        this.linesLimit$.next(linesLimit);\n    }\n\n    @Input()\n    @tuiDefaultProp()\n    lineHeight = 24;\n\n    @Input()\n    @tuiDefaultProp()\n    content: PolymorpheusContent = '';\n\n    @Output()\n    readonly overflownChange: Observable<boolean> = this.isOverflown$.pipe(\n        distinctUntilChanged(),\n    );\n\n    constructor(\n        @Inject(ElementRef) private readonly elementRef: ElementRef<HTMLElement>,\n        @Inject(Renderer2) private readonly renderer: Renderer2,\n        @Inject(ChangeDetectorRef) private readonly cd: ChangeDetectorRef,\n        @Inject(NgZone) private readonly ngZone: NgZone,\n        @Inject(TUI_LINE_CLAMP_OPTIONS) private readonly options: TuiLineClampOptions,\n    ) {\n        this.skipInitialTransition();\n    }\n\n    @tuiPure\n    get lineClamp$(): Observable<number> {\n        return this.linesLimit$.pipe(\n            startWith(1),\n            pairwise(),\n            switchMap(([prev, next]) =>\n                next >= prev\n                    ? of(next)\n                    : typedFromEvent(this.elementRef.nativeElement, 'transitionend').pipe(\n                          filter(isCurrentTarget),\n                          mapTo(next),\n                      ),\n            ),\n        );\n    }\n\n    get overflown(): boolean {\n        if (!this.outlet) {\n            return false;\n        }\n\n        const {scrollHeight, scrollWidth} = this.outlet.nativeElement;\n        const {clientHeight, clientWidth} = this.elementRef.nativeElement;\n\n        // 4px buffer for IE/Edge incorrectly rounding scrollHeight\n        return scrollHeight - clientHeight > 4 || scrollWidth - clientWidth > 0;\n    }\n\n    get computedContent(): PolymorpheusContent {\n        return this.options.showHint && this.overflown ? this.content : '';\n    }\n\n    @HostListener('transitionend')\n    updateView(): void {\n        this.cd.detectChanges();\n    }\n\n    ngAfterViewInit(): void {\n        this.initialized = true;\n    }\n\n    ngDoCheck(): void {\n        this.update();\n        this.isOverflown$.next(this.overflown);\n    }\n\n    private skipInitialTransition(): void {\n        this.ngZone.runOutsideAngular(() => {\n            setTimeout(() => {\n                this.renderer.addClass(this.elementRef.nativeElement, '_initialized');\n                this.cd.detectChanges();\n            });\n        });\n    }\n\n    private update(): void {\n        if (this.outlet) {\n            this.renderer.setStyle(\n                this.elementRef.nativeElement,\n                'height',\n                tuiPx(this.outlet.nativeElement.scrollHeight + 4),\n            );\n        }\n\n        if (this.initialized) {\n            this.renderer.setStyle(\n                this.elementRef.nativeElement,\n                'max-height',\n                tuiPx(this.lineHeight * this.linesLimit$.value),\n            );\n        }\n    }\n}\n","import {CommonModule} from '@angular/common';\nimport {NgModule} from '@angular/core';\nimport {TuiLetModule, TuiResizeModule} from '@taiga-ui/cdk';\nimport {TuiHintModule} from '@taiga-ui/core';\nimport {PolymorpheusModule} from '@tinkoff/ng-polymorpheus';\n\nimport {TuiLineClampComponent} from './line-clamp.component';\n\n@NgModule({\n    imports: [\n        CommonModule,\n        PolymorpheusModule,\n        TuiHintModule,\n        TuiResizeModule,\n        TuiLetModule,\n    ],\n    declarations: [TuiLineClampComponent],\n    exports: [TuiLineClampComponent],\n})\nexport class TuiLineClampModule {}\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './index';\n"],"names":[],"mappings":";;;;;;;;;IAMa,8BAA8B,GAAwB;IAC/D,QAAQ,EAAE,IAAI;EAChB;IAEW,sBAAsB,GAAG,IAAI,cAAc,CACpD,6CAA6C,EAC7C;IACI,OAAO,EAAE,cAAM,OAAA,8BAA8B,GAAA;CAChD,EACH;IAEW,2BAA2B,GAEnB,UAAC,OAAqC,IAAK,QAAC;IAC7D,OAAO,EAAE,sBAAsB;IAC/B,QAAQ,wBAAM,8BAA8B,GAAK,OAAO,CAAC;CAC5D;;;IC8CG,+BACyC,UAAmC,EACpC,QAAmB,EACX,EAAqB,EAChC,MAAc,EACE,OAA4B;QAJxC,eAAU,GAAV,UAAU,CAAyB;QACpC,aAAQ,GAAR,QAAQ,CAAW;QACX,OAAE,GAAF,EAAE,CAAmB;QAChC,WAAM,GAAN,MAAM,CAAQ;QACE,YAAO,GAAP,OAAO,CAAqB;QA5BhE,gBAAW,GAAG,IAAI,eAAe,CAAC,CAAC,CAAC,CAAC;QACrC,iBAAY,GAAG,IAAI,OAAO,EAAW,CAAC;QAC/C,gBAAW,GAAG,KAAK,CAAC;QAU5B,eAAU,GAAG,EAAE,CAAC;QAIhB,YAAO,GAAwB,EAAE,CAAC;QAGzB,oBAAe,GAAwB,IAAI,CAAC,YAAY,CAAC,IAAI,CAClE,oBAAoB,EAAE,CACzB,CAAC;QASE,IAAI,CAAC,qBAAqB,EAAE,CAAC;KAChC;IAzBD,sBAAI,6CAAU;aAAd,UAAe,UAAkB;YAC7B,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;SACrC;;;OAAA;IA0BD,sBAAI,6CAAU;aAAd;YADA,iBAcC;YAZG,OAAO,IAAI,CAAC,WAAW,CAAC,IAAI,CACxB,SAAS,CAAC,CAAC,CAAC,EACZ,QAAQ,EAAE,EACV,SAAS,CAAC,UAAC,EAAY;oBAAZ,kBAAY,EAAX,YAAI,EAAE,YAAI;gBAClB,OAAA,IAAI,IAAI,IAAI;sBACN,EAAE,CAAC,IAAI,CAAC;sBACR,cAAc,CAAC,KAAI,CAAC,UAAU,CAAC,aAAa,EAAE,eAAe,CAAC,CAAC,IAAI,CAC/D,MAAM,CAAC,eAAe,CAAC,EACvB,KAAK,CAAC,IAAI,CAAC,CACd;aAAA,CACV,CACJ,CAAC;SACL;;;OAAA;IAED,sBAAI,4CAAS;aAAb;YACI,IAAI,CAAC,IAAI,CAAC,MAAM,EAAE;gBACd,OAAO,KAAK,CAAC;aAChB;YAEK,IAAA,8BAAuD,EAAtD,8BAAY,EAAE,4BAAwC,CAAC;YACxD,IAAA,kCAA2D,EAA1D,8BAAY,EAAE,4BAA4C,CAAC;;YAGlE,OAAO,YAAY,GAAG,YAAY,GAAG,CAAC,IAAI,WAAW,GAAG,WAAW,GAAG,CAAC,CAAC;SAC3E;;;OAAA;IAED,sBAAI,kDAAe;aAAnB;YACI,OAAO,IAAI,CAAC,OAAO,CAAC,QAAQ,IAAI,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC,OAAO,GAAG,EAAE,CAAC;SACtE;;;OAAA;IAGD,0CAAU,GAAV;QACI,IAAI,CAAC,EAAE,CAAC,aAAa,EAAE,CAAC;KAC3B;IAED,+CAAe,GAAf;QACI,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC;KAC3B;IAED,yCAAS,GAAT;QACI,IAAI,CAAC,MAAM,EAAE,CAAC;QACd,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;KAC1C;IAEO,qDAAqB,GAA7B;QAAA,iBAOC;QANG,IAAI,CAAC,MAAM,CAAC,iBAAiB,CAAC;YAC1B,UAAU,CAAC;gBACP,KAAI,CAAC,QAAQ,CAAC,QAAQ,CAAC,KAAI,CAAC,UAAU,CAAC,aAAa,EAAE,cAAc,CAAC,CAAC;gBACtE,KAAI,CAAC,EAAE,CAAC,aAAa,EAAE,CAAC;aAC3B,CAAC,CAAC;SACN,CAAC,CAAC;KACN;IAEO,sCAAM,GAAd;QACI,IAAI,IAAI,CAAC,MAAM,EAAE;YACb,IAAI,CAAC,QAAQ,CAAC,QAAQ,CAClB,IAAI,CAAC,UAAU,CAAC,aAAa,EAC7B,QAAQ,EACR,KAAK,CAAC,IAAI,CAAC,MAAM,CAAC,aAAa,CAAC,YAAY,GAAG,CAAC,CAAC,CACpD,CAAC;SACL;QAED,IAAI,IAAI,CAAC,WAAW,EAAE;YAClB,IAAI,CAAC,QAAQ,CAAC,QAAQ,CAClB,IAAI,CAAC,UAAU,CAAC,aAAa,EAC7B,YAAY,EACZ,KAAK,CAAC,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC,WAAW,CAAC,KAAK,CAAC,CAClD,CAAC;SACL;KACJ;;gBAhFoD,UAAU,uBAA1D,MAAM,SAAC,UAAU;gBAC4B,SAAS,uBAAtD,MAAM,SAAC,SAAS;gBAC+B,iBAAiB,uBAAhE,MAAM,SAAC,iBAAiB;gBACgB,MAAM,uBAA9C,MAAM,SAAC,MAAM;gDACb,MAAM,SAAC,sBAAsB;;IA9BlC;QADC,SAAS,CAAC,2BAA2B,EAAE,EAAC,IAAI,EAAE,UAAU,EAAC,CAAC;yDACT;IAQlD;QAFC,KAAK,EAAE;QACP,cAAc,EAAE;2DAGhB;IAID;QAFC,KAAK,EAAE;QACP,cAAc,EAAE;6DACD;IAIhB;QAFC,KAAK,EAAE;QACP,cAAc,EAAE;0DACiB;IAGlC;QADC,MAAM,EAAE;kEAGP;IAaF;QADC,OAAO;2DAcP;IAmBD;QADC,YAAY,CAAC,eAAe,CAAC;2DAG7B;IAxEQ,qBAAqB;QANjC,SAAS,CAAC;YACP,QAAQ,EAAE,gBAAgB;YAC1B,gZAAyC;YAEzC,eAAe,EAAE,uBAAuB,CAAC,MAAM;;SAClD,CAAC;QA6BO,WAAA,MAAM,CAAC,UAAU,CAAC,CAAA;QAClB,WAAA,MAAM,CAAC,SAAS,CAAC,CAAA;QACjB,WAAA,MAAM,CAAC,iBAAiB,CAAC,CAAA;QACzB,WAAA,MAAM,CAAC,MAAM,CAAC,CAAA;QACd,WAAA,MAAM,CAAC,sBAAsB,CAAC,CAAA;OAhC1B,qBAAqB,CA6GjC;IAAD,4BAAC;CA7GD;;;ICtBA;KAAkC;IAArB,kBAAkB;QAX9B,QAAQ,CAAC;YACN,OAAO,EAAE;gBACL,YAAY;gBACZ,kBAAkB;gBAClB,aAAa;gBACb,eAAe;gBACf,YAAY;aACf;YACD,YAAY,EAAE,CAAC,qBAAqB,CAAC;YACrC,OAAO,EAAE,CAAC,qBAAqB,CAAC;SACnC,CAAC;OACW,kBAAkB,CAAG;IAAD,yBAAC;CAAlC;;ACnBA;;;;;;"}