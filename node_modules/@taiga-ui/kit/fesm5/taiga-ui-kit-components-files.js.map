{"version":3,"file":"taiga-ui-kit-components-files.js","sources":["ng://@taiga-ui/kit/components/files/file/file.component.ts","ng://@taiga-ui/kit/components/files/files.component.ts","ng://@taiga-ui/kit/components/files/files.module.ts","ng://@taiga-ui/kit/components/files/taiga-ui-kit-components-files.ts"],"sourcesContent":["import {\n    ChangeDetectionStrategy,\n    Component,\n    EventEmitter,\n    HostBinding,\n    Inject,\n    Input,\n    Output,\n} from '@angular/core';\nimport {DomSanitizer, SafeValue} from '@angular/platform-browser';\nimport {TUI_IS_MOBILE, tuiDefaultProp, tuiIsObserved, tuiPure} from '@taiga-ui/cdk';\nimport {TuiSizeL} from '@taiga-ui/core';\nimport {TuiFileState, TuiFileStateT} from '@taiga-ui/kit/enums';\nimport {TuiFileLike} from '@taiga-ui/kit/interfaces';\nimport {TUI_DIGITAL_INFORMATION_UNITS, TUI_FILE_TEXTS} from '@taiga-ui/kit/tokens';\nimport {formatSize} from '@taiga-ui/kit/utils/files';\nimport {PolymorpheusContent} from '@tinkoff/ng-polymorpheus';\nimport {Observable, of} from 'rxjs';\nimport {map} from 'rxjs/operators';\n\ntype FileTexts = 'loadingError' | 'preview' | 'remove';\n\n// @dynamic\n@Component({\n    selector: 'tui-file',\n    changeDetection: ChangeDetectionStrategy.OnPush,\n    templateUrl: './file.template.html',\n    styleUrls: ['./file.style.less'],\n})\nexport class TuiFileComponent {\n    @Input()\n    @tuiDefaultProp()\n    file: TuiFileLike = {name: ''};\n\n    @Input()\n    @tuiDefaultProp()\n    state: TuiFileStateT = 'normal';\n\n    @Input()\n    @tuiDefaultProp()\n    size: TuiSizeL = 'm';\n\n    @Input()\n    @tuiDefaultProp()\n    showSize = true;\n\n    @Input()\n    @tuiDefaultProp()\n    leftContent: PolymorpheusContent = '';\n\n    @Output()\n    readonly removed = new EventEmitter<void>();\n\n    @HostBinding('class._focused')\n    focused = false;\n\n    constructor(\n        @Inject(TUI_IS_MOBILE) readonly isMobile: boolean,\n        @Inject(DomSanitizer) private readonly sanitizer: DomSanitizer,\n        @Inject(TUI_FILE_TEXTS)\n        readonly fileTexts$: Observable<Record<FileTexts, string>>,\n        @Inject(TUI_DIGITAL_INFORMATION_UNITS)\n        private readonly units$: Observable<[string, string, string]>,\n    ) {}\n\n    get preview(): SafeValue {\n        return this.isBig ? this.createPreview(this.file, this.sanitizer) : '';\n    }\n\n    get isBig(): boolean {\n        return this.size === 'l';\n    }\n\n    get isLoading(): boolean {\n        return this.state === TuiFileState.Loading;\n    }\n\n    get isError(): boolean {\n        return this.state === TuiFileState.Error;\n    }\n\n    get isDeleted(): boolean {\n        return this.state === TuiFileState.Deleted;\n    }\n\n    get allowDelete(): boolean {\n        return tuiIsObserved(this.removed);\n    }\n\n    get icon(): string {\n        if (this.state === TuiFileState.Normal && this.isBig) {\n            return 'tuiIconDefaultDocLarge';\n        }\n\n        switch (this.state) {\n            case TuiFileState.Deleted:\n                return 'tuiIconTrashLarge';\n            case TuiFileState.Error:\n                return 'tuiIconAlertCircleLarge';\n            default:\n                return 'tuiIconCheckCircleLarge';\n        }\n    }\n\n    @HostBinding('class._link')\n    get src(): string {\n        return this.file.src || '';\n    }\n\n    get name(): string {\n        return this.getName(this.file);\n    }\n\n    get type(): string {\n        return this.getType(this.file);\n    }\n\n    get content$(): Observable<PolymorpheusContent> {\n        return this.calculateContent$(this.state, this.file, this.fileTexts$);\n    }\n\n    get fileSize$(): Observable<string | null> {\n        return this.calculateFileSize$(this.file, this.units$);\n    }\n\n    onRemoveClick(): void {\n        this.removed.emit();\n    }\n\n    onFocusVisible(focusVisible: boolean): void {\n        this.focused = focusVisible;\n    }\n\n    @tuiPure\n    private calculateContent$(\n        state: TuiFileStateT,\n        file: TuiFileLike,\n        fileTexts$: Observable<Record<'loadingError' | 'preview' | 'remove', string>>,\n    ): Observable<PolymorpheusContent> {\n        return state === TuiFileState.Error && !file.content\n            ? fileTexts$.pipe(map(texts => texts.loadingError))\n            : of(this.file.content || '');\n    }\n\n    @tuiPure\n    private calculateFileSize$(\n        file: TuiFileLike,\n        units$: Observable<[string, string, string]>,\n    ): Observable<string | null> {\n        return units$.pipe(map(units => formatSize(units, file.size)));\n    }\n\n    @tuiPure\n    private createPreview(file: TuiFileLike, sanitizer: DomSanitizer): SafeValue {\n        if (file.src) {\n            return file.src;\n        }\n\n        // TODO: iframe warning\n        if (file instanceof File && file.type && file.type.startsWith('image/')) {\n            return sanitizer.bypassSecurityTrustUrl(URL.createObjectURL(file));\n        }\n\n        return '';\n    }\n\n    @tuiPure\n    private getName(file: TuiFileLike): string {\n        return file.name.split('.').slice(0, -1).join('.');\n    }\n\n    @tuiPure\n    private getType(file: TuiFileLike): string {\n        return `.${file.name.split('.').pop()}` || '';\n    }\n}\n","import {\n    ChangeDetectionStrategy,\n    Component,\n    ContentChildren,\n    Inject,\n    Input,\n    QueryList,\n    TemplateRef,\n    ViewEncapsulation,\n} from '@angular/core';\nimport {tuiDefaultProp, TuiItemDirective} from '@taiga-ui/cdk';\nimport {TUI_HIDE_TEXT, TUI_SHOW_ALL_TEXT} from '@taiga-ui/kit/tokens';\nimport {Observable} from 'rxjs';\n\n@Component({\n    selector: 'tui-files',\n    templateUrl: './files.component.html',\n    styleUrls: ['./files.component.less'],\n    changeDetection: ChangeDetectionStrategy.OnPush,\n    encapsulation: ViewEncapsulation.None,\n})\nexport class TuiFilesComponent {\n    @ContentChildren(TuiItemDirective, {read: TemplateRef})\n    readonly items: QueryList<TemplateRef<Record<string, unknown>>> | null = null;\n\n    @Input()\n    @tuiDefaultProp()\n    max = 0;\n\n    hidden = true;\n\n    constructor(\n        @Inject(TUI_HIDE_TEXT) readonly hideText$: Observable<string>,\n        @Inject(TUI_SHOW_ALL_TEXT) readonly showAllText$: Observable<string>,\n    ) {}\n\n    get hasExtraItems(): boolean {\n        return !!this.max && (this.items?.length ?? 0) > this.max;\n    }\n\n    toggle(): void {\n        this.hidden = !this.hidden;\n    }\n}\n","import {CommonModule} from '@angular/common';\nimport {NgModule} from '@angular/core';\nimport {TuiFocusVisibleModule, TuiItemDirective, TuiItemModule} from '@taiga-ui/cdk';\nimport {\n    TuiButtonModule,\n    TuiExpandModule,\n    TuiGroupModule,\n    TuiLoaderModule,\n    TuiSvgModule,\n} from '@taiga-ui/core';\nimport {PolymorpheusModule} from '@tinkoff/ng-polymorpheus';\n\nimport {TuiFileComponent} from './file/file.component';\nimport {TuiFilesComponent} from './files.component';\n\n@NgModule({\n    declarations: [TuiFilesComponent, TuiFileComponent],\n    imports: [\n        CommonModule,\n        TuiGroupModule,\n        TuiLoaderModule,\n        PolymorpheusModule,\n        TuiSvgModule,\n        TuiFocusVisibleModule,\n        TuiButtonModule,\n        TuiItemModule,\n        TuiExpandModule,\n    ],\n    exports: [TuiFilesComponent, TuiFileComponent, TuiItemDirective],\n})\nexport class TuiFilesModule {}\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './index';\n"],"names":[],"mappings":"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"}