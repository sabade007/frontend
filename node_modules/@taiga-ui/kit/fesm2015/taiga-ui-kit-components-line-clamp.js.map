{"version":3,"file":"taiga-ui-kit-components-line-clamp.js","sources":["ng://@taiga-ui/kit/components/line-clamp/line-clamp-options.ts","ng://@taiga-ui/kit/components/line-clamp/line-clamp.component.ts","ng://@taiga-ui/kit/components/line-clamp/line-clamp.module.ts","ng://@taiga-ui/kit/components/line-clamp/taiga-ui-kit-components-line-clamp.ts"],"sourcesContent":["import {InjectionToken, ValueProvider} from '@angular/core';\n\nexport interface TuiLineClampOptions {\n    readonly showHint: boolean;\n}\n\nexport const TUI_LINE_CLAMP_DEFAULT_OPTIONS: TuiLineClampOptions = {\n    showHint: true,\n};\n\nexport const TUI_LINE_CLAMP_OPTIONS = new InjectionToken<TuiLineClampOptions>(\n    `Default parameters for line-clamp component`,\n    {\n        factory: () => TUI_LINE_CLAMP_DEFAULT_OPTIONS,\n    },\n);\n\nexport const tuiLineClampOptionsProvider: (\n    options: Partial<TuiLineClampOptions>,\n) => ValueProvider = (options: Partial<TuiLineClampOptions>) => ({\n    provide: TUI_LINE_CLAMP_OPTIONS,\n    useValue: {...TUI_LINE_CLAMP_DEFAULT_OPTIONS, ...options},\n});\n","import {\n    AfterViewInit,\n    ChangeDetectionStrategy,\n    ChangeDetectorRef,\n    Component,\n    DoCheck,\n    ElementRef,\n    HostListener,\n    Inject,\n    Input,\n    NgZone,\n    Output,\n    Renderer2,\n    ViewChild,\n} from '@angular/core';\nimport {\n    isCurrentTarget,\n    tuiDefaultProp,\n    tuiPure,\n    tuiPx,\n    typedFromEvent,\n} from '@taiga-ui/cdk';\nimport {PolymorpheusContent, PolymorpheusOutletComponent} from '@tinkoff/ng-polymorpheus';\nimport {BehaviorSubject, Observable, of, Subject} from 'rxjs';\nimport {\n    distinctUntilChanged,\n    filter,\n    mapTo,\n    pairwise,\n    startWith,\n    switchMap,\n} from 'rxjs/operators';\n\nimport {TUI_LINE_CLAMP_OPTIONS, TuiLineClampOptions} from './line-clamp-options';\n\n@Component({\n    selector: 'tui-line-clamp',\n    templateUrl: './line-clamp.template.html',\n    styleUrls: ['./line-clamp.style.less'],\n    changeDetection: ChangeDetectionStrategy.OnPush,\n})\nexport class TuiLineClampComponent implements AfterViewInit, DoCheck {\n    @ViewChild(PolymorpheusOutletComponent, {read: ElementRef})\n    private readonly outlet?: ElementRef<HTMLElement>;\n\n    private readonly linesLimit$ = new BehaviorSubject(1);\n    private readonly isOverflown$ = new Subject<boolean>();\n    private initialized = false;\n\n    @Input()\n    @tuiDefaultProp()\n    set linesLimit(linesLimit: number) {\n        this.linesLimit$.next(linesLimit);\n    }\n\n    @Input()\n    @tuiDefaultProp()\n    lineHeight = 24;\n\n    @Input()\n    @tuiDefaultProp()\n    content: PolymorpheusContent = '';\n\n    @Output()\n    readonly overflownChange: Observable<boolean> = this.isOverflown$.pipe(\n        distinctUntilChanged(),\n    );\n\n    constructor(\n        @Inject(ElementRef) private readonly elementRef: ElementRef<HTMLElement>,\n        @Inject(Renderer2) private readonly renderer: Renderer2,\n        @Inject(ChangeDetectorRef) private readonly cd: ChangeDetectorRef,\n        @Inject(NgZone) private readonly ngZone: NgZone,\n        @Inject(TUI_LINE_CLAMP_OPTIONS) private readonly options: TuiLineClampOptions,\n    ) {\n        this.skipInitialTransition();\n    }\n\n    @tuiPure\n    get lineClamp$(): Observable<number> {\n        return this.linesLimit$.pipe(\n            startWith(1),\n            pairwise(),\n            switchMap(([prev, next]) =>\n                next >= prev\n                    ? of(next)\n                    : typedFromEvent(this.elementRef.nativeElement, 'transitionend').pipe(\n                          filter(isCurrentTarget),\n                          mapTo(next),\n                      ),\n            ),\n        );\n    }\n\n    get overflown(): boolean {\n        if (!this.outlet) {\n            return false;\n        }\n\n        const {scrollHeight, scrollWidth} = this.outlet.nativeElement;\n        const {clientHeight, clientWidth} = this.elementRef.nativeElement;\n\n        // 4px buffer for IE/Edge incorrectly rounding scrollHeight\n        return scrollHeight - clientHeight > 4 || scrollWidth - clientWidth > 0;\n    }\n\n    get computedContent(): PolymorpheusContent {\n        return this.options.showHint && this.overflown ? this.content : '';\n    }\n\n    @HostListener('transitionend')\n    updateView(): void {\n        this.cd.detectChanges();\n    }\n\n    ngAfterViewInit(): void {\n        this.initialized = true;\n    }\n\n    ngDoCheck(): void {\n        this.update();\n        this.isOverflown$.next(this.overflown);\n    }\n\n    private skipInitialTransition(): void {\n        this.ngZone.runOutsideAngular(() => {\n            setTimeout(() => {\n                this.renderer.addClass(this.elementRef.nativeElement, '_initialized');\n                this.cd.detectChanges();\n            });\n        });\n    }\n\n    private update(): void {\n        if (this.outlet) {\n            this.renderer.setStyle(\n                this.elementRef.nativeElement,\n                'height',\n                tuiPx(this.outlet.nativeElement.scrollHeight + 4),\n            );\n        }\n\n        if (this.initialized) {\n            this.renderer.setStyle(\n                this.elementRef.nativeElement,\n                'max-height',\n                tuiPx(this.lineHeight * this.linesLimit$.value),\n            );\n        }\n    }\n}\n","import {CommonModule} from '@angular/common';\nimport {NgModule} from '@angular/core';\nimport {TuiLetModule, TuiResizeModule} from '@taiga-ui/cdk';\nimport {TuiHintModule} from '@taiga-ui/core';\nimport {PolymorpheusModule} from '@tinkoff/ng-polymorpheus';\n\nimport {TuiLineClampComponent} from './line-clamp.component';\n\n@NgModule({\n    imports: [\n        CommonModule,\n        PolymorpheusModule,\n        TuiHintModule,\n        TuiResizeModule,\n        TuiLetModule,\n    ],\n    declarations: [TuiLineClampComponent],\n    exports: [TuiLineClampComponent],\n})\nexport class TuiLineClampModule {}\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './index';\n"],"names":[],"mappings":"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"}