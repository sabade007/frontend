{"version":3,"file":"taiga-ui-kit-directives-dropdown-context.js","sources":["ng://@taiga-ui/kit/directives/dropdown-context/dropdown-context.directive.ts","ng://@taiga-ui/kit/directives/dropdown-context/dropdown-context.module.ts","ng://@taiga-ui/kit/directives/dropdown-context/taiga-ui-kit-directives-dropdown-context.ts"],"sourcesContent":["import {DOCUMENT} from '@angular/common';\nimport {\n    ComponentFactoryResolver,\n    Directive,\n    ElementRef,\n    forwardRef,\n    HostListener,\n    Inject,\n    Injector,\n    Input,\n} from '@angular/core';\nimport {\n    EMPTY_CLIENT_RECT,\n    getClosestFocusable,\n    getNativeFocused,\n    setNativeFocused,\n    TuiActiveZoneDirective,\n    tuiDefaultProp,\n    TuiDestroyService,\n    tuiPointToClientRect,\n    TuiPortalService,\n} from '@taiga-ui/cdk';\nimport {AbstractTuiDropdown, TUI_DROPDOWN_DIRECTIVE, TuiDropdown} from '@taiga-ui/core';\nimport {PolymorpheusContent} from '@tinkoff/ng-polymorpheus';\nimport {EMPTY, Observable} from 'rxjs';\nimport {filter, takeUntil} from 'rxjs/operators';\n\n// @dynamic\n@Directive({\n    selector: '[tuiDropdownContext]',\n    providers: [\n        TuiDestroyService,\n        TuiActiveZoneDirective,\n        {\n            provide: TUI_DROPDOWN_DIRECTIVE,\n            useExisting: forwardRef(() => TuiDropdownContextDirective),\n        },\n    ],\n})\nexport class TuiDropdownContextDirective\n    extends AbstractTuiDropdown\n    implements TuiDropdown\n{\n    private lastClickedClientRect = EMPTY_CLIENT_RECT;\n\n    @Input('tuiDropdownContext')\n    @tuiDefaultProp()\n    content: PolymorpheusContent = '';\n\n    readonly refresh$ = EMPTY;\n\n    readonly context = {close: () => this.closeDropdownBox()};\n\n    constructor(\n        protected readonly elementRef: ElementRef,\n        @Inject(DOCUMENT) private readonly documentRef: Document,\n        @Inject(TuiDestroyService) destroy$: Observable<unknown>,\n        @Inject(ComponentFactoryResolver)\n        componentFactoryResolver: ComponentFactoryResolver,\n        @Inject(Injector) injector: Injector,\n        @Inject(TuiPortalService) portalService: TuiPortalService,\n        readonly activeZone: TuiActiveZoneDirective,\n    ) {\n        super(componentFactoryResolver, injector, portalService, elementRef, activeZone);\n\n        activeZone.tuiActiveZoneChange\n            .pipe(\n                filter(isActive => !isActive),\n                takeUntil(destroy$),\n            )\n            .subscribe(() => this.closeDropdownBox());\n    }\n\n    get clientRect(): ClientRect {\n        return this.lastClickedClientRect;\n    }\n\n    get fixed(): boolean {\n        return true;\n    }\n\n    private get dropdownContent(): HTMLElement | null {\n        return this.dropdownBoxRef?.instance.contentElementRef?.nativeElement || null;\n    }\n\n    @HostListener('click')\n    onHostClick(): void {\n        this.closeDropdownBox();\n    }\n\n    @HostListener('contextmenu.prevent', ['$event.clientX', '$event.clientY'])\n    onContextMenu(x: number, y: number): void {\n        this.closeDropdownBox();\n        this.openDropdown(x, y);\n    }\n\n    @HostListener('document:contextmenu', ['$event.target'])\n    onAnotherContextOpen(target: HTMLElement): void {\n        const isAnotherContextOpened = !this.elementRef.nativeElement.contains(target);\n\n        if (isAnotherContextOpened) {\n            this.closeDropdownBox();\n        }\n    }\n\n    @HostListener('document:keydown.arrowDown', ['$event', 'true'])\n    @HostListener('document:keydown.arrowUp', ['$event', 'false'])\n    onArrow(event: KeyboardEvent, down: boolean): void {\n        const activeElement = getNativeFocused(this.documentRef);\n        const focusInside = activeElement && this.activeZone.contains(activeElement);\n\n        if (!this.dropdownContent || focusInside) {\n            return;\n        }\n\n        event.preventDefault();\n\n        const nextEl = this.dropdownContent.nextElementSibling;\n        const initial =\n            down || !this.checkIsFocusableElement(nextEl) ? this.dropdownContent : nextEl;\n        const focusable = getClosestFocusable(initial, !down, this.dropdownContent);\n\n        if (focusable === null) {\n            return;\n        }\n\n        setNativeFocused(focusable);\n    }\n\n    @HostListener('document:keydown.esc', ['$event'])\n    onKeyDownEsc(event: KeyboardEvent): void {\n        if (!this.dropdownContent) {\n            return;\n        }\n\n        event.stopPropagation();\n        this.closeDropdownBox();\n    }\n\n    private openDropdown(x: number, y: number): void {\n        this.lastClickedClientRect = tuiPointToClientRect(x, y);\n        this.openDropdownBox();\n    }\n\n    private checkIsFocusableElement(element: Element | null): element is HTMLElement {\n        return !!element && 'focus' in element && 'blur' in element;\n    }\n}\n","import {NgModule} from '@angular/core';\nimport {TuiDropdownBoxModule} from '@taiga-ui/core';\n\nimport {TuiDropdownContextDirective} from './dropdown-context.directive';\n\n@NgModule({\n    imports: [TuiDropdownBoxModule],\n    declarations: [TuiDropdownContextDirective],\n    exports: [TuiDropdownContextDirective],\n})\nexport class TuiDropdownContextModule {}\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './index';\n"],"names":[],"mappings":"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"}