{"version":3,"file":"taiga-ui-kit-directives-highlight.js","sources":["ng://@taiga-ui/kit/directives/highlight/highlight.directive.ts","ng://@taiga-ui/kit/directives/highlight/highlight.module.ts","ng://@taiga-ui/kit/directives/highlight/taiga-ui-kit-directives-highlight.ts"],"sourcesContent":["import {DOCUMENT} from '@angular/common';\nimport {Directive, ElementRef, Inject, Input, OnChanges, Renderer2} from '@angular/core';\nimport {\n    px,\n    svgNodeFilter,\n    tuiDefaultProp,\n    TuiDestroyService,\n    TuiResizeService,\n} from '@taiga-ui/cdk';\nimport {Observable} from 'rxjs';\n\n// @dynamic\n@Directive({\n    selector: '[tuiHighlight]',\n    host: {\n        '[style.position]': '\"relative\"',\n        '[style.zIndex]': '0',\n    },\n    providers: [TuiDestroyService, TuiResizeService],\n})\nexport class TuiHighlightDirective implements OnChanges {\n    private readonly highlight: HTMLElement = this.setUpHighlight();\n\n    private readonly treeWalker = this.documentRef.createTreeWalker(\n        this.elementRef.nativeElement,\n        NodeFilter.SHOW_TEXT,\n        svgNodeFilter,\n        false,\n    );\n\n    @Input()\n    @tuiDefaultProp()\n    tuiHighlight = '';\n\n    @Input()\n    tuiHighlightColor = 'var(--tui-selection)';\n\n    constructor(\n        @Inject(DOCUMENT) private readonly documentRef: Document,\n        @Inject(ElementRef) private readonly elementRef: ElementRef<HTMLElement>,\n        @Inject(Renderer2) private readonly renderer: Renderer2,\n        @Inject(TuiResizeService) resize$: Observable<unknown>,\n    ) {\n        resize$.subscribe(() => {\n            this.updateStyles();\n        });\n    }\n\n    get match(): boolean {\n        return this.indexOf(this.elementRef.nativeElement.textContent) !== -1;\n    }\n\n    ngOnChanges(): void {\n        this.updateStyles();\n    }\n\n    private updateStyles(): void {\n        this.highlight.style.display = 'none';\n\n        if (!this.match) {\n            return;\n        }\n\n        this.treeWalker.currentNode = this.elementRef.nativeElement;\n\n        do {\n            const index = this.indexOf(this.treeWalker.currentNode.nodeValue);\n\n            if (index === -1) {\n                continue;\n            }\n\n            const range = this.documentRef.createRange();\n\n            range.setStart(this.treeWalker.currentNode, index);\n            range.setEnd(this.treeWalker.currentNode, index + this.tuiHighlight.length);\n\n            const hostRect = this.elementRef.nativeElement.getBoundingClientRect();\n            const {left, top, width, height} = range.getBoundingClientRect();\n            const {style} = this.highlight;\n\n            style.background = this.tuiHighlightColor;\n            style.left = px(left - hostRect.left);\n            style.top = px(top - hostRect.top);\n            style.width = px(width);\n            style.height = px(height);\n            style.display = 'block';\n\n            return;\n        } while (this.treeWalker.nextNode());\n    }\n\n    private indexOf(source: string | null): number {\n        return !source || !this.tuiHighlight\n            ? -1\n            : source.toLowerCase().indexOf(this.tuiHighlight.toLowerCase());\n    }\n\n    private setUpHighlight(): HTMLElement {\n        const highlight = this.renderer.createElement('div');\n        const {style} = highlight;\n\n        style.background = this.tuiHighlightColor;\n        style.zIndex = '-1';\n        style.position = 'absolute';\n        this.renderer.appendChild(this.elementRef.nativeElement, highlight);\n\n        return highlight;\n    }\n}\n","import {NgModule} from '@angular/core';\n\nimport {TuiHighlightDirective} from './highlight.directive';\n\n@NgModule({\n    declarations: [TuiHighlightDirective],\n    exports: [TuiHighlightDirective],\n})\nexport class TuiHighlightModule {}\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './index';\n"],"names":[],"mappings":"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"}