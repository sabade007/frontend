{"version":3,"file":"taiga-ui-core-components-hosted-dropdown.js","sources":["ng://@taiga-ui/core/components/hosted-dropdown/hosted-dropdown-connector.directive.ts","ng://@taiga-ui/core/components/hosted-dropdown/hosted-dropdown.component.ts","ng://@taiga-ui/core/components/hosted-dropdown/hosted-dropdown.module.ts","ng://@taiga-ui/core/components/hosted-dropdown/taiga-ui-core-components-hosted-dropdown.ts"],"sourcesContent":["import {Directive} from '@angular/core';\n\n@Directive({\n    selector: '[tuiHostedDropdownHost]',\n})\nexport class TuiHostedDropdownConnectorDirective {}\n","import {\n    ChangeDetectionStrategy,\n    Component,\n    ContentChild,\n    ElementRef,\n    EventEmitter,\n    forwardRef,\n    HostBinding,\n    HostListener,\n    Inject,\n    Input,\n    Output,\n    ViewChild,\n} from '@angular/core';\nimport {\n    getClosestFocusable,\n    isElementEditable,\n    isNativeFocusedIn,\n    isNativeKeyboardFocusable,\n    setNativeFocused,\n    TUI_FOCUSABLE_ITEM_ACCESSOR,\n    TuiActiveZoneDirective,\n    TuiContextWithImplicit,\n    tuiDefaultProp,\n    TuiFocusableElementAccessor,\n    TuiNativeFocusableElement,\n} from '@taiga-ui/cdk';\nimport {TuiDropdownDirective} from '@taiga-ui/core/directives/dropdown';\nimport {\n    DROPDOWN_CONTROLLER_PROVIDER,\n    TUI_DROPDOWN_WATCHED_CONTROLLER,\n    TuiDropdownControllerDirective,\n} from '@taiga-ui/core/directives/dropdown-controller';\nimport {isEditingKey} from '@taiga-ui/core/utils/miscellaneous';\nimport {PolymorpheusContent} from '@tinkoff/ng-polymorpheus';\n\nimport {TuiHostedDropdownConnectorDirective} from './hosted-dropdown-connector.directive';\n\n@Component({\n    selector: 'tui-hosted-dropdown',\n    templateUrl: './hosted-dropdown.template.html',\n    styleUrls: ['./hosted-dropdown.style.less'],\n    changeDetection: ChangeDetectionStrategy.OnPush,\n    providers: [\n        {\n            provide: TUI_FOCUSABLE_ITEM_ACCESSOR,\n            useExisting: forwardRef(() => TuiHostedDropdownComponent),\n        },\n        DROPDOWN_CONTROLLER_PROVIDER,\n    ],\n})\nexport class TuiHostedDropdownComponent implements TuiFocusableElementAccessor {\n    @ContentChild(TuiHostedDropdownConnectorDirective, {read: ElementRef})\n    private readonly dropdownHost?: ElementRef<HTMLElement>;\n\n    @ViewChild('wrapper', {read: ElementRef})\n    private readonly wrapper?: ElementRef<HTMLDivElement>;\n\n    @ViewChild(TuiDropdownDirective)\n    private readonly dropdownDirective?: TuiDropdownDirective;\n\n    @Input()\n    @tuiDefaultProp()\n    content: PolymorpheusContent<TuiContextWithImplicit<TuiActiveZoneDirective>> = '';\n\n    @Input()\n    @tuiDefaultProp()\n    canOpen = true;\n\n    @Input()\n    @tuiDefaultProp()\n    open = false;\n\n    @Output()\n    readonly openChange = new EventEmitter<boolean>();\n\n    @Output()\n    readonly focusedChange = new EventEmitter<boolean>();\n\n    constructor(\n        @Inject(ElementRef) private readonly elementRef: ElementRef,\n        @Inject(TUI_DROPDOWN_WATCHED_CONTROLLER)\n        readonly controller: TuiDropdownControllerDirective,\n    ) {}\n\n    get host(): HTMLElement {\n        return this.dropdownHost\n            ? this.dropdownHost.nativeElement\n            : this.elementRef.nativeElement;\n    }\n\n    get dropdown(): HTMLElement | null {\n        return !this.dropdownDirective || this.dropdownDirective.dropdownBoxRef === null\n            ? null\n            : this.dropdownDirective.dropdownBoxRef.location.nativeElement;\n    }\n\n    get nativeFocusableElement(): TuiNativeFocusableElement | null {\n        return isNativeKeyboardFocusable(this.host)\n            ? this.host\n            : getClosestFocusable(this.host, false, this.elementRef.nativeElement);\n    }\n\n    @HostBinding('class._hosted_dropdown_focused')\n    get focused(): boolean {\n        return (\n            isNativeFocusedIn(this.host) ||\n            (this.open && !!this.wrapper && isNativeFocusedIn(this.wrapper.nativeElement))\n        );\n    }\n\n    @HostListener('focusin', ['$event.target'])\n    onFocusIn(target: HTMLElement): void {\n        const host = this.dropdownHost\n            ? this.dropdownHost.nativeElement\n            : this.nativeFocusableElement || this.elementRef.nativeElement;\n\n        if (!host.contains(target)) {\n            this.updateOpen(false);\n        }\n    }\n\n    @HostListener('click', ['$event.target'])\n    onClick(target: HTMLElement): void {\n        const host = this.nativeFocusableElement || this.host;\n        const dropdownHost = this.dropdownHost ? this.dropdownHost.nativeElement : host;\n\n        if (!this.hostEditable && dropdownHost.contains(target)) {\n            this.updateOpen(!this.open);\n        }\n    }\n\n    @HostListener('keydown.esc', ['$event'])\n    onKeyDownEsc(event: Event): void {\n        if (!this.canOpen || !this.open) {\n            return;\n        }\n\n        event.stopPropagation();\n        this.closeDropdown();\n    }\n\n    @HostListener('keydown.arrowDown', ['$event', 'true'])\n    @HostListener('keydown.arrowUp', ['$event', 'false'])\n    onArrow(event: KeyboardEvent, down: boolean): void {\n        this.focusDropdown(event, down);\n    }\n\n    onKeydown({key, target, defaultPrevented}: KeyboardEvent): void {\n        if (\n            !defaultPrevented &&\n            isEditingKey(key) &&\n            this.hostEditable &&\n            // TODO: iframe warning\n            target instanceof HTMLElement &&\n            !isElementEditable(target)\n        ) {\n            this.focusHost();\n        }\n    }\n\n    onActiveZone(active: boolean): void {\n        this.updateFocused(active);\n\n        if (!active) {\n            this.updateOpen(false);\n        }\n    }\n\n    onHostObscured(obscured: boolean): void {\n        if (obscured) {\n            this.closeDropdown();\n        }\n    }\n\n    updateOpen(open: boolean): void {\n        if (open && !this.canOpen) {\n            return;\n        }\n\n        this.open = open;\n        this.openChange.emit(open);\n    }\n\n    private get hostEditable(): boolean {\n        const host = this.nativeFocusableElement || this.host;\n\n        // TODO: iframe warning\n        return host instanceof HTMLElement && isElementEditable(host);\n    }\n\n    private focusDropdown(event: KeyboardEvent, first: boolean): void {\n        const host = this.nativeFocusableElement;\n\n        // TODO: iframe warning\n        if (\n            !host ||\n            !(host instanceof HTMLElement) ||\n            !(event.target instanceof Node) ||\n            !host.contains(event.target)\n        ) {\n            return;\n        }\n\n        if (\n            !this.wrapper ||\n            !this.open ||\n            this.dropdown === null ||\n            // TODO: iframe warning\n            !(this.wrapper.nativeElement.nextElementSibling instanceof HTMLElement)\n        ) {\n            this.updateOpen(true);\n\n            if (!isElementEditable(host)) {\n                event.preventDefault();\n            }\n\n            return;\n        }\n\n        const initial = first\n            ? this.wrapper.nativeElement\n            : this.wrapper.nativeElement.nextElementSibling;\n        const focusable = getClosestFocusable(\n            initial,\n            !first,\n            this.wrapper.nativeElement,\n        );\n\n        if (focusable === null) {\n            return;\n        }\n\n        setNativeFocused(focusable);\n        event.preventDefault();\n    }\n\n    private closeDropdown(): void {\n        if (this.focused) {\n            this.focusHost();\n        }\n\n        this.updateOpen(false);\n    }\n\n    private focusHost(): void {\n        const host = this.nativeFocusableElement;\n\n        if (host !== null) {\n            setNativeFocused(host, true, true);\n        }\n    }\n\n    private updateFocused(focused: boolean): void {\n        this.focusedChange.emit(focused);\n    }\n}\n","import {CommonModule} from '@angular/common';\nimport {NgModule} from '@angular/core';\nimport {TuiActiveZoneModule, TuiObscuredModule} from '@taiga-ui/cdk';\nimport {TuiDropdownModule} from '@taiga-ui/core/directives/dropdown';\nimport {PolymorpheusModule} from '@tinkoff/ng-polymorpheus';\n\nimport {TuiHostedDropdownComponent} from './hosted-dropdown.component';\nimport {TuiHostedDropdownConnectorDirective} from './hosted-dropdown-connector.directive';\n\n@NgModule({\n    imports: [\n        CommonModule,\n        TuiObscuredModule,\n        PolymorpheusModule,\n        TuiActiveZoneModule,\n        TuiDropdownModule,\n    ],\n    declarations: [TuiHostedDropdownComponent, TuiHostedDropdownConnectorDirective],\n    exports: [TuiHostedDropdownComponent, TuiHostedDropdownConnectorDirective],\n})\nexport class TuiHostedDropdownModule {}\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './index';\n"],"names":[],"mappings":"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"}