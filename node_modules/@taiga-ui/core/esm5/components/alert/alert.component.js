import { __assign, __decorate, __param } from "tslib";
import { ChangeDetectionStrategy, Component, ElementRef, HostBinding, Inject, OnInit, } from '@angular/core';
import { isNumber, TuiContextWithImplicit, TuiDestroyService, TuiDialog, tuiPure, } from '@taiga-ui/cdk';
import { tuiFadeIn, tuiHeightCollapse, tuiSlideInRight } from '@taiga-ui/core/animations';
import { TUI_ANIMATION_OPTIONS, TUI_NOTIFICATION_OPTIONS, } from '@taiga-ui/core/tokens';
import { POLYMORPHEUS_CONTEXT } from '@tinkoff/ng-polymorpheus';
import { fromEvent, timer } from 'rxjs';
import { repeatWhen, takeUntil } from 'rxjs/operators';
// TODO: 3.0 Refactor according to new context by 3.0 and get rid of $any in template
var TuiAlertComponent = /** @class */ (function () {
    function TuiAlertComponent(elementRef, destroy$, options, animationOptions, item) {
        this.elementRef = elementRef;
        this.destroy$ = destroy$;
        this.options = options;
        this.animationOptions = animationOptions;
        this.item = item;
        this.autoClose = typeof this.item.autoClose === 'function'
            ? this.item.autoClose(this.item.status)
            : this.item.autoClose;
        this.animation = __assign({ value: '' }, this.animationOptions);
    }
    TuiAlertComponent.prototype.ngOnInit = function () {
        this.initAutoClose();
    };
    Object.defineProperty(TuiAlertComponent.prototype, "context", {
        get: function () {
            return this.calculateContext(this.item);
        },
        enumerable: true,
        configurable: true
    });
    TuiAlertComponent.prototype.closeNotification = function () {
        this.item.$implicit.complete();
    };
    TuiAlertComponent.prototype.calculateContext = function (_a) {
        var $implicit = _a.$implicit, status = _a.status, data = _a.data, label = _a.label;
        return {
            $implicit: status,
            data: data,
            label: label,
            closeHook: function () {
                $implicit.complete();
            },
            emitHook: function (data) {
                $implicit.next(data);
            },
            emitAndCloseHook: function (data) {
                $implicit.next(data);
                $implicit.complete();
            },
        };
    };
    TuiAlertComponent.prototype.initAutoClose = function () {
        var _this = this;
        if (!this.autoClose) {
            return;
        }
        timer(isNumber(this.autoClose) ? this.autoClose : this.options.defaultAutoCloseTime)
            .pipe(takeUntil(fromEvent(this.elementRef.nativeElement, 'mouseenter')), 
        // eslint-disable-next-line rxjs/no-ignored-notifier
        repeatWhen(function () { return fromEvent(_this.elementRef.nativeElement, 'mouseleave'); }), takeUntil(this.destroy$))
            .subscribe(function () { return _this.closeNotification(); });
    };
    TuiAlertComponent.ctorParameters = function () { return [
        { type: ElementRef, decorators: [{ type: Inject, args: [ElementRef,] }] },
        { type: TuiDestroyService, decorators: [{ type: Inject, args: [TuiDestroyService,] }] },
        { type: undefined, decorators: [{ type: Inject, args: [TUI_NOTIFICATION_OPTIONS,] }] },
        { type: undefined, decorators: [{ type: Inject, args: [TUI_ANIMATION_OPTIONS,] }] },
        { type: undefined, decorators: [{ type: Inject, args: [POLYMORPHEUS_CONTEXT,] }] }
    ]; };
    __decorate([
        HostBinding('@tuiFadeIn'),
        HostBinding('@tuiSlideInRight'),
        HostBinding('@tuiHeightCollapse')
    ], TuiAlertComponent.prototype, "animation", void 0);
    __decorate([
        tuiPure
    ], TuiAlertComponent.prototype, "calculateContext", null);
    TuiAlertComponent = __decorate([
        Component({
            selector: 'tui-alert',
            template: "<tui-notification\n    *ngIf=\"item.hasCloseButton; else noClose\"\n    [status]=\"item.status\"\n    [hasIcon]=\"item.hasIcon\"\n    (close)=\"closeNotification()\"\n>\n    <label\n        *ngIf=\"item.label\"\n        polymorpheus-outlet\n        automation-id=\"tui-notification-alert__heading\"\n        class=\"t-heading\"\n        [content]=\"$any(item.label)\"\n        [context]=\"context\"\n    ></label>\n    <div\n        polymorpheus-outlet\n        automation-id=\"tui-notification-alert__content\"\n        class=\"t-content\"\n        [content]=\"item.content\"\n        [context]=\"$any(context)\"\n    ></div>\n</tui-notification>\n<ng-template #noClose>\n    <tui-notification\n        [status]=\"item.status\"\n        [hasIcon]=\"item.hasIcon\"\n    >\n        <label\n            *ngIf=\"item.label\"\n            polymorpheus-outlet\n            automation-id=\"tui-notification-alert__heading\"\n            class=\"t-heading\"\n            [content]=\"$any(item.label)\"\n            [context]=\"context\"\n        ></label>\n        <div\n            polymorpheus-outlet\n            automation-id=\"tui-notification-alert__content\"\n            class=\"t-content\"\n            [content]=\"item.content\"\n            [context]=\"$any(context)\"\n        ></div>\n    </tui-notification>\n</ng-template>\n",
            changeDetection: ChangeDetectionStrategy.OnPush,
            providers: [TuiDestroyService],
            animations: [tuiFadeIn, tuiSlideInRight, tuiHeightCollapse],
            host: { role: 'alert' },
            styles: [":host{box-shadow:0 .5rem 1rem rgba(0,0,0,.16);display:block;border-radius:var(--tui-radius-m);width:18rem;margin:2rem 3rem 0 auto}:host-context(tui-root._mobile) :host{margin:1rem 1rem 0 auto}:host:not(:first-child){margin-top:.75rem}.t-heading{font:var(--tui-font-text-m);line-height:1.25rem;font-weight:700;margin:0}.t-content{color:var(--tui-text-01);word-wrap:break-word}.t-content:empty{display:none}"]
        }),
        __param(0, Inject(ElementRef)),
        __param(1, Inject(TuiDestroyService)),
        __param(2, Inject(TUI_NOTIFICATION_OPTIONS)),
        __param(3, Inject(TUI_ANIMATION_OPTIONS)),
        __param(4, Inject(POLYMORPHEUS_CONTEXT))
    ], TuiAlertComponent);
    return TuiAlertComponent;
}());
export { TuiAlertComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYWxlcnQuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQHRhaWdhLXVpL2NvcmUvY29tcG9uZW50cy9hbGVydC8iLCJzb3VyY2VzIjpbImFsZXJ0LmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQ0EsT0FBTyxFQUNILHVCQUF1QixFQUN2QixTQUFTLEVBQ1QsVUFBVSxFQUNWLFdBQVcsRUFDWCxNQUFNLEVBQ04sTUFBTSxHQUNULE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFDSCxRQUFRLEVBQ1Isc0JBQXNCLEVBQ3RCLGlCQUFpQixFQUNqQixTQUFTLEVBQ1QsT0FBTyxHQUNWLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBQyxTQUFTLEVBQUUsaUJBQWlCLEVBQUUsZUFBZSxFQUFDLE1BQU0sMkJBQTJCLENBQUM7QUFHeEYsT0FBTyxFQUNILHFCQUFxQixFQUNyQix3QkFBd0IsR0FFM0IsTUFBTSx1QkFBdUIsQ0FBQztBQUMvQixPQUFPLEVBQUMsb0JBQW9CLEVBQXNCLE1BQU0sMEJBQTBCLENBQUM7QUFDbkYsT0FBTyxFQUFDLFNBQVMsRUFBRSxLQUFLLEVBQUMsTUFBTSxNQUFNLENBQUM7QUFDdEMsT0FBTyxFQUFDLFVBQVUsRUFBRSxTQUFTLEVBQUMsTUFBTSxnQkFBZ0IsQ0FBQztBQVlyRCxxRkFBcUY7QUFVckY7SUFXSSwyQkFDeUMsVUFBbUMsRUFDNUIsUUFBMkIsRUFFdEQsT0FBc0MsRUFFdEMsZ0JBQWtDLEVBQ1osSUFBc0M7UUFOeEMsZUFBVSxHQUFWLFVBQVUsQ0FBeUI7UUFDNUIsYUFBUSxHQUFSLFFBQVEsQ0FBbUI7UUFFdEQsWUFBTyxHQUFQLE9BQU8sQ0FBK0I7UUFFdEMscUJBQWdCLEdBQWhCLGdCQUFnQixDQUFrQjtRQUNaLFNBQUksR0FBSixJQUFJLENBQWtDO1FBakJoRSxjQUFTLEdBQ3RCLE9BQU8sSUFBSSxDQUFDLElBQUksQ0FBQyxTQUFTLEtBQUssVUFBVTtZQUNyQyxDQUFDLENB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QUFJLEVBQUUsT0FBTyxFQUFDOztTQUN4QixDQUFDO1FBYU8sV0FBQSxNQUFNLENBQUMsVUFBVSxDQUFDLENBQUE7UUFDbEIsV0FBQSxNQUFNLENBQUMsaUJBQWlCLENBQUMsQ0FBQTtRQUN6QixXQUFBLE1BQU0sQ0FBQyx3QkFBd0IsQ0FBQyxDQUFBO1FBRWhDLFdBQUEsTUFBTSxDQUFDLHFCQUFxQixDQUFDLENBQUE7UUFFN0IsV0FBQSxNQUFNLENBQUMsb0JBQW9CLENBQUMsQ0FBQTtPQWxCeEIsaUJBQWlCLENBeUU3QjtJQUFELHdCQUFDO0NBQUEsQUF6RUQsSUF5RUM7U0F6RVksaUJBQWlCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtBbmltYXRpb25PcHRpb25zfSBmcm9tICdAYW5ndWxhci9hbmltYXRpb25zJztcbmltcG9ydCB7XG4gICAgQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3ksXG4gICAgQ29tcG9uZW50LFxuICAgIEVsZW1lbnRSZWYsXG4gICAgSG9zdEJpbmRpbmcsXG4gICAgSW5qZWN0LFxuICAgIE9uSW5pdCxcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQge1xuICAgIGlzTnVtYmVyLFxuICAgIFR1aUNvbnRleHRXaXRoSW1wbGljaXQsXG4gICAgVHVpRGVzdHJveVNlcnZpY2UsXG4gICAgVHVpRGlhbG9nLFxuICAgIHR1aVB1cmUsXG59IGZyb20gJ0B0YWlnYS11aS9jZGsnO1xuaW1wb3J0IHt0dWlGYWRlSW4sIHR1aUhlaWdodENvbGxhcHNlLCB0dWlTbGlkZUluUmlnaHR9IGZyb20gJ0B0YWlnYS11aS9jb3JlL2FuaW1hdGlvbnMnO1xuaW1wb3J0IHtUdWlOb3RpZmljYXRpb259IGZyb20gJ0B0YWlnYS11aS9jb3JlL2VudW1zJztcbmltcG9ydCB7VHVpQWxlcnRPcHRpb25zfSBmcm9tICdAdGFpZ2EtdWkvY29yZS9pbnRlcmZhY2VzJztcbmltcG9ydCB7XG4gICAgVFVJX0FOSU1BVElPTl9PUFRJT05TLFxuICAgIFRVSV9OT1RJRklDQVRJT05fT1BUSU9OUyxcbiAgICBUdWlOb3RpZmljYXRpb25EZWZhdWx0T3B0aW9ucyxcbn0gZnJvbSAnQHRhaWdhLXVpL2NvcmUvdG9rZW5zJztcbmltcG9ydCB7UE9MWU1PUlBIRVVTX0NPTlRFWFQsIFBvbHltb3JwaGV1c0NvbnRlbnR9IGZyb20gJ0B0aW5rb2ZmL25nLXBvbHltb3JwaGV1cyc7XG5pbXBvcnQge2Zyb21FdmVudCwgdGltZXJ9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHtyZXBlYXRXaGVuLCB0YWtlVW50aWx9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcblxuLy8gVE9ETzogMy4wIFJlbW92ZSBhbmQgc3RhcnQgdXNpbmcgVHVpRGlhbG9nPFR1aUFsZXJ0T3B0aW9uczxJPiwgTz5cbmV4cG9ydCBpbnRlcmZhY2UgVHVpTm90aWZpY2F0aW9uQ29udGVudENvbnRleHQ8TyA9IHZvaWQsIEkgPSB1bmRlZmluZWQ+XG4gICAgZXh0ZW5kcyBUdWlDb250ZXh0V2l0aEltcGxpY2l0PFR1aU5vdGlmaWNhdGlvbj4ge1xuICAgIGxhYmVsOiBQb2x5bW9ycGhldXNDb250ZW50PFR1aUNvbnRleHRXaXRoSW1wbGljaXQ8VHVpTm90aWZpY2F0aW9uPj47XG4gICAgZGF0YTogSTtcbiAgICBjbG9zZUhvb2s6ICgpID0+IHZvaWQ7XG4gICAgZW1pdEhvb2s6IChkYXRhOiBPKSA9PiB2b2lkO1xuICAgIGVtaXRBbmRDbG9zZUhvb2s6IChkYXRhOiBPKSA9PiB2b2lkO1xufVxuXG4vLyBUT0RPOiAzLjAgUmVmYWN0b3IgYWNjb3JkaW5nIHRvIG5ldyBjb250ZXh0IGJ5IDMuMCBhbmQgZ2V0IHJpZCBvZiAkYW55IGluIHRlbXBsYXRlXG5AQ29tcG9uZW50KHtcbiAgICBzZWxlY3RvcjogJ3R1aS1hbGVydCcsXG4gICAgdGVtcGxhdGVVcmw6ICcuL2FsZXJ0LnRlbXBsYXRlLmh0bWwnLFxuICAgIHN0eWxlVXJsczogWycuL2FsZXJ0LnN0eWxlLmxlc3MnXSxcbiAgICBjaGFuZ2VEZXRlY3Rpb246IENoYW5nZURldGVjdGlvblN0cmF0ZWd5Lk9uUHVzaCxcbiAgICBwcm92aWRlcnM6IFtUdWlEZXN0cm95U2VydmljZV0sXG4gICAgYW5pbWF0aW9uczogW3R1aUZhZGVJbiwgdHVpU2xpZGVJblJpZ2h0LCB0dWlIZWlnaHRDb2xsYXBzZV0sXG4gICAgaG9zdDoge3JvbGU6ICdhbGVydCd9LFxufSlcbmV4cG9ydCBjbGFzcyBUdWlBbGVydENvbXBvbmVudDxPLCBJPiBpbXBsZW1lbnRzIE9uSW5pdCB7XG4gICAgcHJpdmF0ZSByZWFkb25seSBhdXRvQ2xvc2UgPVxuICAgICAgICB0eXBlb2YgdGhpcy5pdGVtLmF1dG9DbG9zZSA9PT0gJ2Z1bmN0aW9uJ1xuICAgICAgICAgICAgPyB0aGlzLml0ZW0uYXV0b0Nsb3NlKHRoaXMuaXRlbS5zdGF0dXMpXG4gICAgICAgICAgICA6IHRoaXMuaXRlbS5hdXRvQ2xvc2U7XG5cbiAgICBASG9zdEJpbmRpbmcoJ0B0dWlGYWRlSW4nKVxuICAgIEBIb3N0QmluZGluZygnQHR1aVNsaWRlSW5SaWdodCcpXG4gICAgQEhvc3RCaW5kaW5nKCdAdHVpSGVpZ2h0Q29sbGFwc2UnKVxuICAgIHJlYWRvbmx5IGFuaW1hdGlvbiA9IHt2YWx1ZTogJycsIC4uLnRoaXMuYW5pbWF0aW9uT3B0aW9uc30gYXMgY29uc3Q7XG5cbiAgICBjb25zdHJ1Y3RvcihcbiAgICAgICAgQEluamVjdChFbGVtZW50UmVmKSBwcml2YXRlIHJlYWRvbmx5IGVsZW1lbnRSZWY6IEVsZW1lbnRSZWY8SFRNTEVsZW1lbnQ+LFxuICAgICAgICBASW5qZWN0KFR1aURlc3Ryb3lTZXJ2aWNlKSBwcml2YXRlIHJlYWRvbmx5IGRlc3Ryb3kkOiBUdWlEZXN0cm95U2VydmljZSxcbiAgICAgICAgQEluamVjdChUVUlfTk9USUZJQ0FUSU9OX09QVElPTlMpXG4gICAgICAgIHByaXZhdGUgcmVhZG9ubHkgb3B0aW9uczogVHVpTm90aWZpY2F0aW9uRGVmYXVsdE9wdGlvbnMsXG4gICAgICAgIEBJbmplY3QoVFVJX0FOSU1BVElPTl9PUFRJT05TKVxuICAgICAgICBwcml2YXRlIHJlYWRvbmx5IGFuaW1hdGlvbk9wdGlvbnM6IEFuaW1hdGlvbk9wdGlvbnMsXG4gICAgICAgIEBJbmplY3QoUE9MWU1PUlBIRVVTX0NPTlRFWFQpIHJlYWRvbmx5IGl0ZW06IFR1aURpYWxvZzxUdWlBbGVydE9wdGlvbnM8ST4sIE8+LFxuICAgICkge31cblxuICAgIG5nT25Jbml0KCk6IHZvaWQge1xuICAgICAgICB0aGlzLmluaXRBdXRvQ2xvc2UoKTtcbiAgICB9XG5cbiAgICBnZXQgY29udGV4dCgpOiBUdWlOb3RpZmljYXRpb25Db250ZW50Q29udGV4dDxPLCBJPiB7XG4gICAgICAgIHJldHVybiB0aGlzLmNhbGN1bGF0ZUNvbnRleHQodGhpcy5pdGVtKTtcbiAgICB9XG5cbiAgICBjbG9zZU5vdGlmaWNhdGlvbigpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5pdGVtLiRpbXBsaWNpdC5jb21wbGV0ZSgpO1xuICAgIH1cblxuICAgIEB0dWlQdXJlXG4gICAgcHJpdmF0ZSBjYWxjdWxhdGVDb250ZXh0KHtcbiAgICAgICAgJGltcGxpY2l0LFxuICAgICAgICBzdGF0dXMsXG4gICAgICAgIGRhdGEsXG4gICAgICAgIGxhYmVsLFxuICAgIH06IFR1aURpYWxvZzxUdWlBbGVydE9wdGlvbnM8ST4sIE8+KTogVHVpTm90aWZpY2F0aW9uQ29udGVudENvbnRleHQ8TywgST4ge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgJGltcGxpY2l0OiBzdGF0dXMsXG4gICAgICAgICAgICBkYXRhLFxuICAgICAgICAgICAgbGFiZWwsXG4gICAgICAgICAgICBjbG9zZUhvb2s6ICgpID0+IHtcbiAgICAgICAgICAgICAgICAkaW1wbGljaXQuY29tcGxldGUoKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBlbWl0SG9vazogKGRhdGE6IE8pID0+IHtcbiAgICAgICAgICAgICAgICAkaW1wbGljaXQubmV4dChkYXRhKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBlbWl0QW5kQ2xvc2VIb29rOiAoZGF0YTogTykgPT4ge1xuICAgICAgICAgICAgICAgICRpbXBsaWNpdC5uZXh0KGRhdGEpO1xuICAgICAgICAgICAgICAgICRpbXBsaWNpdC5jb21wbGV0ZSgpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGluaXRBdXRvQ2xvc2UoKTogdm9pZCB7XG4gICAgICAgIGlmICghdGhpcy5hdXRvQ2xvc2UpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIHRpbWVyKFxuICAgICAgICAgICAgaXNOdW1iZXIodGhpcy5hdXRvQ2xvc2UpID8gdGhpcy5hdXRvQ2xvc2UgOiB0aGlzLm9wdGlvbnMuZGVmYXVsdEF1dG9DbG9zZVRpbWUsXG4gICAgICAgIClcbiAgICAgICAgICAgIC5waXBlKFxuICAgICAgICAgICAgICAgIHRha2VVbnRpbChmcm9tRXZlbnQodGhpcy5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQsICdtb3VzZWVudGVyJykpLFxuICAgICAgICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSByeGpzL25vLWlnbm9yZWQtbm90aWZpZXJcbiAgICAgICAgICAgICAgICByZXBlYXRXaGVuKCgpID0+IGZyb21FdmVudCh0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudCwgJ21vdXNlbGVhdmUnKSksXG4gICAgICAgICAgICAgICAgdGFrZVVudGlsKHRoaXMuZGVzdHJveSQpLFxuICAgICAgICAgICAgKVxuICAgICAgICAgICAgLnN1YnNjcmliZSgoKSA9PiB0aGlzLmNsb3NlTm90aWZpY2F0aW9uKCkpO1xuICAgIH1cbn1cbiJdfQ==