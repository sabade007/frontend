import { __decorate, __extends, __param } from "tslib";
import { ChangeDetectionStrategy, ChangeDetectorRef, Component, ElementRef, forwardRef, HostBinding, HostListener, Inject, Input, Optional, } from '@angular/core';
import { AbstractTuiInteractive, isNativeFocused, pressedObservable, TUI_FOCUSABLE_ITEM_ACCESSOR, TUI_TAKE_ONLY_TRUSTED_EVENTS, tuiDefaultProp, TuiDestroyService, TuiFocusableElementAccessor, TuiFocusVisibleService, TuiHoveredService, watch, } from '@taiga-ui/cdk';
import { TuiModeDirective } from '@taiga-ui/core/directives';
import { EMPTY, Observable } from 'rxjs';
import { distinctUntilChanged, map, startWith, takeUntil } from 'rxjs/operators';
import { TUI_BUTTON_OPTIONS } from './button-options';
var TuiButtonComponent = /** @class */ (function (_super) {
    __extends(TuiButtonComponent, _super);
    function TuiButtonComponent(mode, elementRef, focusVisible$, hoveredService, destroy$, changeDetectorRef, takeOnlyTrustedEvents, options) {
        var _a;
        var _this = _super.call(this) || this;
        _this.mode = mode;
        _this.elementRef = elementRef;
        _this.takeOnlyTrustedEvents = takeOnlyTrustedEvents;
        _this.options = options;
        _this.mode$ = ((_a = _this.mode) === null || _a === void 0 ? void 0 : _a.change$) || EMPTY;
        _this.appearance = null;
        _this.disabled = false;
        _this.icon = '';
        _this.iconRight = '';
        _this.shape = _this.options.shape;
        _this.showLoader = false;
        _this.size = _this.options.size;
        _this.appearance$ = _this.mode$.pipe(startWith(null), map(function () { return _this.computedAppearance; }), distinctUntilChanged());
        hoveredService
            .createHovered$(elementRef.nativeElement)
            .pipe(watch(changeDetectorRef), takeUntil(destroy$))
            .subscribe(function (hovered) {
            _this.updateHovered(hovered);
        });
        pressedObservable(elementRef.nativeElement, {
            onlyTrusted: _this.takeOnlyTrustedEvents,
        })
            .pipe(watch(changeDetectorRef), takeUntil(destroy$))
            .subscribe(function (pressed) {
            _this.updatePressed(pressed);
        });
        focusVisible$.subscribe(function (focusVisible) {
            _this.updateFocusVisible(focusVisible);
        });
        return _this;
    }
    TuiButtonComponent_1 = TuiButtonComponent;
    Object.defineProperty(TuiButtonComponent.prototype, "nativeFocusableElement", {
        get: function () {
            return this.nativeDisabled ? null : this.elementRef.nativeElement;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(TuiButtonComponent.prototype, "focused", {
        get: function () {
            return !this.showLoader && isNativeFocused(this.elementRef.nativeElement);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(TuiButtonComponent.prototype, "loaderSize", {
        get: function () {
            return this.size === 'l' || this.size === 'xl' ? 'm' : 's';
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(TuiButtonComponent.prototype, "computedAppearance", {
        get: function () {
            var _a;
            return (_a = this.appearance) !== null && _a !== void 0 ? _a : (this.options.appearance || '');
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(TuiButtonComponent.prototype, "nativeDisabled", {
        get: function () {
            return this.computedDisabled || this.showLoader ? '' : null;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(TuiButtonComponent.prototype, "tabIndex", {
        get: function () {
            return this.focusable ? 0 : -1;
        },
        enumerable: true,
        configurable: true
    });
    TuiButtonComponent.prototype.onFocused = function (focused) {
        this.updateFocused(focused);
    };
    var TuiButtonComponent_1;
    TuiButtonComponent.ctorParameters = function () { return [
        { type: TuiModeDirective, decorators: [{ type: Optional }, { type: Inject, args: [TuiModeDirective,] }] },
        { type: ElementRef, decorators: [{ type: Inject, args: [ElementRef,] }] },
        { type: TuiFocusVisibleService, decorators: [{ type: Inject, args: [TuiFocusVisibleService,] }] },
        { type: TuiHoveredService, decorators: [{ type: Inject, args: [TuiHoveredService,] }] },
        { type: Observable, decorators: [{ type: Inject, args: [TuiDestroyService,] }] },
        { type: ChangeDetectorRef, decorators: [{ type: Inject, args: [ChangeDetectorRef,] }] },
        { type: Boolean, decorators: [{ type: Inject, args: [TUI_TAKE_ONLY_TRUSTED_EVENTS,] }] },
        { type: undefined, decorators: [{ type: Inject, args: [TUI_BUTTON_OPTIONS,] }] }
    ]; };
    __decorate([
        Input(),
        tuiDefaultProp()
    ], TuiButtonComponent.prototype, "appearance", void 0);
    __decorate([
        Input(),
        tuiDefaultProp()
    ], TuiButtonComponent.prototype, "disabled", void 0);
    __decorate([
        Input(),
        tuiDefaultProp()
    ], TuiButtonComponent.prototype, "icon", void 0);
    __decorate([
        Input(),
        tuiDefaultProp()
    ], TuiButtonComponent.prototype, "iconRight", void 0);
    __decorate([
        Input(),
        HostBinding('attr.data-shape'),
        tuiDefaultProp()
    ], TuiButtonComponent.prototype, "shape", void 0);
    __decorate([
        Input(),
        HostBinding('class._loading'),
        tuiDefaultProp()
    ], TuiButtonComponent.prototype, "showLoader", void 0);
    __decorate([
        Input(),
        HostBinding('attr.data-size'),
        tuiDefaultProp()
    ], TuiButtonComponent.prototype, "size", void 0);
    __decorate([
        HostBinding('attr.data-appearance')
    ], TuiButtonComponent.prototype, "computedAppearance", null);
    __decorate([
        HostBinding('attr.disabled')
    ], TuiButtonComponent.prototype, "nativeDisabled", null);
    __decorate([
        HostBinding('tabIndex')
    ], TuiButtonComponent.prototype, "tabIndex", null);
    __decorate([
        HostListener('focusin', ['true']),
        HostListener('focusout', ['false'])
    ], TuiButtonComponent.prototype, "onFocused", null);
    TuiButtonComponent = TuiButtonComponent_1 = __decorate([
        Component({
            selector: 'button[tuiButton], button[tuiIconButton], a[tuiButton], a[tuiIconButton]',
            template: "<ng-container *ngIf=\"appearance$ | async\"></ng-container>\n<tui-wrapper\n    class=\"t-wrapper\"\n    [appearance]=\"computedAppearance\"\n    [hovered]=\"computedHovered\"\n    [pressed]=\"computedPressed\"\n    [disabled]=\"computedDisabled\"\n    [focused]=\"computedFocusVisible\"\n>\n    <span class=\"t-content\">\n        <span\n            *ngIf=\"icon\"\n            polymorpheus-outlet\n            class=\"t-left\"\n            [content]=\"icon\"\n        >\n            <ng-template let-icon>\n                <tui-svg\n                    class=\"t-icon\"\n                    [src]=\"icon\"\n                ></tui-svg>\n            </ng-template>\n        </span>\n        <ng-content></ng-content>\n        <span\n            *ngIf=\"iconRight\"\n            polymorpheus-outlet\n            class=\"t-right\"\n            [content]=\"iconRight\"\n        >\n            <ng-template let-icon>\n                <tui-svg\n                    class=\"t-icon\"\n                    [src]=\"icon\"\n                ></tui-svg>\n            </ng-template>\n        </span>\n    </span>\n    <tui-loader\n        *ngIf=\"showLoader\"\n        class=\"t-loader\"\n        [size]=\"loaderSize\"\n        [inheritColor]=\"true\"\n    ></tui-loader>\n</tui-wrapper>\n",
            changeDetection: ChangeDetectionStrategy.OnPush,
            providers: [
                {
                    provide: TUI_FOCUSABLE_ITEM_ACCESSOR,
                    useExisting: forwardRef(function () { return TuiButtonComponent_1; }),
                },
                TuiDestroyService,
                TuiFocusVisibleService,
            ],
            styles: [":host{-webkit-appearance:none;-moz-appearance:none;appearance:none;padding:0;border:0;background:0 0;font-size:inherit;line-height:inherit;font:var(--tui-font-text-s);color:var(--tui-text-01);position:relative;display:inline-block;flex-shrink:0;vertical-align:top;border-radius:var(--tui-radius-m);-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;text-decoration:none;outline:0;color:inherit}:host[disabled]{pointer-events:none}:host[tuiIconButton] .t-left,:host[tuiIconButton] .t-right{margin:0}:host[data-shape=rounded]{border-radius:6.25rem}:host[data-size=xs]{height:var(--tui-height-xs);font-weight:400}:host[data-size=xs][data-shape=square],:host[data-size=xs][tuiIconButton]{height:var(--tui-height-xs);width:var(--tui-height-xs)}:host[data-size='s']{height:var(--tui-height-s);font-weight:400}:host[data-size='s'][data-shape=square],:host[data-size='s'][tuiIconButton]{height:var(--tui-height-s);width:var(--tui-height-s)}:host[data-size='m']{height:var(--tui-height-m);font:var(--tui-font-text-m);font-weight:700}:host[data-size='m'][data-shape=square],:host[data-size='m'][tuiIconButton]{height:var(--tui-height-m);width:var(--tui-height-m)}:host[data-size='l']{height:var(--tui-height-l);font:var(--tui-font-text-m);font-weight:700}:host[data-size='l'][data-shape=square],:host[data-size='l'][tuiIconButton]{height:var(--tui-height-l);width:var(--tui-height-l)}:host[data-size=xl]{height:3.75rem;font:var(--tui-font-text-m);font-weight:700}:host[data-size=xl][data-shape=square],:host[data-size=xl][tuiIconButton]{height:3.75rem;width:3.75rem}.t-loader{position:absolute;top:0;left:0;width:100%;height:100%;cursor:default}.t-left{margin:0 .5rem 0 -.25rem}.t-right{margin:0 -.5rem 0 .25rem}.t-icon{display:block}:host[data-size='s'] .t-icon,:host[data-size=xs] .t-icon{width:1rem;height:1rem}:host[tuiIconButton] .t-icon,:host[tuiIconButton] .t-left,:host[tuiIconButton] .t-right{display:flex;width:100%;height:100%;align-items:center;justify-content:center}.t-wrapper{position:relative;z-index:0;box-sizing:border-box;cursor:pointer}:host[data-size=xs] .t-wrapper{padding:0 .5rem}:host[data-size='s'] .t-wrapper{padding:0 .75rem}:host[data-size='m'] .t-wrapper{padding:0 1.5rem}:host[data-size='l'] .t-wrapper{padding:0 2.25rem}:host[data-size=xl] .t-wrapper{padding:0 2.5rem}:host[data-shape=square] .t-wrapper,:host[tuiIconButton] .t-wrapper{padding:0}.t-content{display:flex;height:100%;align-items:center;justify-content:center;text-align:center}:host._loading .t-content{opacity:0}"]
        }),
        __param(0, Optional()),
        __param(0, Inject(TuiModeDirective)),
        __param(1, Inject(ElementRef)),
        __param(2, Inject(TuiFocusVisibleService)),
        __param(3, Inject(TuiHoveredService)),
        __param(4, Inject(TuiDestroyService)),
        __param(5, Inject(ChangeDetectorRef)),
        __param(6, Inject(TUI_TAKE_ONLY_TRUSTED_EVENTS)),
        __param(7, Inject(TUI_BUTTON_OPTIONS))
    ], TuiButtonComponent);
    return TuiButtonComponent;
}(AbstractTuiInteractive));
export { TuiButtonComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYnV0dG9uLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0B0YWlnYS11aS9jb3JlL2NvbXBvbmVudHMvYnV0dG9uLyIsInNvdXJjZXMiOlsiYnV0dG9uLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUNILHVCQUF1QixFQUN2QixpQkFBaUIsRUFDakIsU0FBUyxFQUNULFVBQVUsRUFDVixVQUFVLEVBQ1YsV0FBVyxFQUNYLFlBQVksRUFDWixNQUFNLEVBQ04sS0FBSyxFQUNMLFFBQVEsR0FDWCxNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQ0gsc0JBQXNCLEVBQ3RCLGVBQWUsRUFDZixpQkFBaUIsRUFDakIsMkJBQTJCLEVBQzNCLDRCQUE0QixFQUM1QixjQUFjLEVBQ2QsaUJBQWlCLEVBQ2pCLDJCQUEyQixFQUMzQixzQkFBc0IsRUFDdEIsaUJBQWlCLEVBQ2pCLEtBQUssR0FDUixNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQUMsZ0JBQWdCLEVBQUMsTUFBTSwyQkFBMkIsQ0FBQztBQUczRCxPQUFPLEVBQUMsS0FBSyxFQUFFLFVBQVUsRUFBQyxNQUFNLE1BQU0sQ0FBQztBQUN2QyxPQUFPLEVBQUMsb0JBQW9CLEVBQUUsR0FBRyxFQUFFLFNBQVMsRUFBRSxTQUFTLEVBQUMsTUFBTSxnQkFBZ0IsQ0FBQztBQUUvRSxPQUFPLEVBQUMsa0JBQWtCLEVBQW1CLE1BQU0sa0JBQWtCLENBQUM7QUFnQnRFO0lBQ1ksc0NBQXNCO0lBMEM5Qiw0QkFHcUIsSUFBNkIsRUFDVCxVQUFtQyxFQUN4QyxhQUFxQyxFQUMxQyxjQUFpQyxFQUNqQyxRQUEwQixFQUMxQixpQkFBb0MsRUFFOUMscUJBQThCLEVBQ0YsT0FBeUI7O1FBWDFFLFlBYUksaUJBQU8sU0FrQlY7UUE1Qm9CLFVBQUksR0FBSixJQUFJLENBQXlCO1FBQ1QsZ0JBQVUsR0FBVixVQUFVLENBQXlCO1FBTXZELDJCQUFxQixHQUFyQixxQkFBcUIs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LENBQUMsTUFBTSxDQUFDLENBQUM7UUFDakMsWUFBWSxDQUFDLFVBQVUsRUFBRSxDQUFDLE9BQU8sQ0FBQyxDQUFDO3VEQUduQztJQTNHUSxrQkFBa0I7UUFkOUIsU0FBUyxDQUFDO1lBQ1AsUUFBUSxFQUFFLDBFQUEwRTtZQUNwRix1d0NBQXFDO1lBRXJDLGVBQWUsRUFBRSx1QkFBdUIsQ0FBQyxNQUFNO1lBQy9DLFNBQVMsRUFBRTtnQkFDUDtvQkFDSSxPQUFPLEVBQUUsMkJBQTJCO29CQUNwQyxXQUFXLEVBQUUsVUFBVSxDQUFDLGNBQU0sT0FBQSxvQkFBa0IsRUFBbEIsQ0FBa0IsQ0FBQztpQkFDcEQ7Z0JBQ0QsaUJBQWlCO2dCQUNqQixzQkFBc0I7YUFDekI7O1NBQ0osQ0FBQztRQTZDTyxXQUFBLFFBQVEsRUFBRSxDQUFBO1FBQ1YsV0FBQSxNQUFNLENBQUMsZ0JBQWdCLENBQUMsQ0FBQTtRQUV4QixXQUFBLE1BQU0sQ0FBQyxVQUFVLENBQUMsQ0FBQTtRQUNsQixXQUFBLE1BQU0sQ0FBQyxzQkFBc0IsQ0FBQyxDQUFBO1FBQzlCLFdBQUEsTUFBTSxDQUFDLGlCQUFpQixDQUFDLENBQUE7UUFDekIsV0FBQSxNQUFNLENBQUMsaUJBQWlCLENBQUMsQ0FBQTtRQUN6QixXQUFBLE1BQU0sQ0FBQyxpQkFBaUIsQ0FBQyxDQUFBO1FBQ3pCLFdBQUEsTUFBTSxDQUFDLDRCQUE0QixDQUFDLENBQUE7UUFFcEMsV0FBQSxNQUFNLENBQUMsa0JBQWtCLENBQUMsQ0FBQTtPQXREdEIsa0JBQWtCLENBNEc5QjtJQUFELHlCQUFDO0NBQUEsQUE1R0QsQ0FDWSxzQkFBc0IsR0EyR2pDO1NBNUdZLGtCQUFrQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gICAgQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3ksXG4gICAgQ2hhbmdlRGV0ZWN0b3JSZWYsXG4gICAgQ29tcG9uZW50LFxuICAgIEVsZW1lbnRSZWYsXG4gICAgZm9yd2FyZFJlZixcbiAgICBIb3N0QmluZGluZyxcbiAgICBIb3N0TGlzdGVuZXIsXG4gICAgSW5qZWN0LFxuICAgIElucHV0LFxuICAgIE9wdGlvbmFsLFxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7XG4gICAgQWJzdHJhY3RUdWlJbnRlcmFjdGl2ZSxcbiAgICBpc05hdGl2ZUZvY3VzZWQsXG4gICAgcHJlc3NlZE9ic2VydmFibGUsXG4gICAgVFVJX0ZPQ1VTQUJMRV9JVEVNX0FDQ0VTU09SLFxuICAgIFRVSV9UQUtFX09OTFlfVFJVU1RFRF9FVkVOVFMsXG4gICAgdHVpRGVmYXVsdFByb3AsXG4gICAgVHVpRGVzdHJveVNlcnZpY2UsXG4gICAgVHVpRm9jdXNhYmxlRWxlbWVudEFjY2Vzc29yLFxuICAgIFR1aUZvY3VzVmlzaWJsZVNlcnZpY2UsXG4gICAgVHVpSG92ZXJlZFNlcnZpY2UsXG4gICAgd2F0Y2gsXG59IGZyb20gJ0B0YWlnYS11aS9jZGsnO1xuaW1wb3J0IHtUdWlNb2RlRGlyZWN0aXZlfSBmcm9tICdAdGFpZ2EtdWkvY29yZS9kaXJlY3RpdmVzJztcbmltcG9ydCB7VHVpU2l6ZVN9IGZyb20gJ0B0YWlnYS11aS9jb3JlL3R5cGVzJztcbmltcG9ydCB7UG9seW1vcnBoZXVzQ29udGVudH0gZnJvbSAnQHRpbmtvZmYvbmctcG9seW1vcnBoZXVzJztcbmltcG9ydCB7RU1QVFksIE9ic2VydmFibGV9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHtkaXN0aW5jdFVudGlsQ2hhbmdlZCwgbWFwLCBzdGFydFdpdGgsIHRha2VVbnRpbH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuXG5pbXBvcnQge1RVSV9CVVRUT05fT1BUSU9OUywgVHVpQnV0dG9uT3B0aW9uc30gZnJvbSAnLi9idXR0b24tb3B0aW9ucyc7XG5cbkBDb21wb25lbnQoe1xuICAgIHNlbGVjdG9yOiAnYnV0dG9uW3R1aUJ1dHRvbl0sIGJ1dHRvblt0dWlJY29uQnV0dG9uXSwgYVt0dWlCdXR0b25dLCBhW3R1aUljb25CdXR0b25dJyxcbiAgICB0ZW1wbGF0ZVVybDogJy4vYnV0dG9uLnRlbXBsYXRlLmh0bWwnLFxuICAgIHN0eWxlVXJsczogWycuL2J1dHRvbi5zdHlsZS5sZXNzJ10sXG4gICAgY2hhbmdlRGV0ZWN0aW9uOiBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneS5PblB1c2gsXG4gICAgcHJvdmlkZXJzOiBbXG4gICAgICAgIHtcbiAgICAgICAgICAgIHByb3ZpZGU6IFRVSV9GT0NVU0FCTEVfSVRFTV9BQ0NFU1NPUixcbiAgICAgICAgICAgIHVzZUV4aXN0aW5nOiBmb3J3YXJkUmVmKCgpID0+IFR1aUJ1dHRvbkNvbXBvbmVudCksXG4gICAgICAgIH0sXG4gICAgICAgIFR1aURlc3Ryb3lTZXJ2aWNlLFxuICAgICAgICBUdWlGb2N1c1Zpc2libGVTZXJ2aWNlLFxuICAgIF0sXG59KVxuZXhwb3J0IGNsYXNzIFR1aUJ1dHRvbkNvbXBvbmVudFxuICAgIGV4dGVuZHMgQWJzdHJhY3RUdWlJbnRlcmFjdGl2ZVxuICAgIGltcGxlbWVudHMgVHVpRm9jdXNhYmxlRWxlbWVudEFjY2Vzc29yLCBUdWlCdXR0b25PcHRpb25zXG57XG4gICAgcHJpdmF0ZSByZWFkb25seSBtb2RlJDogT2JzZXJ2YWJsZTx1bmtub3duPiA9IHRoaXMubW9kZT8uY2hhbmdlJCB8fCBFTVBUWTtcblxuICAgIEBJbnB1dCgpXG4gICAgQHR1aURlZmF1bHRQcm9wKClcbiAgICBhcHBlYXJhbmNlOiBUdWlCdXR0b25PcHRpb25zWydhcHBlYXJhbmNlJ10gPSBudWxsO1xuXG4gICAgQElucHV0KClcbiAgICBAdHVpRGVmYXVsdFByb3AoKVxuICAgIGRpc2FibGVkID0gZmFsc2U7XG5cbiAgICBASW5wdXQoKVxuICAgIEB0dWlEZWZhdWx0UHJvcCgpXG4gICAgaWNvbjogUG9seW1vcnBoZXVzQ29udGVudCA9ICcnO1xuXG4gICAgQElucHV0KClcbiAgICBAdHVpRGVmYXVsdFByb3AoKVxuICAgIGljb25SaWdodDogUG9seW1vcnBoZXVzQ29udGVudCA9ICcnO1xuXG4gICAgQElucHV0KClcbiAgICBASG9zdEJpbmRpbmcoJ2F0dHIuZGF0YS1zaGFwZScpXG4gICAgQHR1aURlZmF1bHRQcm9wKClcbiAgICBzaGFwZSA9IHRoaXMub3B0aW9ucy5zaGFwZTtcblxuICAgIEBJbnB1dCgpXG4gICAgQEhvc3RCaW5kaW5nKCdjbGFzcy5fbG9hZGluZycpXG4gICAgQHR1aURlZmF1bHRQcm9wKClcbiAgICBzaG93TG9hZGVyID0gZmFsc2U7XG5cbiAgICBASW5wdXQoKVxuICAgIEBIb3N0QmluZGluZygnYXR0ci5kYXRhLXNpemUnKVxuICAgIEB0dWlEZWZhdWx0UHJvcCgpXG4gICAgc2l6ZSA9IHRoaXMub3B0aW9ucy5zaXplO1xuXG4gICAgcmVhZG9ubHkgYXBwZWFyYW5jZSQgPSB0aGlzLm1vZGUkLnBpcGUoXG4gICAgICAgIHN0YXJ0V2l0aChudWxsKSxcbiAgICAgICAgbWFwKCgpID0+IHRoaXMuY29tcHV0ZWRBcHBlYXJhbmNlKSxcbiAgICAgICAgZGlzdGluY3RVbnRpbENoYW5nZWQoKSxcbiAgICApO1xuXG4gICAgY29uc3RydWN0b3IoXG4gICAgICAgIEBPcHRpb25hbCgpXG4gICAgICAgIEBJbmplY3QoVHVpTW9kZURpcmVjdGl2ZSlcbiAgICAgICAgcHJpdmF0ZSByZWFkb25seSBtb2RlOiBUdWlNb2RlRGlyZWN0aXZlIHwgbnVsbCxcbiAgICAgICAgQEluamVjdChFbGVtZW50UmVmKSBwcml2YXRlIHJlYWRvbmx5IGVsZW1lbnRSZWY6IEVsZW1lbnRSZWY8SFRNTEVsZW1lbnQ+LFxuICAgICAgICBASW5qZWN0KFR1aUZvY3VzVmlzaWJsZVNlcnZpY2UpIGZvY3VzVmlzaWJsZSQ6IFR1aUZvY3VzVmlzaWJsZVNlcnZpY2UsXG4gICAgICAgIEBJbmplY3QoVHVpSG92ZXJlZFNlcnZpY2UpIGhvdmVyZWRTZXJ2aWNlOiBUdWlIb3ZlcmVkU2VydmljZSxcbiAgICAgICAgQEluamVjdChUdWlEZXN0cm95U2VydmljZSkgZGVzdHJveSQ6IE9ic2VydmFibGU8dm9pZD4sXG4gICAgICAgIEBJbmplY3QoQ2hhbmdlRGV0ZWN0b3JSZWYpIGNoYW5nZURldGVjdG9yUmVmOiBDaGFuZ2VEZXRlY3RvclJlZixcbiAgICAgICAgQEluamVjdChUVUlfVEFLRV9PTkxZX1RSVVNURURfRVZFTlRTKVxuICAgICAgICBwcml2YXRlIHJlYWRvbmx5IHRha2VPbmx5VHJ1c3RlZEV2ZW50czogYm9vbGVhbixcbiAgICAgICAgQEluamVjdChUVUlfQlVUVE9OX09QVElPTlMpIHByaXZhdGUgcmVhZG9ubHkgb3B0aW9uczogVHVpQnV0dG9uT3B0aW9ucyxcbiAgICApIHtcbiAgICAgICAgc3VwZXIoKTtcblxuICAgICAgICBob3ZlcmVkU2VydmljZVxuICAgICAgICAgICAgLmNyZWF0ZUhvdmVyZWQkKGVsZW1lbnRSZWYubmF0aXZlRWxlbWVudClcbiAgICAgICAgICAgIC5waXBlKHdhdGNoKGNoYW5nZURldGVjdG9yUmVmKSwgdGFrZVVudGlsKGRlc3Ryb3kkKSlcbiAgICAgICAgICAgIC5zdWJzY3JpYmUoaG92ZXJlZCA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy51cGRhdGVIb3ZlcmVkKGhvdmVyZWQpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIHByZXNzZWRPYnNlcnZhYmxlKGVsZW1lbnRSZWYubmF0aXZlRWxlbWVudCwge1xuICAgICAgICAgICAgb25seVRydXN0ZWQ6IHRoaXMudGFrZU9ubHlUcnVzdGVkRXZlbnRzLFxuICAgICAgICB9KVxuICAgICAgICAgICAgLnBpcGUod2F0Y2goY2hhbmdlRGV0ZWN0b3JSZWYpLCB0YWtlVW50aWwoZGVzdHJveSQpKVxuICAgICAgICAgICAgLnN1YnNjcmliZShwcmVzc2VkID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZVByZXNzZWQocHJlc3NlZCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgZm9jdXNWaXNpYmxlJC5zdWJzY3JpYmUoZm9jdXNWaXNpYmxlID0+IHtcbiAgICAgICAgICAgIHRoaXMudXBkYXRlRm9jdXNWaXNpYmxlKGZvY3VzVmlzaWJsZSk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIGdldCBuYXRpdmVGb2N1c2FibGVFbGVtZW50KCk6IEhUTUxFbGVtZW50IHwgbnVsbCB7XG4gICAgICAgIHJldHVybiB0aGlzLm5hdGl2ZURpc2FibGVkID8gbnVsbCA6IHRoaXMuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50O1xuICAgIH1cblxuICAgIGdldCBmb2N1c2VkKCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gIXRoaXMuc2hvd0xvYWRlciAmJiBpc05hdGl2ZUZvY3VzZWQodGhpcy5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQpO1xuICAgIH1cblxuICAgIGdldCBsb2FkZXJTaXplKCk6IFR1aVNpemVTIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc2l6ZSA9PT0gJ2wnIHx8IHRoaXMuc2l6ZSA9PT0gJ3hsJyA/ICdtJyA6ICdzJztcbiAgICB9XG5cbiAgICBASG9zdEJpbmRpbmcoJ2F0dHIuZGF0YS1hcHBlYXJhbmNlJylcbiAgICBnZXQgY29tcHV0ZWRBcHBlYXJhbmNlKCk6IHN0cmluZyB7XG4gICAgICAgIHJldHVybiB0aGlzLmFwcGVhcmFuY2UgPz8gKHRoaXMub3B0aW9ucy5hcHBlYXJhbmNlIHx8ICcnKTtcbiAgICB9XG5cbiAgICBASG9zdEJpbmRpbmcoJ2F0dHIuZGlzYWJsZWQnKVxuICAgIGdldCBuYXRpdmVEaXNhYmxlZCgpOiAnJyB8IG51bGwge1xuICAgICAgICByZXR1cm4gdGhpcy5jb21wdXRlZERpc2FibGVkIHx8IHRoaXMuc2hvd0xvYWRlciA/ICcnIDogbnVsbDtcbiAgICB9XG5cbiAgICBASG9zdEJpbmRpbmcoJ3RhYkluZGV4JylcbiAgICBnZXQgdGFiSW5kZXgoKTogbnVtYmVyIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZm9jdXNhYmxlID8gMCA6IC0xO1xuICAgIH1cblxuICAgIEBIb3N0TGlzdGVuZXIoJ2ZvY3VzaW4nLCBbJ3RydWUnXSlcbiAgICBASG9zdExpc3RlbmVyKCdmb2N1c291dCcsIFsnZmFsc2UnXSlcbiAgICBvbkZvY3VzZWQoZm9jdXNlZDogYm9vbGVhbik6IHZvaWQge1xuICAgICAgICB0aGlzLnVwZGF0ZUZvY3VzZWQoZm9jdXNlZCk7XG4gICAgfVxufVxuIl19