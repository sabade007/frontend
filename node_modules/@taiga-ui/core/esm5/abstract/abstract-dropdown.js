import { __decorate } from "tslib";
import { AfterViewChecked, ComponentFactoryResolver, ComponentRef, Directive, ElementRef, Injector, Input, OnDestroy, } from '@angular/core';
import { TuiActiveZoneDirective, tuiDefaultProp, TuiNativeFocusableElement, TuiPortalService, tuiPure, } from '@taiga-ui/cdk';
import { TuiDropdownBoxComponent } from '@taiga-ui/core/components/dropdown-box';
import { DEFAULT_MAX_HEIGHT, DEFAULT_MIN_HEIGHT } from '@taiga-ui/core/constants';
import { checkFixedPosition } from '@taiga-ui/core/utils/dom';
// @bad TODO: Possibly refactor to make more abstract
var AbstractTuiDropdown = /** @class */ (function () {
    function AbstractTuiDropdown(componentFactoryResolver, injector, portalService, elementRef, activeZone) {
        this.componentFactoryResolver = componentFactoryResolver;
        this.injector = injector;
        this.portalService = portalService;
        this.elementRef = elementRef;
        this.activeZone = activeZone;
        this.content = "";
        this.tuiDropdownHost = null;
        this.minHeight = DEFAULT_MIN_HEIGHT;
        this.maxHeight = DEFAULT_MAX_HEIGHT;
        this.align = "left";
        this.direction = null;
        this.sided = false;
        this.limitMinWidth = "min";
        this.dropdownBoxRef = null;
    }
    AbstractTuiDropdown.prototype.ngOnDestroy = function () {
        this.closeDropdownBox();
    };
    AbstractTuiDropdown.prototype.ngAfterViewChecked = function () {
        // @awful TODO: This is probably wrong to call both but in TuiHostedDropdown some changes do not propagate otherwise
        if (this.dropdownBoxRef !== null) {
            this.dropdownBoxRef.changeDetectorRef.detectChanges();
            this.dropdownBoxRef.changeDetectorRef.markForCheck();
        }
    };
    Object.defineProperty(AbstractTuiDropdown.prototype, "clientRect", {
        get: function () {
            return this.elementRef.nativeElement.getBoundingClientRect();
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(AbstractTuiDropdown.prototype, "host", {
        get: function () {
            return this.tuiDropdownHost || this.elementRef.nativeElement;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(AbstractTuiDropdown.prototype, "fixed", {
        get: function () {
            return checkFixedPosition(this.elementRef.nativeElement);
        },
        enumerable: true,
        configurable: true
    });
    AbstractTuiDropdown.prototype.toggleDropdown = function (value) {
        if (value) {
            this.openDropdownBox();
        }
        else {
            this.closeDropdownBox();
        }
    };
    AbstractTuiDropdown.prototype.openDropdownBox = function () {
        if (this.dropdownBoxRef !== null) {
            return;
        }
        var componentFactory = this.componentFactoryResolver.resolveComponentFactory(TuiDropdownBoxComponent);
        this.dropdownBoxRef = this.portalService.add(componentFactory, this.injector);
        this.dropdownBoxRef.changeDetectorRef.detectChanges();
    };
    AbstractTuiDropdown.prototype.closeDropdownBox = function () {
        if (this.dropdownBoxRef === null) {
            return;
        }
        this.portalService.remove(this.dropdownBoxRef);
        this.dropdownBoxRef = null;
    };
    AbstractTuiDropdown.ctorParameters = function () { return [
        { type: ComponentFactoryResolver },
        { type: Injector },
        { type: TuiPortalService },
        { type: ElementRef },
        { type: TuiActiveZoneDirective }
    ]; };
    __decorate([
        Input("tuiDropdownContent"),
        tuiDefaultProp()
    ], AbstractTuiDropdown.prototype, "content", void 0);
    __decorate([
        Input("tuiDropdownHost"),
        tuiDefaultProp()
    ], AbstractTuiDropdown.prototype, "tuiDropdownHost", void 0);
    __decorate([
        Input("tuiDropdownMinHeight"),
        tuiDefaultProp()
    ], AbstractTuiDropdown.prototype, "minHeight", void 0);
    __decorate([
        Input("tuiDropdownMaxHeight"),
        tuiDefaultProp()
    ], AbstractTuiDropdown.prototype, "maxHeight", void 0);
    __decorate([
        Input("tuiDropdownAlign"),
        tuiDefaultProp()
    ], AbstractTuiDropdown.prototype, "align", void 0);
    __decorate([
        Input("tuiDropdownDirection"),
        tuiDefaultProp()
    ], AbstractTuiDropdown.prototype, "direction", void 0);
    __decorate([
        Input("tuiDropdownSided"),
        tuiDefaultProp()
    ], AbstractTuiDropdown.prototype, "sided", void 0);
    __decorate([
        Input("tuiDropdownLimitWidth"),
        tuiDefaultProp()
    ], AbstractTuiDropdown.prototype, "limitMinWidth", void 0);
    __decorate([
        tuiPure
    ], AbstractTuiDropdown.prototype, "fixed", null);
    __decorate([
        tuiPure
    ], AbstractTuiDropdown.prototype, "toggleDropdown", null);
    AbstractTuiDropdown = __decorate([
        Directive()
    ], AbstractTuiDropdown);
    return AbstractTuiDropdown;
}());
export { AbstractTuiDropdown };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYWJzdHJhY3QtZHJvcGRvd24uanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AdGFpZ2EtdWkvY29yZS9hYnN0cmFjdC8iLCJzb3VyY2VzIjpbImFic3RyYWN0LWRyb3Bkb3duLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQ0gsZ0JBQWdCLEVBQ2hCLHdCQUF3QixFQUN4QixZQUFZLEVBQ1osU0FBUyxFQUNULFVBQVUsRUFDVixRQUFRLEVBQ1IsS0FBSyxFQUNMLFNBQVMsR0FDWixNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQ0gsc0JBQXNCLEVBQ3RCLGNBQWMsRUFDZCx5QkFBeUIsRUFDekIsZ0JBQWdCLEVBQ2hCLE9BQU8sR0FDVixNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQUMsdUJBQXVCLEVBQUMsTUFBTSx3Q0FBd0MsQ0FBQztBQUMvRSxPQUFPLEVBQUMsa0JBQWtCLEVBQUUsa0JBQWtCLEVBQUMsTUFBTSwwQkFBMEIsQ0FBQztBQU9oRixPQUFPLEVBQUMsa0JBQWtCLEVBQUMsTUFBTSwwQkFBMEIsQ0FBQztBQUk1RCxxREFBcUQ7QUFFckQ7SUF1Q0ksNkJBQ3FCLHdCQUFrRCxFQUNsRCxRQUFrQixFQUNsQixhQUErQixFQUM3QixVQUFtQyxFQUM3QyxVQUF5QztRQUpqQyw2QkFBd0IsR0FBeEIsd0JBQXdCLENBQTBCO1FBQ2xELGFBQVEsR0FBUixRQUFRLENBQVU7UUFDbEIsa0JBQWEsR0FBYixhQUFhLENBQWtCO1FBQzdCLGVBQVUsR0FBVixVQUFVLENBQXlCO1FBQzdDLGVBQVUsR0FBVixVQUFVLENBQStCO1FBckN0RCxZQUFPLEdBQXdCLEVBQUUsQ0FBQztRQUlsQyxvQkFBZSxHQUFtRCxJQUFJLENBQUM7UUFJdkUsY0FBUyxHQUFHLGtCQUFrQixDQUFDO1FBSS9CLGNBQVMsR0FBRyxrQkFBa0IsQ0FBQztRQUkvQixVQUFLLEdBQTJCLE1BQU0sQ0FBQztRQUl2QyxjQUFTLEdBQWdDLElBQUksQ0FBQztRQUk5QyxV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T0FBTzs2REFPUDtJQS9FaUIsbUJBQW1CO1FBRHhDLFNBQVMsRUFBRTtPQUNVLG1CQUFtQixDQXNHeEM7SUFBRCwwQkFBQztDQUFBLEFBdEdELElBc0dDO1NBdEdxQixtQkFBbUIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICAgIEFmdGVyVmlld0NoZWNrZWQsXG4gICAgQ29tcG9uZW50RmFjdG9yeVJlc29sdmVyLFxuICAgIENvbXBvbmVudFJlZixcbiAgICBEaXJlY3RpdmUsXG4gICAgRWxlbWVudFJlZixcbiAgICBJbmplY3RvcixcbiAgICBJbnB1dCxcbiAgICBPbkRlc3Ryb3ksXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHtcbiAgICBUdWlBY3RpdmVab25lRGlyZWN0aXZlLFxuICAgIHR1aURlZmF1bHRQcm9wLFxuICAgIFR1aU5hdGl2ZUZvY3VzYWJsZUVsZW1lbnQsXG4gICAgVHVpUG9ydGFsU2VydmljZSxcbiAgICB0dWlQdXJlLFxufSBmcm9tICdAdGFpZ2EtdWkvY2RrJztcbmltcG9ydCB7VHVpRHJvcGRvd25Cb3hDb21wb25lbnR9IGZyb20gJ0B0YWlnYS11aS9jb3JlL2NvbXBvbmVudHMvZHJvcGRvd24tYm94JztcbmltcG9ydCB7REVGQVVMVF9NQVhfSEVJR0hULCBERUZBVUxUX01JTl9IRUlHSFR9IGZyb20gJ0B0YWlnYS11aS9jb3JlL2NvbnN0YW50cyc7XG5pbXBvcnQge1R1aURyb3Bkb3dufSBmcm9tICdAdGFpZ2EtdWkvY29yZS9pbnRlcmZhY2VzJztcbmltcG9ydCB7XG4gICAgVHVpRHJvcGRvd25XaWR0aFQsXG4gICAgVHVpSG9yaXpvbnRhbERpcmVjdGlvbixcbiAgICBUdWlWZXJ0aWNhbERpcmVjdGlvbixcbn0gZnJvbSAnQHRhaWdhLXVpL2NvcmUvdHlwZXMnO1xuaW1wb3J0IHtjaGVja0ZpeGVkUG9zaXRpb259IGZyb20gJ0B0YWlnYS11aS9jb3JlL3V0aWxzL2RvbSc7XG5pbXBvcnQge1BvbHltb3JwaGV1c0NvbnRlbnR9IGZyb20gJ0B0aW5rb2ZmL25nLXBvbHltb3JwaGV1cyc7XG5pbXBvcnQge09ic2VydmFibGV9IGZyb20gJ3J4anMnO1xuXG4vLyBAYmFkIFRPRE86IFBvc3NpYmx5IHJlZmFjdG9yIHRvIG1ha2UgbW9yZSBhYnN0cmFjdFxuQERpcmVjdGl2ZSgpXG5leHBvcnQgYWJzdHJhY3QgY2xhc3MgQWJzdHJhY3RUdWlEcm9wZG93blxuICAgIGltcGxlbWVudHMgVHVpRHJvcGRvd24sIEFmdGVyVmlld0NoZWNrZWQsIE9uRGVzdHJveVxue1xuICAgIGFic3RyYWN0IHJlZnJlc2gkOiBPYnNlcnZhYmxlPHVua25vd24+O1xuXG4gICAgQElucHV0KGB0dWlEcm9wZG93bkNvbnRlbnRgKVxuICAgIEB0dWlEZWZhdWx0UHJvcCgpXG4gICAgY29udGVudDogUG9seW1vcnBoZXVzQ29udGVudCA9IGBgO1xuXG4gICAgQElucHV0KGB0dWlEcm9wZG93bkhvc3RgKVxuICAgIEB0dWlEZWZhdWx0UHJvcCgpXG4gICAgdHVpRHJvcGRvd25Ib3N0OiBIVE1MRWxlbWVudCB8IFR1aU5hdGl2ZUZvY3VzYWJsZUVsZW1lbnQgfCBudWxsID0gbnVsbDtcblxuICAgIEBJbnB1dChgdHVpRHJvcGRvd25NaW5IZWlnaHRgKVxuICAgIEB0dWlEZWZhdWx0UHJvcCgpXG4gICAgbWluSGVpZ2h0ID0gREVGQVVMVF9NSU5fSEVJR0hUO1xuXG4gICAgQElucHV0KGB0dWlEcm9wZG93bk1heEhlaWdodGApXG4gICAgQHR1aURlZmF1bHRQcm9wKClcbiAgICBtYXhIZWlnaHQgPSBERUZBVUxUX01BWF9IRUlHSFQ7XG5cbiAgICBASW5wdXQoYHR1aURyb3Bkb3duQWxpZ25gKVxuICAgIEB0dWlEZWZhdWx0UHJvcCgpXG4gICAgYWxpZ246IFR1aUhvcml6b250YWxEaXJlY3Rpb24gPSBgbGVmdGA7XG5cbiAgICBASW5wdXQoYHR1aURyb3Bkb3duRGlyZWN0aW9uYClcbiAgICBAdHVpRGVmYXVsdFByb3AoKVxuICAgIGRpcmVjdGlvbjogVHVpVmVydGljYWxEaXJlY3Rpb24gfCBudWxsID0gbnVsbDtcblxuICAgIEBJbnB1dChgdHVpRHJvcGRvd25TaWRlZGApXG4gICAgQHR1aURlZmF1bHRQcm9wKClcbiAgICBzaWRlZCA9IGZhbHNlO1xuXG4gICAgQElucHV0KGB0dWlEcm9wZG93bkxpbWl0V2lkdGhgKVxuICAgIEB0dWlEZWZhdWx0UHJvcCgpXG4gICAgbGltaXRNaW5XaWR0aDogVHVpRHJvcGRvd25XaWR0aFQgPSBgbWluYDtcblxuICAgIGRyb3Bkb3duQm94UmVmOiBDb21wb25lbnRSZWY8VHVpRHJvcGRvd25Cb3hDb21wb25lbnQ+IHwgbnVsbCA9IG51bGw7XG5cbiAgICBwcm90ZWN0ZWQgY29uc3RydWN0b3IoXG4gICAgICAgIHByaXZhdGUgcmVhZG9ubHkgY29tcG9uZW50RmFjdG9yeVJlc29sdmVyOiBDb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIsXG4gICAgICAgIHByaXZhdGUgcmVhZG9ubHkgaW5qZWN0b3I6IEluamVjdG9yLFxuICAgICAgICBwcml2YXRlIHJlYWRvbmx5IHBvcnRhbFNlcnZpY2U6IFR1aVBvcnRhbFNlcnZpY2UsXG4gICAgICAgIHByb3RlY3RlZCByZWFkb25seSBlbGVtZW50UmVmOiBFbGVtZW50UmVmPEhUTUxFbGVtZW50PixcbiAgICAgICAgcmVhZG9ubHkgYWN0aXZlWm9uZTogVHVpQWN0aXZlWm9uZURpcmVjdGl2ZSB8IG51bGwsXG4gICAgKSB7fVxuXG4gICAgbmdPbkRlc3Ryb3koKTogdm9pZCB7XG4gICAgICAgIHRoaXMuY2xvc2VEcm9wZG93bkJveCgpO1xuICAgIH1cblxuICAgIG5nQWZ0ZXJWaWV3Q2hlY2tlZCgpOiB2b2lkIHtcbiAgICAgICAgLy8gQGF3ZnVsIFRPRE86IFRoaXMgaXMgcHJvYmFibHkgd3JvbmcgdG8gY2FsbCBib3RoIGJ1dCBpbiBUdWlIb3N0ZWREcm9wZG93biBzb21lIGNoYW5nZXMgZG8gbm90IHByb3BhZ2F0ZSBvdGhlcndpc2VcbiAgICAgICAgaWYgKHRoaXMuZHJvcGRvd25Cb3hSZWYgIT09IG51bGwpIHtcbiAgICAgICAgICAgIHRoaXMuZHJvcGRvd25Cb3hSZWYuY2hhbmdlRGV0ZWN0b3JSZWYuZGV0ZWN0Q2hhbmdlcygpO1xuICAgICAgICAgICAgdGhpcy5kcm9wZG93bkJveFJlZi5jaGFuZ2VEZXRlY3RvclJlZi5tYXJrRm9yQ2hlY2soKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGdldCBjbGllbnRSZWN0KCk6IENsaWVudFJlY3Qge1xuICAgICAgICByZXR1cm4gdGhpcy5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG4gICAgfVxuXG4gICAgZ2V0IGhvc3QoKTogSFRNTEVsZW1lbnQgfCBUdWlOYXRpdmVGb2N1c2FibGVFbGVtZW50IHtcbiAgICAgICAgcmV0dXJuIHRoaXMudHVpRHJvcGRvd25Ib3N0IHx8IHRoaXMuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50O1xuICAgIH1cblxuICAgIEB0dWlQdXJlXG4gICAgZ2V0IGZpeGVkKCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gY2hlY2tGaXhlZFBvc2l0aW9uKHRoaXMuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50KTtcbiAgICB9XG5cbiAgICBAdHVpUHVyZVxuICAgIHByb3RlY3RlZCB0b2dnbGVEcm9wZG93bih2YWx1ZTogYm9vbGVhbik6IHZvaWQge1xuICAgICAgICBpZiAodmFsdWUpIHtcbiAgICAgICAgICAgIHRoaXMub3BlbkRyb3Bkb3duQm94KCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmNsb3NlRHJvcGRvd25Cb3goKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByb3RlY3RlZCBvcGVuRHJvcGRvd25Cb3goKTogdm9pZCB7XG4gICAgICAgIGlmICh0aGlzLmRyb3Bkb3duQm94UmVmICE9PSBudWxsKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBjb21wb25lbnRGYWN0b3J5ID0gdGhpcy5jb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIucmVzb2x2ZUNvbXBvbmVudEZhY3RvcnkoXG4gICAgICAgICAgICBUdWlEcm9wZG93bkJveENvbXBvbmVudCxcbiAgICAgICAgKTtcblxuICAgICAgICB0aGlzLmRyb3Bkb3duQm94UmVmID0gdGhpcy5wb3J0YWxTZXJ2aWNlLmFkZChjb21wb25lbnRGYWN0b3J5LCB0aGlzLmluamVjdG9yKTtcbiAgICAgICAgdGhpcy5kcm9wZG93bkJveFJlZi5jaGFuZ2VEZXRlY3RvclJlZi5kZXRlY3RDaGFuZ2VzKCk7XG4gICAgfVxuXG4gICAgcHJvdGVjdGVkIGNsb3NlRHJvcGRvd25Cb3goKTogdm9pZCB7XG4gICAgICAgIGlmICh0aGlzLmRyb3Bkb3duQm94UmVmID09PSBudWxsKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLnBvcnRhbFNlcnZpY2UucmVtb3ZlKHRoaXMuZHJvcGRvd25Cb3hSZWYpO1xuICAgICAgICB0aGlzLmRyb3Bkb3duQm94UmVmID0gbnVsbDtcbiAgICB9XG59XG4iXX0=