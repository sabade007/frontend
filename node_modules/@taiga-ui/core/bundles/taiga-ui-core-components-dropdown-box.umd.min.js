!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("@ng-web-apis/common"),require("@taiga-ui/cdk"),require("@taiga-ui/core/animations"),require("@taiga-ui/core/constants"),require("@taiga-ui/core/tokens"),require("@taiga-ui/core/utils/dom"),require("rxjs"),require("rxjs/operators"),require("@taiga-ui/core/components/scrollbar"),require("@taiga-ui/core/directives/mode"),require("@tinkoff/ng-polymorpheus")):"function"==typeof define&&define.amd?define("@taiga-ui/core/components/dropdown-box",["exports","@angular/core","@ng-web-apis/common","@taiga-ui/cdk","@taiga-ui/core/animations","@taiga-ui/core/constants","@taiga-ui/core/tokens","@taiga-ui/core/utils/dom","rxjs","rxjs/operators","@taiga-ui/core/components/scrollbar","@taiga-ui/core/directives/mode","@tinkoff/ng-polymorpheus"],e):e(((t=t||self)["taiga-ui"]=t["taiga-ui"]||{},t["taiga-ui"].core=t["taiga-ui"].core||{},t["taiga-ui"].core.components=t["taiga-ui"].core.components||{},t["taiga-ui"].core.components["dropdown-box"]={}),t.ng.core,t.common,t.cdk,t["taiga-ui"].core.animations,t["taiga-ui"].core.constants,t["taiga-ui"].core.tokens,t["taiga-ui"].core.utils.dom,t.rxjs,t.rxjs.operators,t["taiga-ui"].core.components.scrollbar,t["taiga-ui"].core.directives.mode,t.ngPolymorpheus)}(this,(function(t,e,i,o,n,r,a,c,s,l,u,d,p){"use strict";var h=function(){return(h=Object.assign||function(t){for(var e,i=1,o=arguments.length;i<o;i++)for(var n in e=arguments[i])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}).apply(this,arguments)};function f(t,e,i,o){var n,r=arguments.length,a=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,o);else for(var c=t.length-1;c>=0;c--)(n=t[c])&&(a=(r<3?n(a):r>3?n(e,i,a):n(e,i))||a);return r>3&&a&&Object.defineProperty(e,i,a),a}function g(t,e){return function(i,o){e(i,o,t)}}Object.create;Object.create;var m=function(){function t(t,e,i,n,r,a,c,u){var d=this;this.directive=i,this.windowRef=n,this.elementRef=r,this.portalHost=a,this.options=c,this.animationTop=h({value:"fadeInTop"},this.options),this.animationBottom=h({value:"fadeInBottom"},this.options),this.prevDirectionIsTop=!1,s.merge(u.pipe(l.throttleTime(o.POLLING_TIME)),this.directive.refresh$,s.fromEvent(this.windowRef,"resize")).pipe(o.tuiZonefree(e),l.takeUntil(t)).subscribe((function(){d.calculatePositionAndSize()}))}return Object.defineProperty(t.prototype,"overscroll",{get:function(){return this.inModal?"all":"scroll"},enumerable:!0,configurable:!0}),t.prototype.getContext=function(t,e){return h(h({},t),{activeZone:e})},t.prototype.ngAfterViewChecked=function(){this.calculatePositionAndSize()},t.prototype.onTopFocus=function(){this.moveFocusOutside(!0)},t.prototype.onBottomFocus=function(){this.moveFocusOutside(!1)},Object.defineProperty(t.prototype,"inModal",{get:function(){return!!this.directive.host.closest("tui-dialog-host")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"inOption",{get:function(){return!!this.directive.host.closest("[tuiOption]")},enumerable:!0,configurable:!0}),t.prototype.calculatePositionAndSize=function(){var t=this.directive.clientRect,e=this.elementRef.nativeElement.style,i=this.directive.fixed?this.portalHost.fixedPositionOffset():this.portalHost.clientRect;e.position=this.directive.fixed?"fixed":"absolute",this.calculateVerticalPosition(e,t,i),this.calculateHorizontalPosition(e,t,i),this.calculateWidth(e,t)},t.prototype.getFinalAlign=function(t,e){var i=this.elementRef.nativeElement.getBoundingClientRect(),o=this.elementRef.nativeElement.offsetWidth,n=c.getScreenWidth(this.windowRef.document),r=e.left+o<n||e.right-o>0,a=i.right<=n&&i.left>=0,s=this.directive.align;switch(this.directive.align){case"left":r&&i.right>n&&(s="right");break;case"right":r&&i.left<0&&(s="left")}return"auto"===t.right&&a&&(s="left"),"auto"===t.left&&a&&(s="right"),s},t.prototype.calculateHorizontalPosition=function(t,e,i){var n=this.directive.sided?this.elementRef.nativeElement.getBoundingClientRect().width+r.DEFAULT_MARGIN:0,a=Math.ceil(e.left-i.left-n),s=Math.floor(i.right-e.right-n),l=c.tuiGetViewportWidth(this.windowRef);switch(this.getFinalAlign(t,e)){case"left":s+r.DEFAULT_MARGIN>l||o.inRange(a+r.DEFAULT_MARGIN,0,l)?(t.left=o.px(a),t.right="auto"):(t.left="auto",t.right=o.px(s));break;case"right":o.inRange(s+r.DEFAULT_MARGIN,0,l)||a+r.DEFAULT_MARGIN>l?(t.left="auto",t.right=o.px(s)):(t.left=o.px(a),t.right="auto")}},t.prototype.calculateVerticalPosition=function(t,e,i){var n=this.windowRef.innerHeight,a=Math.min(this.directive.maxHeight,n-2*r.DEFAULT_MARGIN),c=this.directive.sided?r.DEFAULT_MARGIN-e.height:2*r.DEFAULT_MARGIN,s=e.top-c,l=n-e.bottom-c,u=this.getFinalDirection(e),d=this.inOption?2*r.DEFAULT_MARGIN:0;this.prevDirectionIsTop="top"===u,"top"===u?(this.dropdownAnimation=this.animationBottom,t.maxHeight=o.px(Math.min(a,s)),t.top="auto",t.bottom=o.px(i.bottom-e.top-r.DEFAULT_MARGIN+c-d)):(this.dropdownAnimation=this.animationTop,t.maxHeight=o.px(Math.min(a,l)),t.top=o.px(e.bottom-i.top-r.DEFAULT_MARGIN+c-d),t.bottom="auto")},t.prototype.getFinalDirection=function(t){var e=this.windowRef.innerHeight,i=this.directive.sided?r.DEFAULT_MARGIN-t.height:2*r.DEFAULT_MARGIN,o=t.top-i,n=e-t.bottom-i,a=null;switch(this.directive.direction){case"top":o>=this.directive.minHeight&&(a="top");break;case"bottom":n>=this.directive.minHeight&&(a="bottom")}var c=Math.min(this.directive.maxHeight,e-2*r.DEFAULT_MARGIN);if(null===a&&this.contentElementRef){var s=Math.min(this.contentElementRef.nativeElement.getBoundingClientRect().height+(this.elementRef.nativeElement.offsetHeight-this.elementRef.nativeElement.clientHeight),c);a=this.prevDirectionIsTop&&o>=s?"top":n>=s||n>=o?"bottom":"top"}return a},t.prototype.calculateWidth=function(t,e){if(t.width="fixed"!==this.directive.limitMinWidth||this.directive.sided?"":o.px(e.width),"min"===this.directive.limitMinWidth&&!this.directive.sided)return t.minWidth=o.px(e.width),void(t.maxWidth=o.px(r.DEFAULT_MAX_WIDTH));t.minWidth="",t.maxWidth=""},t.prototype.moveFocusOutside=function(t){var e=this.directive.host,i=e.ownerDocument,n=i?i.body:e;o.tuiAssertIsHTMLElement(e);for(var r=o.getClosestFocusable(e,t,n);null!==r&&e.contains(r);)r=o.getClosestFocusable(r,t,n);null==r||r.focus()},t.ctorParameters=function(){return[{type:o.TuiDestroyService,decorators:[{type:e.Inject,args:[o.TuiDestroyService]}]},{type:e.NgZone,decorators:[{type:e.Inject,args:[e.NgZone]}]},{type:void 0,decorators:[{type:e.Inject,args:[a.TUI_DROPDOWN_DIRECTIVE]}]},{type:Window,decorators:[{type:e.Inject,args:[i.WINDOW]}]},{type:e.ElementRef,decorators:[{type:e.Inject,args:[e.ElementRef]}]},{type:o.TuiDropdownHostComponent,decorators:[{type:e.Inject,args:[o.AbstractTuiPortalHostComponent]}]},{type:void 0,decorators:[{type:e.Inject,args:[a.TUI_ANIMATION_OPTIONS]}]},{type:s.Observable,decorators:[{type:e.Inject,args:[i.ANIMATION_FRAME]}]}]},f([e.HostBinding("@tuiDropdownAnimation")],t.prototype,"dropdownAnimation",void 0),f([e.ViewChild("content",{read:e.ElementRef})],t.prototype,"contentElementRef",void 0),f([o.tuiPure],t.prototype,"getContext",null),f([o.tuiPure],t.prototype,"inModal",null),f([o.tuiPure],t.prototype,"inOption",null),t=f([e.Component({selector:"tui-dropdown-box",template:'<div\n    #activeZone="tuiActiveZone"\n    class="t-wrapper"\n    [tuiOverscroll]="overscroll"\n    [tuiMode]="null"\n    [tuiActiveZoneParent]="directive.activeZone || null"\n>\n    <tui-scrollbar class="t-scroll">\n        <div\n            tabindex="0"\n            (focus)="onTopFocus()"\n        ></div>\n        <div\n            #content\n            polymorpheus-outlet\n            class="t-content"\n            [content]="directive.content"\n            [context]="getContext(directive.context, activeZone)"\n        ></div>\n        <div\n            tabindex="0"\n            (focus)="onBottomFocus()"\n        ></div>\n    </tui-scrollbar>\n</div>\n',changeDetection:e.ChangeDetectionStrategy.Default,providers:[o.TuiDestroyService],animations:[n.tuiDropdownAnimation],styles:[":host{z-index:0;box-shadow:0 .5rem 1rem rgba(0,0,0,.16);position:absolute;top:0;left:0;display:flex;background-color:#fff;background-color:var(--tui-elevation-01);border-radius:var(--tui-radius-m);overflow:hidden;border:1px solid var(--tui-base-03);box-sizing:border-box}:host.ng-animating{pointer-events:none}.t-content{display:flex;flex-direction:column;max-height:100%}.t-wrapper{flex-grow:1;max-width:100%;max-height:inherit;overflow:visible}.t-scroll{height:100%}"]}),g(0,e.Inject(o.TuiDestroyService)),g(1,e.Inject(e.NgZone)),g(2,e.Inject(a.TUI_DROPDOWN_DIRECTIVE)),g(3,e.Inject(i.WINDOW)),g(4,e.Inject(e.ElementRef)),g(5,e.Inject(o.AbstractTuiPortalHostComponent)),g(6,e.Inject(a.TUI_ANIMATION_OPTIONS)),g(7,e.Inject(i.ANIMATION_FRAME))],t)}(),v=function(){function t(){}return t=f([e.NgModule({imports:[o.TuiActiveZoneModule,p.PolymorpheusModule,o.TuiOverscrollModule,u.TuiScrollbarModule,d.TuiModeModule],entryComponents:[m],declarations:[m],exports:[m]})],t)}();t.TuiDropdownBoxComponent=m,t.TuiDropdownBoxModule=v,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=taiga-ui-core-components-dropdown-box.umd.min.js.map