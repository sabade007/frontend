import { __decorate, __param } from "tslib";
import { Directive, ElementRef, EventEmitter, HostBinding, HostListener, Inject, Input, Output, } from '@angular/core';
import { tuiDefaultProp, tuiRequiredSetter } from '@taiga-ui/cdk/decorators';
// eslint-disable-next-line @typescript-eslint/naming-convention
export function nonNegativeFiniteAssertion(value) {
    return Number.isFinite(value) && value >= 0;
}
// eslint-disable-next-line @typescript-eslint/naming-convention
export function volumeAssertion(volume) {
    return Number.isFinite(volume) && volume >= 0 && volume <= 1;
}
var TuiMediaDirective = /** @class */ (function () {
    function TuiMediaDirective(elementRef) {
        this.elementRef = elementRef;
        this.playbackRate = 1;
        this.volume = 1;
        this.currentTimeChange = new EventEmitter();
        this.pausedChange = new EventEmitter();
        this.volumeChange = new EventEmitter();
    }
    Object.defineProperty(TuiMediaDirective.prototype, "playbackRateSetter", {
        set: function (playbackRate) {
            this.updatePlaybackRate(playbackRate);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(TuiMediaDirective.prototype, "currentTime", {
        get: function () {
            return this.elementRef.nativeElement.currentTime;
        },
        set: function (currentTime) {
            if (Math.abs(currentTime - this.currentTime) > 0.05) {
                this.elementRef.nativeElement.currentTime = currentTime;
            }
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(TuiMediaDirective.prototype, "paused", {
        get: function () {
            return this.elementRef.nativeElement.paused;
        },
        set: function (paused) {
            if (paused) {
                this.elementRef.nativeElement.pause();
            }
            else {
                // eslint-disable-next-line @typescript-eslint/no-floating-promises
                this.elementRef.nativeElement.play();
                this.updatePlaybackRate(this.playbackRate);
            }
        },
        enumerable: true,
        configurable: true
    });
    // @bad TODO: Make sure no other events can affect this like network issues etc.
    TuiMediaDirective.prototype.onPausedChange = function (paused) {
        this.pausedChange.emit(paused);
        this.updatePlaybackRate(this.playbackRate);
    };
    TuiMediaDirective.prototype.onVolumeChange = function () {
        this.volume = this.elementRef.nativeElement.volume;
        this.volumeChange.emit(this.volume);
    };
    TuiMediaDirective.prototype.onCurrentTimeChange = function () {
        this.currentTimeChange.emit(this.currentTime);
    };
    TuiMediaDirective.prototype.changeDetectionTrigger = function () {
        // @bad TODO: consider if other events need to trigger CD
    };
    TuiMediaDirective.prototype.updatePlaybackRate = function (playbackRate) {
        this.playbackRate = playbackRate;
        this.elementRef.nativeElement.playbackRate = this.playbackRate;
    };
    TuiMediaDirective.ctorParameters = function () { return [
        { type: ElementRef, decorators: [{ type: Inject, args: [ElementRef,] }] }
    ]; };
    __decorate([
        Input(),
        HostBinding('volume'),
        tuiDefaultProp(volumeAssertion)
    ], TuiMediaDirective.prototype, "volume", void 0);
    __decorate([
        Input('playbackRate'),
        tuiRequiredSetter(nonNegativeFiniteAssertion)
    ], TuiMediaDirective.prototype, "playbackRateSetter", null);
    __decorate([
        Input(),
        tuiRequiredSetter(nonNegativeFiniteAssertion)
    ], TuiMediaDirective.prototype, "currentTime", null);
    __decorate([
        Input()
    ], TuiMediaDirective.prototype, "paused", null);
    __decorate([
        Output()
    ], TuiMediaDirective.prototype, "currentTimeChange", void 0);
    __decorate([
        Output()
    ], TuiMediaDirective.prototype, "pausedChange", void 0);
    __decorate([
        Output()
    ], TuiMediaDirective.prototype, "volumeChange", void 0);
    __decorate([
        HostListener('ended', ['true']),
        HostListener('pause', ['true']),
        HostListener('play', ['false'])
    ], TuiMediaDirective.prototype, "onPausedChange", null);
    __decorate([
        HostListener('volumechange')
    ], TuiMediaDirective.prototype, "onVolumeChange", null);
    __decorate([
        HostListener('timeupdate'),
        HostListener('seeking'),
        HostListener('seeked')
    ], TuiMediaDirective.prototype, "onCurrentTimeChange", null);
    __decorate([
        HostListener('durationchange')
    ], TuiMediaDirective.prototype, "changeDetectionTrigger", null);
    TuiMediaDirective = __decorate([
        Directive({
            selector: 'video[tuiMedia], audio[tuiMedia]',
            exportAs: 'tuiMedia',
        }),
        __param(0, Inject(ElementRef))
    ], TuiMediaDirective);
    return TuiMediaDirective;
}());
export { TuiMediaDirective };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWVkaWEuZGlyZWN0aXZlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQHRhaWdhLXVpL2Nkay9kaXJlY3RpdmVzL21lZGlhLyIsInNvdXJjZXMiOlsibWVkaWEuZGlyZWN0aXZlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQ0gsU0FBUyxFQUNULFVBQVUsRUFDVixZQUFZLEVBQ1osV0FBVyxFQUNYLFlBQVksRUFDWixNQUFNLEVBQ04sS0FBSyxFQUNMLE1BQU0sR0FDVCxNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQUMsY0FBYyxFQUFFLGlCQUFpQixFQUFDLE1BQU0sMEJBQTBCLENBQUM7QUFFM0UsZ0VBQWdFO0FBQ2hFLE1BQU0sVUFBVSwwQkFBMEIsQ0FBQyxLQUFhO0lBQ3BELE9BQU8sTUFBTSxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsSUFBSSxLQUFLLElBQUksQ0FBQyxDQUFDO0FBQ2hELENBQUM7QUFFRCxnRUFBZ0U7QUFDaEUsTUFBTSxVQUFVLGVBQWUsQ0FBQyxNQUFjO0lBQzFDLE9BQU8sTUFBTSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsSUFBSSxNQUFNLElBQUksQ0FBQyxJQUFJLE1BQU0sSUFBSSxDQUFDLENBQUM7QUFDakUsQ0FBQztBQU1EO0lBa0RJLDJCQUVxQixVQUF3QztRQUF4QyxlQUFVLEdBQVYsVUFBVSxDQUE4QjtRQW5EckQsaUJBQVksR0FBRyxDQUFDLENBQUM7UUFLekIsV0FBTSxHQUFHLENBQUMsQ0FBQztRQW9DRixzQkFBaUIsR0FBRyxJQUFJLFlBQVksRUFBVSxDQUFDO1FBRy9DLGlCQUFZLEdBQUcsSUFBSSxZQUFZLEVBQVcsQ0FBQztRQUczQyxpQkFBWSxHQUFHLElBQUksWUFBWSxFQUFVLENBQUM7SUFLaEQsQ0FBQztJQTNDSixzQkFBSSxpREFBa0I7YUFBdEIsVUFBdUIsWUFBb0I7WUFDdkMsSUFBSSxDQUFDLGtCQUFrQixDQUFDLFlBQVksQ0FBQyxDQUFDO1FBQzFDLENBQUM7OztP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QyxZQUFZLENBQUMsZ0JBQWdCLENBQUM7bUVBRzlCO0lBaEZRLGlCQUFpQjtRQUo3QixTQUFTLENBQUM7WUFDUCxRQUFRLEVBQUUsa0NBQWtDO1lBQzVDLFFBQVEsRUFBRSxVQUFVO1NBQ3ZCLENBQUM7UUFvRE8sV0FBQSxNQUFNLENBQUMsVUFBVSxDQUFDLENBQUE7T0FuRGQsaUJBQWlCLENBc0Y3QjtJQUFELHdCQUFDO0NBQUEsQUF0RkQsSUFzRkM7U0F0RlksaUJBQWlCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgICBEaXJlY3RpdmUsXG4gICAgRWxlbWVudFJlZixcbiAgICBFdmVudEVtaXR0ZXIsXG4gICAgSG9zdEJpbmRpbmcsXG4gICAgSG9zdExpc3RlbmVyLFxuICAgIEluamVjdCxcbiAgICBJbnB1dCxcbiAgICBPdXRwdXQsXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHt0dWlEZWZhdWx0UHJvcCwgdHVpUmVxdWlyZWRTZXR0ZXJ9IGZyb20gJ0B0YWlnYS11aS9jZGsvZGVjb3JhdG9ycyc7XG5cbi8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbmFtaW5nLWNvbnZlbnRpb25cbmV4cG9ydCBmdW5jdGlvbiBub25OZWdhdGl2ZUZpbml0ZUFzc2VydGlvbih2YWx1ZTogbnVtYmVyKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIE51bWJlci5pc0Zpbml0ZSh2YWx1ZSkgJiYgdmFsdWUgPj0gMDtcbn1cblxuLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uYW1pbmctY29udmVudGlvblxuZXhwb3J0IGZ1bmN0aW9uIHZvbHVtZUFzc2VydGlvbih2b2x1bWU6IG51bWJlcik6IGJvb2xlYW4ge1xuICAgIHJldHVybiBOdW1iZXIuaXNGaW5pdGUodm9sdW1lKSAmJiB2b2x1bWUgPj0gMCAmJiB2b2x1bWUgPD0gMTtcbn1cblxuQERpcmVjdGl2ZSh7XG4gICAgc2VsZWN0b3I6ICd2aWRlb1t0dWlNZWRpYV0sIGF1ZGlvW3R1aU1lZGlhXScsXG4gICAgZXhwb3J0QXM6ICd0dWlNZWRpYScsXG59KVxuZXhwb3J0IGNsYXNzIFR1aU1lZGlhRGlyZWN0aXZlIHtcbiAgICBwcml2YXRlIHBsYXliYWNrUmF0ZSA9IDE7XG5cbiAgICBASW5wdXQoKVxuICAgIEBIb3N0QmluZGluZygndm9sdW1lJylcbiAgICBAdHVpRGVmYXVsdFByb3Aodm9sdW1lQXNzZXJ0aW9uKVxuICAgIHZvbHVtZSA9IDE7XG5cbiAgICBASW5wdXQoJ3BsYXliYWNrUmF0ZScpXG4gICAgQHR1aVJlcXVpcmVkU2V0dGVyKG5vbk5lZ2F0aXZlRmluaXRlQXNzZXJ0aW9uKVxuICAgIHNldCBwbGF5YmFja1JhdGVTZXR0ZXIocGxheWJhY2tSYXRlOiBudW1iZXIpIHtcbiAgICAgICAgdGhpcy51cGRhdGVQbGF5YmFja1JhdGUocGxheWJhY2tSYXRlKTtcbiAgICB9XG5cbiAgICBASW5wdXQoKVxuICAgIEB0dWlSZXF1aXJlZFNldHRlcihub25OZWdhdGl2ZUZpbml0ZUFzc2VydGlvbilcbiAgICBzZXQgY3VycmVudFRpbWUoY3VycmVudFRpbWU6IG51bWJlcikge1xuICAgICAgICBpZiAoTWF0aC5hYnMoY3VycmVudFRpbWUgLSB0aGlzLmN1cnJlbnRUaW1lKSA+IDAuMDUpIHtcbiAgICAgICAgICAgIHRoaXMuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50LmN1cnJlbnRUaW1lID0gY3VycmVudFRpbWU7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBnZXQgY3VycmVudFRpbWUoKTogbnVtYmVyIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50LmN1cnJlbnRUaW1lO1xuICAgIH1cblxuICAgIEBJbnB1dCgpXG4gICAgc2V0IHBhdXNlZChwYXVzZWQ6IGJvb2xlYW4pIHtcbiAgICAgICAgaWYgKHBhdXNlZCkge1xuICAgICAgICAgICAgdGhpcy5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQucGF1c2UoKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZmxvYXRpbmctcHJvbWlzZXNcbiAgICAgICAgICAgIHRoaXMuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50LnBsYXkoKTtcbiAgICAgICAgICAgIHRoaXMudXBkYXRlUGxheWJhY2tSYXRlKHRoaXMucGxheWJhY2tSYXRlKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGdldCBwYXVzZWQoKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiB0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudC5wYXVzZWQ7XG4gICAgfVxuXG4gICAgQE91dHB1dCgpXG4gICAgcmVhZG9ubHkgY3VycmVudFRpbWVDaGFuZ2UgPSBuZXcgRXZlbnRFbWl0dGVyPG51bWJlcj4oKTtcblxuICAgIEBPdXRwdXQoKVxuICAgIHJlYWRvbmx5IHBhdXNlZENoYW5nZSA9IG5ldyBFdmVudEVtaXR0ZXI8Ym9vbGVhbj4oKTtcblxuICAgIEBPdXRwdXQoKVxuICAgIHJlYWRvbmx5IHZvbHVtZUNoYW5nZSA9IG5ldyBFdmVudEVtaXR0ZXI8bnVtYmVyPigpO1xuXG4gICAgY29uc3RydWN0b3IoXG4gICAgICAgIEBJbmplY3QoRWxlbWVudFJlZilcbiAgICAgICAgcHJpdmF0ZSByZWFkb25seSBlbGVtZW50UmVmOiBFbGVtZW50UmVmPEhUTUxNZWRpYUVsZW1lbnQ+LFxuICAgICkge31cblxuICAgIC8vIEBiYWQgVE9ETzogTWFrZSBzdXJlIG5vIG90aGVyIGV2ZW50cyBjYW4gYWZmZWN0IHRoaXMgbGlrZSBuZXR3b3JrIGlzc3VlcyBldGMuXG4gICAgQEhvc3RMaXN0ZW5lcignZW5kZWQnLCBbJ3RydWUnXSlcbiAgICBASG9zdExpc3RlbmVyKCdwYXVzZScsIFsndHJ1ZSddKVxuICAgIEBIb3N0TGlzdGVuZXIoJ3BsYXknLCBbJ2ZhbHNlJ10pXG4gICAgb25QYXVzZWRDaGFuZ2UocGF1c2VkOiBib29sZWFuKTogdm9pZCB7XG4gICAgICAgIHRoaXMucGF1c2VkQ2hhbmdlLmVtaXQocGF1c2VkKTtcbiAgICAgICAgdGhpcy51cGRhdGVQbGF5YmFja1JhdGUodGhpcy5wbGF5YmFja1JhdGUpO1xuICAgIH1cblxuICAgIEBIb3N0TGlzdGVuZXIoJ3ZvbHVtZWNoYW5nZScpXG4gICAgb25Wb2x1bWVDaGFuZ2UoKTogdm9pZCB7XG4gICAgICAgIHRoaXMudm9sdW1lID0gdGhpcy5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQudm9sdW1lO1xuICAgICAgICB0aGlzLnZvbHVtZUNoYW5nZS5lbWl0KHRoaXMudm9sdW1lKTtcbiAgICB9XG5cbiAgICBASG9zdExpc3RlbmVyKCd0aW1ldXBkYXRlJylcbiAgICBASG9zdExpc3RlbmVyKCdzZWVraW5nJylcbiAgICBASG9zdExpc3RlbmVyKCdzZWVrZWQnKVxuICAgIG9uQ3VycmVudFRpbWVDaGFuZ2UoKTogdm9pZCB7XG4gICAgICAgIHRoaXMuY3VycmVudFRpbWVDaGFuZ2UuZW1pdCh0aGlzLmN1cnJlbnRUaW1lKTtcbiAgICB9XG5cbiAgICBASG9zdExpc3RlbmVyKCdkdXJhdGlvbmNoYW5nZScpXG4gICAgY2hhbmdlRGV0ZWN0aW9uVHJpZ2dlcigpOiB2b2lkIHtcbiAgICAgICAgLy8gQGJhZCBUT0RPOiBjb25zaWRlciBpZiBvdGhlciBldmVudHMgbmVlZCB0byB0cmlnZ2VyIENEXG4gICAgfVxuXG4gICAgcHJpdmF0ZSB1cGRhdGVQbGF5YmFja1JhdGUocGxheWJhY2tSYXRlOiBudW1iZXIpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5wbGF5YmFja1JhdGUgPSBwbGF5YmFja1JhdGU7XG4gICAgICAgIHRoaXMuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50LnBsYXliYWNrUmF0ZSA9IHRoaXMucGxheWJhY2tSYXRlO1xuICAgIH1cbn1cbiJdfQ==