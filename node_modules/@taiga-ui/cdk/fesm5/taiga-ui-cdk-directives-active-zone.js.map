{"version":3,"file":"taiga-ui-cdk-directives-active-zone.js","sources":["ng://@taiga-ui/cdk/directives/active-zone/active-zone.directive.ts","ng://@taiga-ui/cdk/directives/active-zone/active-zone.module.ts","ng://@taiga-ui/cdk/directives/active-zone/taiga-ui-cdk-directives-active-zone.ts"],"sourcesContent":["import {\n    Directive,\n    ElementRef,\n    Inject,\n    Input,\n    NgZone,\n    OnDestroy,\n    Optional,\n    Output,\n    SkipSelf,\n} from '@angular/core';\nimport {tuiDefaultProp, tuiPure} from '@taiga-ui/cdk/decorators';\nimport {tuiZoneOptimized} from '@taiga-ui/cdk/observables';\nimport {TUI_ACTIVE_ELEMENT} from '@taiga-ui/cdk/tokens';\nimport {Observable} from 'rxjs';\nimport {distinctUntilChanged, map, skip, startWith} from 'rxjs/operators';\n\n@Directive({\n    selector:\n        '[tuiActiveZone]:not(ng-container), [tuiActiveZoneChange]:not(ng-container), [tuiActiveZoneParent]:not(ng-container)',\n    exportAs: 'tuiActiveZone',\n})\nexport class TuiActiveZoneDirective implements OnDestroy {\n    private subActiveZones: readonly TuiActiveZoneDirective[] = [];\n\n    private tuiActiveZoneParent: TuiActiveZoneDirective | null = null;\n\n    @Input('tuiActiveZoneParent')\n    @tuiDefaultProp()\n    set tuiActiveZoneParentSetter(zone: TuiActiveZoneDirective | null) {\n        this.setZone(zone);\n    }\n\n    @Output()\n    readonly tuiActiveZoneChange = this.active$.pipe(\n        map(element => !!element && this.contains(element)),\n        startWith(false),\n        distinctUntilChanged(),\n        skip(1),\n        tuiZoneOptimized(this.ngZone),\n    );\n\n    constructor(\n        @Inject(TUI_ACTIVE_ELEMENT)\n        private readonly active$: Observable<Element | null>,\n        @Inject(NgZone) private readonly ngZone: NgZone,\n        @Inject(ElementRef) private readonly elementRef: ElementRef<Element>,\n        @Optional()\n        @SkipSelf()\n        @Inject(TuiActiveZoneDirective)\n        private readonly directParentActiveZone: TuiActiveZoneDirective | null,\n    ) {\n        if (this.directParentActiveZone) {\n            this.directParentActiveZone.addSubActiveZone(this);\n        }\n    }\n\n    ngOnDestroy(): void {\n        if (this.directParentActiveZone) {\n            this.directParentActiveZone.removeSubActiveZone(this);\n        }\n\n        if (this.tuiActiveZoneParent) {\n            this.tuiActiveZoneParent.removeSubActiveZone(this);\n        }\n    }\n\n    contains(node: Node): boolean {\n        return (\n            this.elementRef.nativeElement.contains(node) ||\n            this.subActiveZones.some(\n                (item, index, array) =>\n                    array.indexOf(item) === index && item.contains(node),\n            )\n        );\n    }\n\n    @tuiPure\n    private setZone(zone: TuiActiveZoneDirective | null): void {\n        if (this.tuiActiveZoneParent) {\n            this.tuiActiveZoneParent.removeSubActiveZone(this);\n        }\n\n        if (zone) {\n            zone.addSubActiveZone(this);\n        }\n\n        this.tuiActiveZoneParent = zone;\n    }\n\n    private addSubActiveZone(activeZone: TuiActiveZoneDirective): void {\n        this.subActiveZones = [...this.subActiveZones, activeZone];\n    }\n\n    private removeSubActiveZone(activeZone: TuiActiveZoneDirective): void {\n        const index = this.subActiveZones.findIndex(item => item === activeZone);\n\n        this.subActiveZones = [\n            ...this.subActiveZones.slice(0, index),\n            ...this.subActiveZones.slice(index + 1),\n        ];\n    }\n}\n","import {NgModule} from '@angular/core';\n\nimport {TuiActiveZoneDirective} from './active-zone.directive';\n\n@NgModule({\n    declarations: [TuiActiveZoneDirective],\n    exports: [TuiActiveZoneDirective],\n})\nexport class TuiActiveZoneModule {}\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './index';\n"],"names":[],"mappings":"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"}