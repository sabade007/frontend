!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@ng-web-apis/common"),require("@taiga-ui/cdk/tokens"),require("@taiga-ui/cdk/constants"),require("rxjs"),require("rxjs/operators"),require("@taiga-ui/cdk/utils")):"function"==typeof define&&define.amd?define("@taiga-ui/cdk/directives/auto-focus",["exports","@angular/core","@ng-web-apis/common","@taiga-ui/cdk/tokens","@taiga-ui/cdk/constants","rxjs","rxjs/operators","@taiga-ui/cdk/utils"],t):t(((e=e||self)["taiga-ui"]=e["taiga-ui"]||{},e["taiga-ui"].cdk=e["taiga-ui"].cdk||{},e["taiga-ui"].cdk.directives=e["taiga-ui"].cdk.directives||{},e["taiga-ui"].cdk.directives["auto-focus"]={}),e.ng.core,e.common,e["taiga-ui"].cdk.tokens,e["taiga-ui"].cdk.constants,e.rxjs,e.rxjs.operators,e["taiga-ui"].cdk.utils)}(this,(function(e,t,n,o,r,i,u,c){"use strict";var s=function(e,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)};function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function l(e,t,n,o){var r,i=arguments.length,u=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)u=Reflect.decorate(e,t,n,o);else for(var c=e.length-1;c>=0;c--)(r=e[c])&&(u=(i<3?r(u):i>3?r(t,n,u):r(t,n))||u);return i>3&&u&&Object.defineProperty(t,n,u),u}function f(e,t){return function(n,o){t(n,o,e)}}Object.create;function p(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],o=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&o>=e.length&&(e=void 0),{value:e&&e[o++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}Object.create;var d=function(){function e(e,t){this.tuiFocusableComponent=e,this.elementRef=t}return Object.defineProperty(e.prototype,"element",{get:function(){var e;return(null===(e=this.tuiFocusableComponent)||void 0===e?void 0:e.nativeFocusableElement)||this.elementRef.nativeElement},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isTextFieldElement",{get:function(){return this.element.matches("input, textarea")},enumerable:!0,configurable:!0}),e.ctorParameters=function(){return[{type:void 0},{type:t.ElementRef}]},e=l([t.Directive()],e)}(),y=function(e){function c(t,n,o){var r=e.call(this,t,n)||this;return r.animationFrame$=o,r}return a(c,e),c.prototype.setFocus=function(){var e=this;this.isTextFieldElement?i.race(i.timer(1e3),this.animationFrame$.pipe(u.throttleTime(r.POLLING_TIME),u.map((function(){return e.element.closest(".ng-animating")})),u.skipWhile(Boolean),u.take(1))).subscribe((function(){return e.element.focus()})):this.element.focus()},c.ctorParameters=function(){return[{type:void 0,decorators:[{type:t.Optional},{type:t.Self},{type:t.Inject,args:[o.TUI_FOCUSABLE_ITEM_ACCESSOR]}]},{type:t.ElementRef,decorators:[{type:t.Inject,args:[t.ElementRef]}]},{type:i.Observable,decorators:[{type:t.Inject,args:[n.ANIMATION_FRAME]}]}]},c=l([t.Directive(),f(0,t.Optional()),f(0,t.Self()),f(0,t.Inject(o.TUI_FOCUSABLE_ITEM_ACCESSOR)),f(1,t.Inject(t.ElementRef)),f(2,t.Inject(n.ANIMATION_FRAME))],c)}(d),m=function(e){function r(t,n,o,r,i){var u=e.call(this,t,n)||this;return u.renderer=o,u.ngZone=r,u.windowRef=i,u.patchCssStyles(),u}return a(r,e),r.prototype.setFocus=function(){var e=this;this.isTextFieldElement?this.ngZone.runOutsideAngular((function(){return e.iosWebkitAutofocus()})):this.element.focus()},r.prototype.iosWebkitAutofocus=function(){var e,t=this,n=this.makeFakeInput(),o=this.getDurationTimeBeforeFocus(),r=0,i=0,u=function(){return n.focus({preventScroll:!0})},c=function(){clearTimeout(r),r=t.windowRef.setTimeout((function(){clearTimeout(i),n.removeEventListener("blur",u),n.removeEventListener("focus",c),i=t.windowRef.setTimeout((function(){t.element.focus({preventScroll:!1}),n.remove()}),o)}))};n.addEventListener("blur",u,{once:!0}),n.addEventListener("focus",c),this.insideDialog()?this.windowRef.document.body.appendChild(n):null===(e=this.element.parentElement)||void 0===e||e.appendChild(n),n.focus({preventScroll:!0})},r.prototype.makeFakeInput=function(){var e=this.renderer.createElement("input"),t=this.element.getBoundingClientRect();return e.setAttribute("maxlength","0"),e.style.height=c.tuiPx(t.height),e.style.width=c.tuiPx(t.width/2),e.style.position="fixed",e.style.zIndex="-99999999",e.style.caretColor="transparent",e.style.color="transparent",e.style.cursor="none",e.style.fontSize=c.tuiPx(16),e.readOnly=!0,e.style.top=c.tuiPx(t.top),e.style.left=c.tuiPx(t.left),e},r.prototype.getDurationTimeBeforeFocus=function(){return parseFloat(this.windowRef.getComputedStyle(this.element).getPropertyValue("--tui-duration"))||0},r.prototype.insideDialog=function(){return!!this.element.closest("tui-dialog")},r.prototype.patchCssStyles=function(){var e,t,n=this.windowRef.document;try{for(var o=p([n.documentElement,n.body]),r=o.next();!r.done;r=o.next()){var i=r.value;i.style.setProperty("overflow","auto"),i.style.setProperty("height","100%")}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}},r.ctorParameters=function(){return[{type:void 0,decorators:[{type:t.Optional},{type:t.Self},{type:t.Inject,args:[o.TUI_FOCUSABLE_ITEM_ACCESSOR]}]},{type:t.ElementRef,decorators:[{type:t.Inject,args:[t.ElementRef]}]},{type:t.Renderer2,decorators:[{type:t.Inject,args:[t.Renderer2]}]},{type:t.NgZone,decorators:[{type:t.Inject,args:[t.NgZone]}]},{type:Window,decorators:[{type:t.Inject,args:[n.WINDOW]}]}]},r=l([t.Directive(),f(0,t.Optional()),f(0,t.Self()),f(0,t.Inject(o.TUI_FOCUSABLE_ITEM_ACCESSOR)),f(1,t.Inject(t.ElementRef)),f(2,t.Inject(t.Renderer2)),f(3,t.Inject(t.NgZone)),f(4,t.Inject(n.WINDOW))],r)}(d),h=new t.InjectionToken("Autofocusing handler");function g(e,t,n,o,r,i,u){return u?new m(e,t,o,r,i):new y(e,t,n)}var I=[{provide:h,useFactory:g,deps:[[new t.Optional,new t.Self,o.TUI_FOCUSABLE_ITEM_ACCESSOR],t.ElementRef,n.ANIMATION_FRAME,t.Renderer2,t.NgZone,n.WINDOW,o.TUI_IS_IOS]}],v=function(){function e(e){this.handler=e,this.autoFocus=!0}return e.prototype.ngAfterViewInit=function(){this.autoFocus&&this.focus()},e.prototype.focus=function(){var e=this;Promise.resolve().then((function(){return e.handler.setFocus()}))},e.ctorParameters=function(){return[{type:void 0,decorators:[{type:t.Inject,args:[h]}]}]},l([t.Input()],e.prototype,"autoFocus",void 0),e=l([t.Directive({selector:"[tuiAutoFocus]",providers:I}),f(0,t.Inject(h))],e)}(),E=function(){function e(){}return e=l([t.NgModule({declarations:[v],exports:[v]})],e)}(),O=function(e){function n(t,n){return e.call(this,t,n)||this}return a(n,e),n.prototype.setFocus=function(){this.element.focus()},n.ctorParameters=function(){return[{type:void 0,decorators:[{type:t.Optional},{type:t.Self},{type:t.Inject,args:[o.TUI_FOCUSABLE_ITEM_ACCESSOR]}]},{type:t.ElementRef,decorators:[{type:t.Inject,args:[t.ElementRef]}]}]},n=l([t.Directive(),f(0,t.Optional()),f(0,t.Self()),f(0,t.Inject(o.TUI_FOCUSABLE_ITEM_ACCESSOR)),f(1,t.Inject(t.ElementRef))],n)}(d);e.AbstractTuiAutofocusHandler=d,e.TUI_AUTOFOCUS_HANDLER=h,e.TUI_AUTOFOCUS_PROVIDERS=I,e.TuiAutoFocusDirective=v,e.TuiAutoFocusModule=E,e.TuiDefaultAutofocusHandler=y,e.TuiIosAutofocusHandler=m,e.TuiSynchronousAutofocusHandler=O,e.tuiAutofocusHandlerFactory=g,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=taiga-ui-cdk-directives-auto-focus.umd.min.js.map