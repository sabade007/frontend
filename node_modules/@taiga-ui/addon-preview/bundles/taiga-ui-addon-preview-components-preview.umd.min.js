!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("@taiga-ui/cdk"),require("@taiga-ui/kit"),require("rxjs"),require("@taiga-ui/addon-preview/tokens"),require("@taiga-ui/core"),require("rxjs/operators"),require("@angular/common"),require("@angular/forms"),require("@ng-web-apis/mutation-observer"),require("@taiga-ui/addon-preview/components/preview-dialog"),require("@tinkoff/ng-polymorpheus")):"function"==typeof define&&define.amd?define("@taiga-ui/addon-preview/components/preview",["exports","@angular/core","@taiga-ui/cdk","@taiga-ui/kit","rxjs","@taiga-ui/addon-preview/tokens","@taiga-ui/core","rxjs/operators","@angular/common","@angular/forms","@ng-web-apis/mutation-observer","@taiga-ui/addon-preview/components/preview-dialog","@tinkoff/ng-polymorpheus"],e):e(((t=t||self)["taiga-ui"]=t["taiga-ui"]||{},t["taiga-ui"]["addon-preview"]=t["taiga-ui"]["addon-preview"]||{},t["taiga-ui"]["addon-preview"].components=t["taiga-ui"]["addon-preview"].components||{},t["taiga-ui"]["addon-preview"].components.preview={}),t.ng.core,t.cdk,t.kit,t.rxjs,t["taiga-ui"]["addon-preview"].tokens,t.core$1,t.rxjs.operators,t.ng.common,t.ng.forms,t.mutationObserver,t["taiga-ui"]["addon-preview"].components["preview-dialog"],t.ngPolymorpheus)}(this,(function(t,e,n,i,o,r,a,s,u,c,l,p,d){"use strict";function h(t,e,n,i){var o,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(a=(r<3?o(a):r>3?o(e,n,a):o(e,n))||a);return r>3&&a&&Object.defineProperty(e,n,a),a}function m(t,e){return function(n,i){e(n,i,t)}}Object.create;function g(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var i,o,r=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(i=r.next()).done;)a.push(i.value)}catch(t){o={error:t}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return a}Object.create;var f=function(){function t(t){this.texts$=t,this.length=1,this.index=0,this.indexChange=new e.EventEmitter}return Object.defineProperty(t.prototype,"leftButtonDisabled",{get:function(){return 0===this.index},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rightButtonDisabled",{get:function(){return this.index===this.length-1},enumerable:!0,configurable:!0}),t.prototype.onArrowClick=function(t){this.updateIndex(n.clamp(this.index+t,0,this.length-1))},t.prototype.updateIndex=function(t){this.index!==t&&(this.index=t,this.indexChange.emit(t))},t.ctorParameters=function(){return[{type:o.Observable,decorators:[{type:e.Inject,args:[i.TUI_PAGINATION_TEXTS]}]}]},h([e.Input(),n.tuiDefaultProp()],t.prototype,"length",void 0),h([e.Input(),n.tuiDefaultProp()],t.prototype,"index",void 0),h([e.Output()],t.prototype,"indexChange",void 0),h([e.HostListener("document:keydown.arrowRight.prevent",["1"]),e.HostListener("document:keydown.arrowLeft.prevent",["-1"])],t.prototype,"onArrowClick",null),t=h([e.Component({selector:"tui-preview-pagination",template:'<ng-container *ngIf="texts$ | async as texts">\n    <button\n        tuiIconButton\n        tuiPreviewAction\n        icon="tuiIconArrowLeft"\n        class="t-arrow_left"\n        [title]="texts[0]"\n        [disabled]="leftButtonDisabled"\n        (click)="onArrowClick(-1)"\n    ></button>\n    {{ index + 1 }}/{{ length }}\n    <button\n        tuiIconButton\n        tuiPreviewAction\n        icon="tuiIconArrowRight"\n        class="t-arrow_right"\n        [title]="texts[1]"\n        [disabled]="rightButtonDisabled"\n        (click)="onArrowClick(1)"\n    ></button>\n</ng-container>\n',changeDetection:e.ChangeDetectionStrategy.OnPush,styles:[":host{border-radius:1rem;background:rgba(104,104,104,.96);color:var(--tui-text-01-night);font:var(--tui-font-text-s);display:flex;justify-content:space-between;align-items:center;width:6.25rem}.t-arrow_left{border-top-right-radius:0;border-bottom-right-radius:0}.t-arrow_right{border-top-left-radius:0;border-bottom-left-radius:0}"]}),m(0,e.Inject(i.TUI_PAGINATION_TEXTS))],t)}(),v=[0,0],b=function(){function t(t,e,i){this.elementRef=t,this.destroy$=e,this.texts$=i,this.zoomable=!0,this.rotatable=!1,this.minZoom=1,this.width=0,this.height=0,this.zoom$=new o.BehaviorSubject(this.minZoom),this.rotation$=new o.BehaviorSubject(0),this.coordinates$=new o.BehaviorSubject(v),this.transitioned$=o.merge(n.dragAndDropFrom(this.elementRef.nativeElement).pipe(s.map((function(t){return 1!==t.stage}))),n.typedFromEvent(this.elementRef.nativeElement,"touchmove",{passive:!0}).pipe(s.mapTo(!1)),n.typedFromEvent(this.elementRef.nativeElement,"wheel",{passive:!0}).pipe(s.mapTo(!1))),this.cursor$=n.dragAndDropFrom(this.elementRef.nativeElement).pipe(s.map((function(t){return 1===t.stage?"grabbing":"initial"})),s.startWith("initial")),this.wrapperTransform$=o.combineLatest([this.coordinates$.pipe(s.map((function(t){var e=g(t,2),i=e[0],o=e[1];return n.px(i)+", "+n.px(o)}))),this.zoom$,this.rotation$]).pipe(s.map((function(t){var e=g(t,3);return"translate("+e[0]+") scale("+e[1]+") rotate("+e[2]+"deg)"})))}return t.prototype.rotate=function(){this.rotation$.next(this.rotation$.value-90)},t.prototype.onPan=function(t){this.coordinates$.next(this.getGuardedCoordinates(this.coordinates$.value[0]+t[0],this.coordinates$.value[1]+t[1]))},t.prototype.onMutation=function(t){var e=t.clientWidth,n=t.clientHeight;this.refresh(e,n)},t.prototype.onZoom=function(t){var e=t.clientX,n=t.clientY,i=t.delta;this.zoomable&&this.processZoom(e,n,i)},t.prototype.onResize=function(t){if(0!==t.length){var e=t[0].contentRect,n=e.width,i=e.height;this.refresh(n,i)}},t.prototype.reset=function(){this.zoom$.next(this.minZoom),this.coordinates$.next(v)},Object.defineProperty(t.prototype,"offsets",{get:function(){return{offsetX:(this.zoom$.value-this.minZoom)*this.width/2,offsetY:(this.zoom$.value-this.minZoom)*this.height/2}},enumerable:!0,configurable:!0}),t.prototype.calculateMinZoom=function(t,e,i,o){var r=t>.8*i||e>.8*o,a=this.elementRef.nativeElement,s=a.clientHeight,u=a.clientWidth;return r?n.round(Math.min(.8*s/t,.8*u/e),2):1},t.prototype.refresh=function(t,e){this.width=t,this.height=e,this.minZoom=this.calculateMinZoom(e,t,this.elementRef.nativeElement.clientHeight,this.elementRef.nativeElement.clientWidth),this.zoom$.next(this.minZoom),this.coordinates$.next(v),this.rotation$.next(0)},t.prototype.processZoom=function(t,e,i){var o=this.zoom$.value,r=n.clamp(o+i,this.minZoom,2),a=this.getScaleCenter({clientX:t,clientY:e},this.coordinates$.value,this.zoom$.value),s=a[0]*o-a[0]*r,u=a[1]*o-a[1]*r;this.zoom$.next(r),this.coordinates$.next(this.getGuardedCoordinates(this.coordinates$.value[0]+s,this.coordinates$.value[1]+u))},t.prototype.getGuardedCoordinates=function(t,e){var i=this.offsets,o=i.offsetX,r=i.offsetY;return[n.clamp(t,-o,o),n.clamp(e,-r,r)]},t.prototype.getScaleCenter=function(t,e,n){var i=t.clientX,o=t.clientY,r=g(e,2),a=r[0],s=r[1];return[(i-a-this.elementRef.nativeElement.offsetWidth/2)/n,(o-s-this.elementRef.nativeElement.offsetHeight/2)/n]},t.ctorParameters=function(){return[{type:e.ElementRef,decorators:[{type:e.Inject,args:[e.ElementRef]}]},{type:o.Observable,decorators:[{type:e.Inject,args:[n.TuiDestroyService]}]},{type:o.Observable,decorators:[{type:e.Inject,args:[r.TUI_PREVIEW_TEXTS]}]}]},h([e.Input(),n.tuiDefaultProp()],t.prototype,"zoomable",void 0),h([e.Input(),n.tuiDefaultProp()],t.prototype,"rotatable",void 0),t=h([e.Component({selector:"tui-preview",template:'<ng-container *ngIf="texts$ | async as texts">\n    <section\n        #contentWrapper\n        subtree\n        childList\n        characterData\n        attributeFilter="src"\n        class="t-wrapper"\n        [class.t-not-interactive-content]="zoomable"\n        [class.t-transitive]="transitioned$ | async"\n        [style.transform]="wrapperTransform$ | async"\n        [style.cursor]="cursor$ | async"\n        (tuiPan)="onPan($event)"\n        (tuiZoom)="onZoom($event)"\n        (tuiResize)="onResize($event)"\n        (waMutationObserver)="onMutation(contentWrapper)"\n    >\n        <ng-content></ng-content>\n    </section>\n\n    <header class="t-header">\n        <div class="t-title">\n            <ng-content select="tui-preview-title"></ng-content>\n        </div>\n\n        <ng-content select="tui-preview-pagination"></ng-content>\n\n        <div class="t-actions">\n            <ng-content select="[tuiPreviewAction]"></ng-content>\n        </div>\n    </header>\n\n    <footer class="t-footer">\n        <button\n            *ngIf="rotatable"\n            tuiIconButton\n            tuiPreviewAction\n            icon="tuiIconRotate"\n            tuiHintId="Rotate"\n            tuiHintDirection="top-right"\n            tuiHintMode="onDark"\n            class="t-rotate-button"\n            [tuiHint]="texts.rotate"\n            (click)="rotate()"\n        ></button>\n\n        <tui-preview-zoom\n            *ngIf="zoomable"\n            [min]="minZoom"\n            [value]="(zoom$ | async) || 1"\n            (valueChange)="zoom$.next($event)"\n            (reset)="reset()"\n        ></tui-preview-zoom>\n    </footer>\n</ng-container>\n',changeDetection:e.ChangeDetectionStrategy.OnPush,animations:[a.tuiSlideInTop],providers:[n.TuiDestroyService],styles:[":host{position:relative;display:flex;justify-content:center;align-items:center;width:100%;height:100%;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.t-header{position:fixed;top:1rem;display:flex;width:100%;padding:0 1rem;box-sizing:border-box}.t-footer{position:absolute;bottom:1rem;display:flex;width:100%;padding:0 1rem;box-sizing:border-box;justify-content:center}.t-actions{display:flex;flex:1;justify-content:flex-end}.t-actions ::ng-deep>*{margin-left:.625rem}.t-rotate-button{margin-right:.3125rem}.t-title{flex:1}:host-context(tui-root._mobile) .t-title{display:none}.t-not-interactive-content ::ng-deep>*{pointer-events:none}.t-wrapper{will-change:transform}.t-transitive{transition-duration:.3s}"]}),m(0,e.Inject(e.ElementRef)),m(1,e.Inject(n.TuiDestroyService)),m(2,e.Inject(r.TUI_PREVIEW_TEXTS))],t)}(),y={appearance:"preview-action",shape:"rounded",size:"s"},w=function(){function t(){}return t=h([e.Directive({selector:"[tuiPreviewAction]",providers:[{provide:a.TUI_BUTTON_OPTIONS,useValue:y}]})],t)}(),x=function(){function t(){}return t=h([e.NgModule({declarations:[w],exports:[w]})],t)}(),I=function(){function t(){}return t=h([e.Component({selector:"tui-preview-title",template:"\n        <ng-content></ng-content>\n    ",changeDetection:e.ChangeDetectionStrategy.OnPush,styles:[":host{border-radius:1rem;background:rgba(104,104,104,.96);color:var(--tui-text-01-night);font:var(--tui-font-text-s);display:inline-block;padding:.375rem .75rem}"]})],t)}(),P=function(){function t(t){this.zoomTexts$=t,this.min=.5,this.max=2,this.value=1,this.valueChange=new e.EventEmitter,this.reset=new e.EventEmitter,this.hintShow$=this.valueChange.pipe(s.switchMap((function(){return o.merge(o.of(!0),o.timer(1e3).pipe(s.mapTo(!1)))})),s.startWith(!1))}return Object.defineProperty(t.prototype,"leftButtonDisabled",{get:function(){return this.value===this.min},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rightButtonDisabled",{get:function(){return this.value===this.max},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"collapseVisible",{get:function(){return this.value>this.min},enumerable:!0,configurable:!0}),t.prototype.onModelChange=function(t){var e=n.clamp(t,this.min,this.max);e!==this.value&&(this.value=e,this.valueChange.emit(e))},t.prototype.onReset=function(){this.reset.emit()},t.prototype.onMinus=function(){this.onModelChange(this.value-.5)},t.prototype.onPlus=function(){this.onModelChange(this.value<1?1:this.value+.5)},t.ctorParameters=function(){return[{type:o.Observable,decorators:[{type:e.Inject,args:[r.TUI_PREVIEW_ZOOM_TEXTS]}]}]},h([e.Input(),n.tuiDefaultProp()],t.prototype,"min",void 0),h([e.Input(),n.tuiDefaultProp()],t.prototype,"max",void 0),h([e.Input(),n.tuiDefaultProp()],t.prototype,"value",void 0),h([e.Output()],t.prototype,"valueChange",void 0),h([e.Output()],t.prototype,"reset",void 0),t=h([e.Component({selector:"tui-preview-zoom",template:'<ng-container *ngIf="zoomTexts$ | async as texts">\n    <section class="t-zoom">\n        <button\n            tuiIconButton\n            tuiPreviewAction\n            icon="tuiIconMinus"\n            class="t-sign_minus"\n            [title]="texts.zoomOut"\n            [disabled]="leftButtonDisabled"\n            (click)="onMinus()"\n        ></button>\n        <label tuiSliderThumbLabel>\n            <div\n                tuiHintMode="onDark"\n                tuiHintDirection="top-right"\n                [tuiManualHint]="hint"\n                [tuiManualHintShow]="!!(hintShow$ | async)"\n            ></div>\n\n            <ng-template #hint>\n                {{ (valueChange | async) || value | percent }}\n            </ng-template>\n\n            <input\n                tuiSlider\n                type="range"\n                step="any"\n                class="t-slider"\n                [min]="min"\n                [max]="max"\n                [ngModel]="value"\n                (ngModelChange)="onModelChange($event)"\n            />\n        </label>\n        <button\n            tuiIconButton\n            tuiPreviewAction\n            icon="tuiIconPlus"\n            class="t-sign_plus"\n            [title]="texts.zoomIn"\n            [disabled]="rightButtonDisabled"\n            (click)="onPlus()"\n        ></button>\n    </section>\n\n    <button\n        tuiIconButton\n        tuiPreviewAction\n        icon="tuiIconCollapse"\n        tuiHintId="Collapse"\n        tuiHintDirection="top-right"\n        tuiHintMode="onDark"\n        class="t-reset-button"\n        [tuiHint]="texts.reset"\n        [class.t-invisible]="!collapseVisible"\n        (click)="onReset()"\n    ></button>\n</ng-container>\n',changeDetection:e.ChangeDetectionStrategy.OnPush,styles:[":host{position:relative;display:flex}.t-zoom{border-radius:1rem;background:rgba(104,104,104,.96);color:var(--tui-text-01-night);font:var(--tui-font-text-s);display:flex;justify-content:space-between;align-items:center;width:12rem}.t-slider{width:7.5rem}.t-sign_minus{border-top-right-radius:0;border-bottom-right-radius:0}.t-sign_plus{border-top-left-radius:0;border-bottom-left-radius:0}.t-invisible{visibility:hidden}.t-reset-button{margin-left:.3125rem}"]}),m(0,e.Inject(r.TUI_PREVIEW_ZOOM_TEXTS))],t)}(),T=function(){function t(){}return t=h([e.NgModule({imports:[u.CommonModule,d.PolymorpheusModule,l.MutationObserverModule,a.TuiButtonModule,c.FormsModule,i.TuiSliderModule,a.TuiHintModule,n.TuiDragModule,a.TuiManualHintModule,n.TuiResizeModule,a.TuiSvgModule,a.TuiLoaderModule,n.TuiPanModule,n.TuiZoomModule,x],declarations:[b,I,f,P],exports:[b,w,I,f,P],providers:[p.PREVIEW_DIALOG_PROVIDER]})],t)}();t.PREVIEW_ACTION_OPTIONS=y,t.TuiPreviewActionDirective=w,t.TuiPreviewActionModule=x,t.TuiPreviewComponent=b,t.TuiPreviewModule=T,t.TuiPreviewPaginationComponent=f,t.TuiPreviewTitleComponent=I,t.TuiPreviewZoomComponent=P,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=taiga-ui-addon-preview-components-preview.umd.min.js.map